import{a as R,b as oe}from"./chunk-OZSVZQVF.js";import{b as ae,c as re}from"./chunk-RLQ6OS3V.js";import{a as Z}from"./chunk-GFU3UW6A.js";import{b as ee,d as te,f as ne,r as ie}from"./chunk-5VRDLXRS.js";import"./chunk-W2ZFWDSY.js";import{f as X}from"./chunk-XAZ3CRE3.js";import{Cb as A,Eb as b,Ec as J,Gb as m,Kb as U,Lb as Q,Ma as L,Mb as K,N as V,P as W,Pa as s,Rb as v,Tb as o,Ub as y,V as j,Vb as g,Yb as Y,Zb as G,_ as f,_a as O,_b as z,da as x,dc as D,ea as h,ec as $,ha as P,i as _,j as H,jc as N,n as C,nb as c,oa as S,pb as u,qa as q,rb as M,sb as E,tb as I,ub as i,v as B,vb as n,wb as k,z as w}from"./chunk-JKZ4R3JY.js";import"./chunk-2NFLSA4Y.js";var T=class a{http=f(X);brainApiUrl=Z.brainApiUrl??"http://localhost:8000";appName="agent";userId="sandbox_user";activeSessions=new Set;chat(t,e){return this.ensureSession$(e).pipe(V(()=>this.http.post(`${this.brainApiUrl}/run`,{appName:this.appName,userId:this.userId,sessionId:e,newMessage:{role:"user",parts:[{text:t}]}})),C(r=>({response:this.extractText(r),sessionId:e,timestamp:new Date().toISOString()})),w(r=>H(()=>new Error(r.error?.message??r.statusText??"Agent unavailable"))))}healthCheck(){return this.http.get(`${this.brainApiUrl}/list-apps`).pipe(C(t=>Array.isArray(t)&&t.includes(this.appName)),w(()=>_(!1)))}generateSessionId(){return`sandbox_${Date.now()}_${Math.random().toString(36).slice(2,8)}`}ensureSession$(t){if(this.activeSessions.has(t))return _(void 0);let e=`${this.brainApiUrl}/apps/${this.appName}/users/${this.userId}/sessions/${t}`;return this.http.post(e,{}).pipe(W(()=>this.activeSessions.add(t)),C(()=>{}),w(()=>(this.activeSessions.add(t),_(void 0))))}extractText(t){let r=t.filter(d=>d?.content?.role==="model"&&d?.content?.parts?.some(p=>p.text&&!p.thought&&p.text.trim().length>0)).at(-1)??t.at(-1);return r?.content?.parts?.length&&r.content.parts.filter(d=>d.text&&!d.thought&&d.text.trim().length>0).map(d=>d.text).join(`
`)||"No response received from the agent."}static \u0275fac=function(e){return new(e||a)};static \u0275prov=j({token:a,factory:a.\u0275fac,providedIn:"root"})};var de=["messagesContainer"],se=(a,t)=>t.id;function me(a,t){a&1&&(i(0,"span",19),o(1,"\u25CF Connected"),n())}function pe(a,t){a&1&&(i(0,"span",20),o(1,"\u25CF Mock Mode"),n())}function ce(a,t){if(a&1&&(i(0,"div",22),o(1),n()),a&2){let e=m();s(),g(" ",e.brainConnectionError()," ")}}function ue(a,t){a&1&&(i(0,"span"),o(1,"Connected to live Brain Service with multi-agent AI"),n())}function ge(a,t){a&1&&(i(0,"span"),o(1,"Brain service offline - using mock responses"),n())}function xe(a,t){if(a&1&&(i(0,"div",25)(1,"div",38)(2,"span",39),o(3,"chat"),n()(),i(4,"h3",40),o(5,"Start a Conversation"),n(),i(6,"p",41),c(7,ue,2,0,"span")(8,ge,2,0,"span"),n(),i(9,"p",41),o(10,"Try one of the test scenarios or send your own message"),n()()),a&2){let e=m();s(7),u(e.isBrainConnected()?7:8)}}function he(a,t){if(a&1&&(k(0,"div",47),D(1,"markdown")),a&2){let e=m().$implicit;I("innerHTML",$(1,1,e.content),L)}}function be(a,t){if(a&1&&(i(0,"p",48),o(1),n()),a&2){let e=m().$implicit;s(),y(e.content)}}function fe(a,t){if(a&1&&(i(0,"span",51),o(1),n()),a&2){let e=m().$implicit;s(),g("\xB7 ",(e.responseTimeMs/1e3).toFixed(1),"s")}}function ve(a,t){if(a&1){let e=A();i(0,"button",52),b("click",function(){x(e);let l=m().$implicit,d=m(2);return h(d.copyMessage(l.content))}),i(1,"span",53),o(2,"content_copy"),n()(),i(3,"button",54)(4,"span",53),o(5,"thumb_up"),n()()}}function ye(a,t){if(a&1&&(i(0,"div",26)(1,"div",43)(2,"span",44),o(3),n()(),i(4,"div",45)(5,"div",46),c(6,he,2,3,"div",47)(7,be,2,1,"p",48),n(),i(8,"div",49)(9,"span",50),o(10),D(11,"timeAgo"),n(),c(12,fe,2,1,"span",51),c(13,ve,6,0),n()()()),a&2){let e=t.$implicit;v("flex-row-reverse",e.sender==="user"),s(),v("bg-gradient-to-br",e.sender==="ai")("from-primary",e.sender==="ai")("to-primary/80",e.sender==="ai")("text-white",e.sender==="ai")("bg-slate-200",e.sender==="user")("dark:bg-slate-700",e.sender==="user")("text-slate-600",e.sender==="user")("dark:text-slate-300",e.sender==="user"),s(2),g(" ",e.sender==="ai"?"smart_toy":"person"," "),s(),v("items-end",e.sender==="user"),s(),v("bg-gradient-to-br",e.sender==="ai")("from-primary",e.sender==="ai")("to-primary/90",e.sender==="ai")("text-white",e.sender==="ai")("bg-slate-100",e.sender==="user")("dark:bg-slate-800",e.sender==="user")("text-slate-900",e.sender==="user")("dark:text-white",e.sender==="user"),s(),u(e.sender==="ai"?6:7),s(4),g(" ",$(11,41,e.timestamp)," "),s(2),u(e.sender==="ai"&&e.responseTimeMs?12:-1),s(),u(e.sender==="ai"?13:-1)}}function _e(a,t){if(a&1&&M(0,ye,14,43,"div",42,se),a&2){let e=m();E(e.messages())}}function Ce(a,t){a&1&&(i(0,"div",26)(1,"div",55)(2,"span",56),o(3,"smart_toy"),n()(),i(4,"div",57)(5,"div",58),k(6,"div",59)(7,"div",60)(8,"div",61),n()()())}function we(a,t){if(a&1){let e=A();i(0,"button",62),b("click",function(){let l=x(e).$implicit,d=m();return h(d.loadScenario(l))}),i(1,"h4",63),o(2),n(),i(3,"p",64),o(4),n()()}if(a&2){let e=t.$implicit;s(2),g(" ",e.name," "),s(2),g(" ",e.description," ")}}var F=class a{brainApi=f(T);destroyRef=f(P);messagesContainer;messages=S([]);isTyping=S(!1);brainConnectionError=S(null);userInput="";currentSessionId=this.brainApi.generateSessionId();conversationHistory=[];selectedModel="gemini-2.5-flash";isBrainConnected=oe(this.brainApi.healthCheck(),{initialValue:!1});messageCount=N(()=>this.messages().length);avgResponseTime=N(()=>{let t=this.messages().filter(r=>r.sender==="ai"&&r.responseTimeMs!=null);return t.length?`${(t.reduce((r,l)=>r+(l.responseTimeMs??0),0)/t.length/1e3).toFixed(1)}s`:"\u2014"});constructor(){q(()=>{this.messages(),queueMicrotask(()=>this.scrollToBottom())})}ngOnInit(){this.addWelcomeMessage()}sendMessage(){let t=this.userInput.trim();if(!t||this.isTyping())return;this.addUserMessage(t),this.userInput="",this.isTyping.set(!0);let e=Date.now();this.brainApi.chat(t,this.currentSessionId).pipe(R(this.destroyRef)).subscribe({next:r=>{let l=Date.now()-e;this.conversationHistory.push({role:"user",content:t}),this.conversationHistory.push({role:"assistant",content:r.response}),this.addAiMessage(r.response,l),this.isTyping.set(!1)},error:()=>{this.addAiMessage(this.generateMockAiResponse(t)),this.isTyping.set(!1),this.brainConnectionError.set("Failed to get AI response. Using fallback mode."),B(3e3).pipe(R(this.destroyRef)).subscribe(()=>this.brainConnectionError.set(null))}})}onKeyDown(t){let e=t;e.ctrlKey&&e.key==="Enter"&&this.sendMessage()}loadScenario(t){this.userInput=t.initialMessage}clearConversation(){this.messages.set([]),this.conversationHistory=[],this.currentSessionId=this.brainApi.generateSessionId(),this.addWelcomeMessage()}copyMessage(t){navigator.clipboard.writeText(t).catch(console.error)}addWelcomeMessage(){this.addAiMessage(`Hello! I'm your AI customer service assistant powered by **Gemini 2.5 Flash**.

I can help you with **shipping quotes**, **tracking**, **complaints**, and **general inquiries**.

How can I assist you today?`)}addUserMessage(t){this.messages.update(e=>[...e,{id:`${Date.now()}-user`,sender:"user",content:t,timestamp:new Date}])}addAiMessage(t,e){this.messages.update(r=>[...r,{id:`${Date.now()}-ai`,sender:"ai",content:t,timestamp:new Date,responseTimeMs:e}])}scrollToBottom(){let t=this.messagesContainer?.nativeElement;t&&(t.scrollTop=t.scrollHeight)}testScenarios=[{id:"1",name:"Shipping Quote Request",description:"Customer asks for a shipping quote from New York to Los Angeles",initialMessage:"Hi, I need a quote for shipping a package from New York to Los Angeles. It weighs about 5 lbs."},{id:"2",name:"Tracking Issue",description:"Customer unable to track their shipment",initialMessage:"I can't find my tracking number. My order ID is #12345. Can you help?"},{id:"3",name:"Delivery Delay Complaint",description:"Customer complaining about delayed delivery",initialMessage:"My package was supposed to arrive yesterday but it still hasn't shown up. What's going on?"},{id:"4",name:"International Shipping",description:"Questions about international shipping rates and customs",initialMessage:"Do you ship to Germany? What are the rates and how long does it take?"},{id:"5",name:"Damaged Package",description:"Customer received damaged goods",initialMessage:"I just received my order but the box is damaged and one item is broken. What should I do?"}];generateMockAiResponse(t){let e=t.toLowerCase();return e.includes("quote")||e.includes("price")||e.includes("cost")?`I'd be happy to help with a shipping quote! Here's an estimate:

\u{1F4E6} **From:** New York
\u{1F4CD} **To:** Los Angeles
\u2696\uFE0F **Weight:** 5 lbs (2.27 kg)

Estimated rates:
- **Standard** (5-7 days): $15.99
- **Express** (2-3 days): $29.99
- **Overnight**: $49.99

Would you like to proceed with one of these options?`:e.includes("track")||e.includes("tracking")?`I found your shipment! Here is the current status:

\u{1F4E6} **Status:** In Transit
\u{1F4CD} **Location:** Chicago Distribution Center
\u{1F550} **Last Update:** 2 hours ago
\u{1F4C5} **Expected Delivery:** Tomorrow by 5 PM
\u{1F522} **Tracking #:** LMS-TRK1234567

Is there anything else you would like to know?`:e.includes("delay")||e.includes("late")||e.includes("hasn't")?`I sincerely apologise for the delay. Here's what I found:

There was an unexpected hold at our sorting facility due to high volume. Your package is now en route and should arrive **tomorrow afternoon**.

As compensation I've applied a **$10 credit** to your account.

Would you like me to arrange priority delivery for your next shipment?`:e.includes("international")||e.includes("germany")||e.includes("country")?`Yes, we ship to **Germany**! Here is what you need to know:

- \u{1F30D} **Delivery Time:** 7-14 business days
- \u{1F4B0} **Starting Rate:** $35 for packages up to 2 lbs
- \u{1F4CB} **Customs:** We handle all documentation
- \u{1F4E6} **Tracking:** Available throughout transit

*Note: Customs duties and taxes may apply upon arrival in Germany.*

Would you like a specific quote for your shipment?`:e.includes("damage")||e.includes("broken")?`I'm very sorry to hear about the damaged package. We will make it right:

1. \u2705 I'm filing a damage claim immediately
2. \u{1F4F8} Please take photos of the damage
3. \u{1F4E6} We can send a replacement via express shipping
4. \u{1F4B5} Or we can process a **full refund**

Which would you prefer? Either way, you do not need to return the damaged item.`:`Thank you for your message! I'm here to help with:

- Shipping quotes and rates
- Package tracking
- Delivery updates
- International shipping
- Claims and issues

Could you provide more details about what you need assistance with?`}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=O({type:a,selectors:[["app-ai-agent-sandbox"]],viewQuery:function(e,r){if(e&1&&U(de,5),e&2){let l;Q(l=K())&&(r.messagesContainer=l.first)}},decls:77,vars:10,consts:[["messagesContainer",""],[1,"mx-auto","w-full","max-w-7xl","flex","flex-col","gap-6","h-[calc(100vh-120px)]"],[1,"flex","justify-between","items-start","flex-wrap","gap-4"],[1,"text-3xl","font-bold","text-slate-900","dark:text-white"],[1,"text-slate-500","dark:text-slate-400"],[1,"flex","gap-2"],[1,"flex","items-center","gap-2","px-4","py-2","bg-white","dark:bg-slate-800","border","border-slate-200","dark:border-slate-700","rounded-lg","text-sm","font-medium","text-slate-700","dark:text-slate-300","hover:bg-slate-50","dark:hover:bg-slate-700","transition-colors",3,"click"],[1,"material-symbols-outlined","text-[20px]"],[1,"flex","items-center","gap-2","px-4","py-2","bg-primary","hover:bg-primary/90","text-white","rounded-lg","text-sm","font-medium","transition-colors"],[1,"flex","gap-6","flex-1","overflow-hidden"],[1,"flex-1","flex","flex-col","bg-white","dark:bg-slate-900","border","border-slate-200","dark:border-slate-800","rounded-xl","shadow-sm","overflow-hidden"],[1,"flex","items-center","justify-between","px-6","py-4","bg-slate-50","dark:bg-slate-800/50","border-b","border-slate-200","dark:border-slate-800"],[1,"flex","items-center","gap-3"],[1,"relative"],[1,"w-10","h-10","bg-gradient-to-br","from-primary","to-primary/80","rounded-full","flex","items-center","justify-center"],[1,"material-symbols-outlined","text-white","text-[24px]"],[1,"absolute","-bottom-0.5","-right-0.5","w-3","h-3","bg-green-500","border-2","border-slate-50","dark:border-slate-800","rounded-full"],[1,"text-sm","font-semibold","text-slate-900","dark:text-white"],[1,"text-xs","text-slate-500","dark:text-slate-400"],[1,"text-green-600","dark:text-green-400"],[1,"text-amber-600","dark:text-amber-400"],[1,"flex","items-center","gap-2"],[1,"px-3","py-1.5","bg-amber-100","text-amber-700","dark:bg-amber-900/30","dark:text-amber-400","rounded-lg","text-xs","font-medium"],[1,"px-3","py-1.5","bg-primary/10","text-primary","rounded-lg","text-xs","font-medium"],[1,"flex-1","overflow-y-auto","p-6","space-y-4"],[1,"flex","flex-col","items-center","justify-center","h-full","text-center"],[1,"flex","gap-3"],[1,"border-t","border-slate-200","dark:border-slate-800","p-4"],["placeholder","Type your test message... (Ctrl+Enter to send)","rows","3",1,"flex-1","px-4","py-2","bg-slate-50","dark:bg-slate-800","border","border-slate-200","dark:border-slate-700","rounded-lg","text-sm","focus:outline-none","focus:ring-2","focus:ring-primary/20","focus:border-primary","text-slate-900","dark:text-white","placeholder-slate-400","resize-none",3,"ngModelChange","keydown.enter","ngModel"],[1,"px-6","py-2","bg-primary","hover:bg-primary/90","text-white","rounded-lg","font-medium","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed","h-fit",3,"click","disabled"],[1,"material-symbols-outlined"],[1,"w-80","flex","flex-col","gap-4","overflow-y-auto"],[1,"bg-white","dark:bg-slate-900","border","border-slate-200","dark:border-slate-800","rounded-xl","shadow-sm","p-6"],[1,"text-sm","font-semibold","text-slate-900","dark:text-white","mb-4","flex","items-center","gap-2"],[1,"space-y-2"],[1,"w-full","text-left","p-3","border","border-slate-200","dark:border-slate-700","rounded-lg","hover:border-primary","hover:bg-primary/5","transition-all","group"],[1,"space-y-3"],[1,"flex","items-center","justify-between"],[1,"w-16","h-16","bg-slate-100","dark:bg-slate-800","rounded-full","flex","items-center","justify-center","mb-4"],[1,"material-symbols-outlined","text-slate-400","text-[32px]"],[1,"text-lg","font-semibold","text-slate-900","dark:text-white","mb-2"],[1,"text-sm","text-slate-500","dark:text-slate-400","mb-4"],[1,"flex","gap-3",3,"flex-row-reverse"],[1,"w-8","h-8","rounded-full","flex","items-center","justify-center","flex-shrink-0"],[1,"material-symbols-outlined","text-[18px]"],[1,"flex","flex-col","gap-1","max-w-[75%]"],[1,"px-4","py-3","rounded-lg"],[1,"text-sm","leading-relaxed",3,"innerHTML"],[1,"text-sm","leading-relaxed"],[1,"flex","items-center","gap-2","px-2"],[1,"text-xs","text-slate-500"],[1,"text-xs","text-slate-400"],["title","Copy",1,"p-1","hover:bg-slate-100","dark:hover:bg-slate-800","rounded","transition-colors",3,"click"],[1,"material-symbols-outlined","text-slate-400","text-[14px]"],["title","Feedback",1,"p-1","hover:bg-slate-100","dark:hover:bg-slate-800","rounded","transition-colors"],[1,"w-8","h-8","rounded-full","bg-gradient-to-br","from-primary","to-primary/80","flex","items-center","justify-center","flex-shrink-0"],[1,"material-symbols-outlined","text-white","text-[18px]"],[1,"px-4","py-3","bg-gradient-to-br","from-primary","to-primary/90","rounded-lg"],[1,"flex","gap-1"],[1,"w-2","h-2","bg-white","rounded-full","animate-bounce",2,"animation-delay","0ms"],[1,"w-2","h-2","bg-white","rounded-full","animate-bounce",2,"animation-delay","150ms"],[1,"w-2","h-2","bg-white","rounded-full","animate-bounce",2,"animation-delay","300ms"],[1,"w-full","text-left","p-3","border","border-slate-200","dark:border-slate-700","rounded-lg","hover:border-primary","hover:bg-primary/5","transition-all","group",3,"click"],[1,"text-sm","font-medium","text-slate-900","dark:text-white","group-hover:text-primary","mb-1"],[1,"text-xs","text-slate-500","dark:text-slate-400","line-clamp-2"]],template:function(e,r){if(e&1){let l=A();i(0,"div",1)(1,"div",2)(2,"div")(3,"h1",3),o(4,"AI Customer Agent Sandbox"),n(),i(5,"p",4),o(6,"Test and train your AI customer service agent"),n()(),i(7,"div",5)(8,"button",6),b("click",function(){return x(l),h(r.clearConversation())}),i(9,"span",7),o(10,"delete"),n(),o(11," Clear "),n(),i(12,"button",8)(13,"span",7),o(14,"download"),n(),o(15," Export Chat "),n()()(),i(16,"div",9)(17,"div",10)(18,"div",11)(19,"div",12)(20,"div",13)(21,"div",14)(22,"span",15),o(23,"smart_toy"),n()(),k(24,"div",16),n(),i(25,"div")(26,"h3",17),o(27,"AI Agent (Brain Service)"),n(),i(28,"p",18),c(29,me,2,0,"span",19)(30,pe,2,0,"span",20),o(31),n()()(),i(32,"div",21),c(33,ce,2,1,"div",22),i(34,"div",23),o(35," Sandbox Mode "),n()()(),i(36,"div",24,0),c(38,xe,11,1,"div",25)(39,_e,2,0),c(40,Ce,9,0,"div",26),n(),i(41,"div",27)(42,"div",5)(43,"textarea",28),z("ngModelChange",function(p){return x(l),G(r.userInput,p)||(r.userInput=p),h(p)}),b("keydown.enter",function(p){return x(l),h(r.onKeyDown(p))}),n(),i(44,"button",29),b("click",function(){return x(l),h(r.sendMessage())}),i(45,"span",30),o(46,"send"),n()()()()(),i(47,"div",31)(48,"div",32)(49,"h3",33)(50,"span",7),o(51,"science"),n(),o(52," Test Scenarios "),n(),i(53,"div",34),M(54,we,5,2,"button",35,se),n()(),i(56,"div",32)(57,"h3",33)(58,"span",7),o(59,"analytics"),n(),o(60," Session Stats "),n(),i(61,"div",36)(62,"div",37)(63,"span",18),o(64,"Messages Sent"),n(),i(65,"span",17),o(66),n()(),i(67,"div",37)(68,"span",18),o(69,"Avg Response Time"),n(),i(70,"span",17),o(71),n()(),i(72,"div",37)(73,"span",18),o(74,"Model"),n(),i(75,"span",17),o(76),n()()()()()()()}e&2&&(s(29),u(r.isBrainConnected()?29:30),s(2),g(" \u2022 Model: ",r.selectedModel," "),s(2),u(r.brainConnectionError()?33:-1),s(5),u(r.messages().length===0?38:39),s(2),u(r.isTyping()?40:-1),s(3),Y("ngModel",r.userInput),s(),I("disabled",!r.userInput.trim()||r.isTyping()),s(10),E(r.testScenarios),s(12),y(r.messageCount()),s(5),y(r.avgResponseTime()),s(5),y(r.selectedModel))},dependencies:[J,ie,ee,te,ne,ae,re],encapsulation:2,changeDetection:0})};export{F as default};
