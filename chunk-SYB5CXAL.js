import{c as Vt}from"./chunk-TKVNSRWZ.js";import{$ as ao,A as he,C as $r,D as Qr,F as Jt,H as Cn,J as eo,K as to,L as no,N as it,O as ro,P as Pe,Q as oo,R as io,V as le,Y as xn,Z as F,_ as at,d as Rn,e as Yr,f as Wt,fa as so,h as ue,i as q,j as Ve,jc as jn,n as ot,oa as On,p as Mt,s as zt,u as In,w as Xr,x as Ht,xc as co,z as Te}from"./chunk-JKZ4R3JY.js";import{a as Tn,b as Pn}from"./chunk-2NFLSA4Y.js";function X(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var o=0;for(r=Object.getOwnPropertySymbols(n);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(n,r[o])&&(t[r[o]]=n[r[o]])}return t}var Ui={timeoutInSeconds:60},zo={name:"auth0-spa-js",version:"2.16.0"},Ho=()=>Date.now(),C=class n extends Error{constructor(e,t){super(t),this.error=e,this.error_description=t,Object.setPrototypeOf(this,n.prototype)}static fromPayload(e){let{error:t,error_description:r}=e;return new n(t,r)}},rn=class n extends C{constructor(e,t,r){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;super(e,t),this.state=r,this.appState=o,Object.setPrototypeOf(this,n.prototype)}},ir=class n extends C{constructor(e,t,r,o){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;super(e,t),this.connection=r,this.state=o,this.appState=i,Object.setPrototypeOf(this,n.prototype)}},Ne=class n extends C{constructor(){super("timeout","Timeout"),Object.setPrototypeOf(this,n.prototype)}},on=class n extends Ne{constructor(e){super(),this.popup=e,Object.setPrototypeOf(this,n.prototype)}},an=class n extends C{constructor(e){super("cancelled","Popup closed"),this.popup=e,Object.setPrototypeOf(this,n.prototype)}},ar=class n extends C{constructor(){super("popup_open","Unable to open a popup for loginWithPopup - window.open returned `null`"),Object.setPrototypeOf(this,n.prototype)}},We=class n extends C{constructor(e,t,r,o){super(e,t),this.mfa_token=r,this.mfa_requirements=o,Object.setPrototypeOf(this,n.prototype)}},wt=class n extends C{constructor(e,t){super("missing_refresh_token","Missing Refresh Token (audience: '".concat(sn(e,["default"]),"', scope: '").concat(sn(t),"')")),this.audience=e,this.scope=t,Object.setPrototypeOf(this,n.prototype)}},sr=class n extends C{constructor(e,t){super("missing_scopes","Missing requested scopes after refresh (audience: '".concat(sn(e,["default"]),"', missing scope: '").concat(sn(t),"')")),this.audience=e,this.scope=t,Object.setPrototypeOf(this,n.prototype)}},vt=class n extends C{constructor(e){super("use_dpop_nonce","Server rejected DPoP proof: wrong nonce"),this.newDpopNonce=e,Object.setPrototypeOf(this,n.prototype)}};function sn(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return n&&!e.includes(n)?n:""}var cn=()=>window.crypto,st=()=>{let n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~.",e="";return Array.from(cn().getRandomValues(new Uint8Array(43))).forEach(t=>e+=n[t%n.length]),e},Dn=n=>btoa(n),Ki=[{key:"name",type:["string"]},{key:"version",type:["string","number"]},{key:"env",type:["object"]}],Jo=function(n){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return Object.keys(n).reduce((t,r)=>{if(e&&r==="env")return t;let o=Ki.find(i=>i.key===r);return o&&o.type.includes(typeof n[r])&&(t[r]=n[r]),t},{})},cr=n=>{var{clientId:e}=n,t=X(n,["clientId"]);return new URLSearchParams((r=>Object.keys(r).filter(o=>r[o]!==void 0).reduce((o,i)=>Object.assign(Object.assign({},o),{[i]:r[i]}),{}))(Object.assign({client_id:e},t))).toString()},uo=async n=>await cn().subtle.digest({name:"SHA-256"},new TextEncoder().encode(n)),ho=n=>(e=>decodeURIComponent(atob(e).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))(n.replace(/_/g,"/").replace(/-/g,"+")),lo=n=>{let e=new Uint8Array(n);return(t=>{let r={"+":"-","/":"_","=":""};return t.replace(/[+/=]/g,o=>r[o])})(window.btoa(String.fromCharCode(...Array.from(e))))},Me=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Vo={},Mr={};Object.defineProperty(Mr,"__esModule",{value:!0});var Ni=(function(){function n(){var e=this;this.locked=new Map,this.addToLocked=function(t,r){var o=e.locked.get(t);o===void 0?r===void 0?e.locked.set(t,[]):e.locked.set(t,[r]):r!==void 0&&(o.unshift(r),e.locked.set(t,o))},this.isLocked=function(t){return e.locked.has(t)},this.lock=function(t){return new Promise(function(r,o){e.isLocked(t)?e.addToLocked(t,r):(e.addToLocked(t),r())})},this.unlock=function(t){var r=e.locked.get(t);if(r!==void 0&&r.length!==0){var o=r.pop();e.locked.set(t,r),o!==void 0&&setTimeout(o,0)}else e.locked.delete(t)}}return n.getInstance=function(){return n.instance===void 0&&(n.instance=new n),n.instance},n})();Mr.default=function(){return Ni.getInstance()};var $=Me&&Me.__awaiter||function(n,e,t,r){return new(t||(t=Promise))(function(o,i){function a(u){try{c(r.next(u))}catch(h){i(h)}}function s(u){try{c(r.throw(u))}catch(h){i(h)}}function c(u){u.done?o(u.value):new t(function(h){h(u.value)}).then(a,s)}c((r=r.apply(n,e||[])).next())})},Q=Me&&Me.__generator||function(n,e){var t,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function s(c){return function(u){return(function(h){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,r&&(o=2&h[0]?r.return:h[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,h[1])).done)return o;switch(r=0,o&&(h=[2&h[0],o.value]),h[0]){case 0:case 1:o=h;break;case 4:return a.label++,{value:h[1],done:!1};case 5:a.label++,r=h[1],h=[0];continue;case 7:h=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!((o=o.length>0&&o[o.length-1])||h[0]!==6&&h[0]!==2)){a=0;continue}if(h[0]===3&&(!o||h[1]>o[0]&&h[1]<o[3])){a.label=h[1];break}if(h[0]===6&&a.label<o[1]){a.label=o[1],o=h;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(h);break}o[2]&&a.ops.pop(),a.trys.pop();continue}h=e.call(n,a)}catch(f){h=[6,f],r=0}finally{t=o=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}})([c,u])}}},ct=Me;Object.defineProperty(Vo,"__esModule",{value:!0});var Fe=Mr,Ft={key:function(n){return $(ct,void 0,void 0,function(){return Q(this,function(e){throw new Error("Unsupported")})})},getItem:function(n){return $(ct,void 0,void 0,function(){return Q(this,function(e){throw new Error("Unsupported")})})},clear:function(){return $(ct,void 0,void 0,function(){return Q(this,function(n){return[2,window.localStorage.clear()]})})},removeItem:function(n){return $(ct,void 0,void 0,function(){return Q(this,function(e){throw new Error("Unsupported")})})},setItem:function(n,e){return $(ct,void 0,void 0,function(){return Q(this,function(t){throw new Error("Unsupported")})})},keySync:function(n){return window.localStorage.key(n)},getItemSync:function(n){return window.localStorage.getItem(n)},clearSync:function(){return window.localStorage.clear()},removeItemSync:function(n){return window.localStorage.removeItem(n)},setItemSync:function(n,e){return window.localStorage.setItem(n,e)}};function Ln(n){return new Promise(function(e){return setTimeout(e,n)})}function Un(n){for(var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",t="",r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}var Wi=(function(){function n(e){this.acquiredIatSet=new Set,this.storageHandler=void 0,this.id=Date.now().toString()+Un(15),this.acquireLock=this.acquireLock.bind(this),this.releaseLock=this.releaseLock.bind(this),this.releaseLock__private__=this.releaseLock__private__.bind(this),this.waitForSomethingToChange=this.waitForSomethingToChange.bind(this),this.refreshLockWhileAcquired=this.refreshLockWhileAcquired.bind(this),this.storageHandler=e,n.waiters===void 0&&(n.waiters=[])}return n.prototype.acquireLock=function(e,t){return t===void 0&&(t=5e3),$(this,void 0,void 0,function(){var r,o,i,a,s,c,u;return Q(this,function(h){switch(h.label){case 0:r=Date.now()+Un(4),o=Date.now()+t,i="browser-tabs-lock-key-"+e,a=this.storageHandler===void 0?Ft:this.storageHandler,h.label=1;case 1:return Date.now()<o?[4,Ln(30)]:[3,8];case 2:return h.sent(),a.getItemSync(i)!==null?[3,5]:(s=this.id+"-"+e+"-"+r,[4,Ln(Math.floor(25*Math.random()))]);case 3:return h.sent(),a.setItemSync(i,JSON.stringify({id:this.id,iat:r,timeoutKey:s,timeAcquired:Date.now(),timeRefreshed:Date.now()})),[4,Ln(30)];case 4:return h.sent(),(c=a.getItemSync(i))!==null&&(u=JSON.parse(c)).id===this.id&&u.iat===r?(this.acquiredIatSet.add(r),this.refreshLockWhileAcquired(i,r),[2,!0]):[3,7];case 5:return n.lockCorrector(this.storageHandler===void 0?Ft:this.storageHandler),[4,this.waitForSomethingToChange(o)];case 6:h.sent(),h.label=7;case 7:return r=Date.now()+Un(4),[3,1];case 8:return[2,!1]}})})},n.prototype.refreshLockWhileAcquired=function(e,t){return $(this,void 0,void 0,function(){var r=this;return Q(this,function(o){return setTimeout(function(){return $(r,void 0,void 0,function(){var i,a,s;return Q(this,function(c){switch(c.label){case 0:return[4,Fe.default().lock(t)];case 1:return c.sent(),this.acquiredIatSet.has(t)?(i=this.storageHandler===void 0?Ft:this.storageHandler,(a=i.getItemSync(e))===null?(Fe.default().unlock(t),[2]):((s=JSON.parse(a)).timeRefreshed=Date.now(),i.setItemSync(e,JSON.stringify(s)),Fe.default().unlock(t),this.refreshLockWhileAcquired(e,t),[2])):(Fe.default().unlock(t),[2])}})})},1e3),[2]})})},n.prototype.waitForSomethingToChange=function(e){return $(this,void 0,void 0,function(){return Q(this,function(t){switch(t.label){case 0:return[4,new Promise(function(r){var o=!1,i=Date.now(),a=!1;function s(){if(a||(window.removeEventListener("storage",s),n.removeFromWaiting(s),clearTimeout(c),a=!0),!o){o=!0;var u=50-(Date.now()-i);u>0?setTimeout(r,u):r(null)}}window.addEventListener("storage",s),n.addToWaiting(s);var c=setTimeout(s,Math.max(0,e-Date.now()))})];case 1:return t.sent(),[2]}})})},n.addToWaiting=function(e){this.removeFromWaiting(e),n.waiters!==void 0&&n.waiters.push(e)},n.removeFromWaiting=function(e){n.waiters!==void 0&&(n.waiters=n.waiters.filter(function(t){return t!==e}))},n.notifyWaiters=function(){n.waiters!==void 0&&n.waiters.slice().forEach(function(e){return e()})},n.prototype.releaseLock=function(e){return $(this,void 0,void 0,function(){return Q(this,function(t){switch(t.label){case 0:return[4,this.releaseLock__private__(e)];case 1:return[2,t.sent()]}})})},n.prototype.releaseLock__private__=function(e){return $(this,void 0,void 0,function(){var t,r,o,i;return Q(this,function(a){switch(a.label){case 0:return t=this.storageHandler===void 0?Ft:this.storageHandler,r="browser-tabs-lock-key-"+e,(o=t.getItemSync(r))===null?[2]:(i=JSON.parse(o)).id!==this.id?[3,2]:[4,Fe.default().lock(i.iat)];case 1:a.sent(),this.acquiredIatSet.delete(i.iat),t.removeItemSync(r),Fe.default().unlock(i.iat),n.notifyWaiters(),a.label=2;case 2:return[2]}})})},n.lockCorrector=function(e){for(var t=Date.now()-5e3,r=e,o=[],i=0;;){var a=r.keySync(i);if(a===null)break;o.push(a),i++}for(var s=!1,c=0;c<o.length;c++){var u=o[c];if(u.includes("browser-tabs-lock-key")){var h=r.getItemSync(u);if(h!==null){var f=JSON.parse(h);(f.timeRefreshed===void 0&&f.timeAcquired<t||f.timeRefreshed!==void 0&&f.timeRefreshed<t)&&(r.removeItemSync(u),s=!0)}}}s&&n.notifyWaiters()},n.waiters=void 0,n})(),Mi=Vo.default=Wi,ur=class{async runWithLock(e,t,r){let o=new AbortController,i=setTimeout(()=>o.abort(),t);try{return await navigator.locks.request(e,{mode:"exclusive",signal:o.signal},async a=>{if(clearTimeout(i),!a)throw new Error("Lock not available");return await r()})}catch(a){throw clearTimeout(i),a?.name==="AbortError"?new Ne:a}}},hr=class{constructor(){this.activeLocks=new Set,this.lock=new Mi,this.pagehideHandler=()=>{this.activeLocks.forEach(e=>this.lock.releaseLock(e)),this.activeLocks.clear()}}async runWithLock(e,t,r){let o=!1;for(let i=0;i<10&&!o;i++)o=await this.lock.acquireLock(e,t);if(!o)throw new Ne;this.activeLocks.add(e),this.activeLocks.size===1&&typeof window<"u"&&window.addEventListener("pagehide",this.pagehideHandler);try{return await r()}finally{this.activeLocks.delete(e),await this.lock.releaseLock(e),this.activeLocks.size===0&&typeof window<"u"&&window.removeEventListener("pagehide",this.pagehideHandler)}}};function zi(){return typeof navigator<"u"&&typeof((n=navigator.locks)===null||n===void 0?void 0:n.request)=="function"?new ur:new hr;var n}var Kn=null,Hi=new TextEncoder,Ji=new TextDecoder;function pt(n){return typeof n=="string"?Hi.encode(n):Ji.decode(n)}function po(n){if(typeof n.modulusLength!="number"||n.modulusLength<2048)throw new dr(`${n.name} modulusLength must be at least 2048 bits`)}async function Vi(n,e,t){if(t.usages.includes("sign")===!1)throw new TypeError('private CryptoKey instances used for signing assertions must include "sign" in their "usages"');let r=`${ft(pt(JSON.stringify(n)))}.${ft(pt(JSON.stringify(e)))}`;return`${r}.${ft(await crypto.subtle.sign((function(o){switch(o.algorithm.name){case"ECDSA":return{name:o.algorithm.name,hash:"SHA-256"};case"RSA-PSS":return po(o.algorithm),{name:o.algorithm.name,saltLength:32};case"RSASSA-PKCS1-v1_5":return po(o.algorithm),{name:o.algorithm.name};case"Ed25519":return{name:o.algorithm.name}}throw new pe})(t),t,pt(r)))}`}var lr;Uint8Array.prototype.toBase64?lr=n=>(n instanceof ArrayBuffer&&(n=new Uint8Array(n)),n.toBase64({alphabet:"base64url",omitPadding:!0})):lr=e=>{e instanceof ArrayBuffer&&(e=new Uint8Array(e));let t=[];for(let r=0;r<e.byteLength;r+=32768)t.push(String.fromCharCode.apply(null,e.subarray(r,r+32768)));return btoa(t.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")};function ft(n){return lr(n)}var pe=class extends Error{constructor(e){var t;super(e??"operation not supported"),this.name=this.constructor.name,(t=Error.captureStackTrace)===null||t===void 0||t.call(Error,this,this.constructor)}},dr=class extends Error{constructor(e){var t;super(e),this.name=this.constructor.name,(t=Error.captureStackTrace)===null||t===void 0||t.call(Error,this,this.constructor)}};function Fi(n){switch(n.algorithm.name){case"RSA-PSS":return(function(e){if(e.algorithm.hash.name==="SHA-256")return"PS256";throw new pe("unsupported RsaHashedKeyAlgorithm hash name")})(n);case"RSASSA-PKCS1-v1_5":return(function(e){if(e.algorithm.hash.name==="SHA-256")return"RS256";throw new pe("unsupported RsaHashedKeyAlgorithm hash name")})(n);case"ECDSA":return(function(e){if(e.algorithm.namedCurve==="P-256")return"ES256";throw new pe("unsupported EcKeyAlgorithm namedCurve")})(n);case"Ed25519":return"Ed25519";default:throw new pe("unsupported CryptoKey algorithm name")}}function Fo(n){return n instanceof CryptoKey}function Go(n){return Fo(n)&&n.type==="public"}async function Gi(n,e,t,r,o,i){let a=n?.privateKey,s=n?.publicKey;if(!Fo(c=a)||c.type!=="private")throw new TypeError('"keypair.privateKey" must be a private CryptoKey');var c;if(!Go(s))throw new TypeError('"keypair.publicKey" must be a public CryptoKey');if(s.extractable!==!0)throw new TypeError('"keypair.publicKey.extractable" must be true');if(typeof e!="string")throw new TypeError('"htu" must be a string');if(typeof t!="string")throw new TypeError('"htm" must be a string');if(r!==void 0&&typeof r!="string")throw new TypeError('"nonce" must be a string or undefined');if(o!==void 0&&typeof o!="string")throw new TypeError('"accessToken" must be a string or undefined');if(i!==void 0&&(typeof i!="object"||i===null||Array.isArray(i)))throw new TypeError('"additional" must be an object');return Vi({alg:Fi(a),typ:"dpop+jwt",jwk:await Zo(s)},Object.assign(Object.assign({},i),{iat:Math.floor(Date.now()/1e3),jti:crypto.randomUUID(),htm:t,nonce:r,htu:e,ath:o?ft(await crypto.subtle.digest("SHA-256",pt(o))):void 0}),a)}async function Zo(n){let{kty:e,e:t,n:r,x:o,y:i,crv:a}=await crypto.subtle.exportKey("jwk",n);return{kty:e,crv:a,e:t,n:r,x:o,y:i}}var Zi=["authorization_code","refresh_token","urn:ietf:params:oauth:grant-type:token-exchange","http://auth0.com/oauth/grant-type/mfa-oob","http://auth0.com/oauth/grant-type/mfa-otp","http://auth0.com/oauth/grant-type/mfa-recovery-code"];function qi(){return(async function(n,e){var t;let r;if(typeof n!="string"||n.length===0)throw new TypeError('"alg" must be a non-empty string');switch(n){case"PS256":r={name:"RSA-PSS",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"RS256":r={name:"RSASSA-PKCS1-v1_5",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"ES256":r={name:"ECDSA",namedCurve:"P-256"};break;case"Ed25519":r={name:"Ed25519"};break;default:throw new pe}return crypto.subtle.generateKey(r,(t=e?.extractable)!==null&&t!==void 0&&t,["sign","verify"])})("ES256",{extractable:!1})}function Bi(n){return(async function(e){if(!Go(e))throw new TypeError('"publicKey" must be a public CryptoKey');if(e.extractable!==!0)throw new TypeError('"publicKey.extractable" must be true');let t=await Zo(e),r;switch(t.kty){case"EC":r={crv:t.crv,kty:t.kty,x:t.x,y:t.y};break;case"OKP":r={crv:t.crv,kty:t.kty,x:t.x};break;case"RSA":r={e:t.e,kty:t.kty,n:t.n};break;default:throw new pe("unsupported JWK kty")}return ft(await crypto.subtle.digest({name:"SHA-256"},pt(JSON.stringify(r))))})(n.publicKey)}function Yi(n){let{keyPair:e,url:t,method:r,nonce:o,accessToken:i}=n,a=(function(s){let c=new URL(s);return c.search="",c.hash="",c.href})(t);return Gi(e,a,r,o,i)}var Xi=async(n,e)=>{let t=await fetch(n,e);return{ok:t.ok,json:await t.json(),headers:(r=t.headers,[...r].reduce((o,i)=>{let[a,s]=i;return o[a]=s,o},{}))};var r},$i=async(n,e,t)=>{let r=new AbortController,o;return e.signal=r.signal,Promise.race([Xi(n,e),new Promise((i,a)=>{o=setTimeout(()=>{r.abort(),a(new Error("Timeout when executing 'fetch'"))},t)})]).finally(()=>{clearTimeout(o)})},Qi=async(n,e,t,r,o,i,a,s)=>((c,u)=>new Promise(function(h,f){let l=new MessageChannel;l.port1.onmessage=function(d){d.data.error?f(new Error(d.data.error)):h(d.data),l.port1.close()},u.postMessage(c,[l.port2])}))({auth:{audience:e,scope:t},timeout:o,fetchUrl:n,fetchOptions:r,useFormData:a,useMrrt:s},i),ea=async function(n,e,t,r,o,i){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:1e4,s=arguments.length>7?arguments[7]:void 0;return o?Qi(n,e,t,r,a,o,i,s):$i(n,r,a)};async function qo(n,e,t,r,o,i,a,s,c,u){if(c){let k=await c.generateProof({url:n,method:o.method||"GET",nonce:await c.getNonce()});o.headers=Object.assign(Object.assign({},o.headers),{dpop:k})}let h,f=null;for(let k=0;k<3;k++)try{h=await ea(n,t,r,o,i,a,e,s),f=null;break}catch(E){f=E}if(f)throw f;let l=h.json,{error:d,error_description:w}=l,p=X(l,["error","error_description"]),{headers:m,ok:y}=h,b;if(c&&(b=m["dpop-nonce"],b&&await c.setNonce(b)),!y){let k=w||"HTTP error. Unable to fetch ".concat(n);if(d==="mfa_required")throw new We(d,k,p.mfa_token,p.mfa_requirements);if(d==="missing_refresh_token")throw new wt(t,r);if(d==="use_dpop_nonce"){if(!c||!b||u)throw new vt(b);return qo(n,e,t,r,o,i,a,s,c,!0)}throw new C(d||"request_error",k)}return p}async function ta(n,e){var{baseUrl:t,timeout:r,audience:o,scope:i,auth0Client:a,useFormData:s,useMrrt:c,dpop:u}=n,h=X(n,["baseUrl","timeout","audience","scope","auth0Client","useFormData","useMrrt","dpop"]);let f=h.grant_type==="urn:ietf:params:oauth:grant-type:token-exchange",l=h.grant_type==="refresh_token"&&c,d=Object.assign(Object.assign(Object.assign(Object.assign({},h),f&&o&&{audience:o}),f&&i&&{scope:i}),l&&{audience:o,scope:i}),w=s?cr(d):JSON.stringify(d),p=(m=h.grant_type,Zi.includes(m));var m;return await qo("".concat(t,"/oauth/token"),r,o||"default",i,{method:"POST",body:w,headers:{"Content-Type":s?"application/x-www-form-urlencoded":"application/json","Auth0-Client":btoa(JSON.stringify(Jo(a||zo)))}},e,s,c,p?u:void 0)}var na=n=>Array.from(new Set(n)),en=function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return na(e.filter(Boolean).join(" ").trim().split(/\s+/)).join(" ")},Gt=(n,e,t)=>{let r;return t&&(r=n[t]),r||(r=n.default),en(r,e)},ee=class n{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"@@auth0spajs@@",r=arguments.length>2?arguments[2]:void 0;this.prefix=t,this.suffix=r,this.clientId=e.clientId,this.scope=e.scope,this.audience=e.audience}toKey(){return[this.prefix,this.clientId,this.audience,this.scope,this.suffix].filter(Boolean).join("::")}static fromKey(e){let[t,r,o,i]=e.split("::");return new n({clientId:r,scope:i,audience:o},t)}static fromCacheEntry(e){let{scope:t,audience:r,client_id:o}=e;return new n({scope:t,audience:r,clientId:o})}},un=class{set(e,t){localStorage.setItem(e,JSON.stringify(t))}get(e){let t=window.localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch{return}}remove(e){localStorage.removeItem(e)}allKeys(){return Object.keys(window.localStorage).filter(e=>e.startsWith("@@auth0spajs@@"))}},bt=class{constructor(){this.enclosedCache=(function(){let e={};return{set(t,r){e[t]=r},get(t){let r=e[t];if(r)return r},remove(t){delete e[t]},allKeys:()=>Object.keys(e)}})()}},pr=class{constructor(e,t,r){this.cache=e,this.keyManifest=t,this.nowProvider=r||Ho}async setIdToken(e,t,r){var o;let i=this.getIdTokenCacheKey(e);await this.cache.set(i,{id_token:t,decodedToken:r}),await((o=this.keyManifest)===null||o===void 0?void 0:o.add(i))}async getIdToken(e){let t=await this.cache.get(this.getIdTokenCacheKey(e.clientId));if(!t&&e.scope&&e.audience){let r=await this.get(e);return!r||!r.id_token||!r.decodedToken?void 0:{id_token:r.id_token,decodedToken:r.decodedToken}}if(t)return{id_token:t.id_token,decodedToken:t.decodedToken}}async get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],o=arguments.length>3?arguments[3]:void 0;var i;let a=await this.cache.get(e.toKey());if(!a){let u=await this.getCacheKeys();if(!u)return;let h=this.matchExistingCacheKey(e,u);if(h&&(a=await this.cache.get(h)),!a&&r&&o!=="cache-only")return this.getEntryWithRefreshToken(e,u)}if(!a)return;let s=await this.nowProvider(),c=Math.floor(s/1e3);return a.expiresAt-t<c?a.body.refresh_token?this.modifiedCachedEntry(a,e):(await this.cache.remove(e.toKey()),void await((i=this.keyManifest)===null||i===void 0?void 0:i.remove(e.toKey()))):a.body}async modifiedCachedEntry(e,t){return e.body={refresh_token:e.body.refresh_token,audience:e.body.audience,scope:e.body.scope},await this.cache.set(t.toKey(),e),{refresh_token:e.body.refresh_token,audience:e.body.audience,scope:e.body.scope}}async set(e){var t;let r=new ee({clientId:e.client_id,scope:e.scope,audience:e.audience}),o=await this.wrapCacheEntry(e);await this.cache.set(r.toKey(),o),await((t=this.keyManifest)===null||t===void 0?void 0:t.add(r.toKey()))}async remove(e,t,r){let o=new ee({clientId:e,scope:r,audience:t});await this.cache.remove(o.toKey())}async clear(e){var t;let r=await this.getCacheKeys();r&&(await r.filter(o=>!e||o.includes(e)).reduce(async(o,i)=>{await o,await this.cache.remove(i)},Promise.resolve()),await((t=this.keyManifest)===null||t===void 0?void 0:t.clear()))}async wrapCacheEntry(e){let t=await this.nowProvider();return{body:e,expiresAt:Math.floor(t/1e3)+e.expires_in}}async getCacheKeys(){var e;return this.keyManifest?(e=await this.keyManifest.get())===null||e===void 0?void 0:e.keys:this.cache.allKeys?this.cache.allKeys():void 0}getIdTokenCacheKey(e){return new ee({clientId:e},"@@auth0spajs@@","@@user@@").toKey()}matchExistingCacheKey(e,t){return t.filter(r=>{var o;let i=ee.fromKey(r),a=new Set(i.scope&&i.scope.split(" ")),s=((o=e.scope)===null||o===void 0?void 0:o.split(" "))||[],c=i.scope&&s.reduce((u,h)=>u&&a.has(h),!0);return i.prefix==="@@auth0spajs@@"&&i.clientId===e.clientId&&i.audience===e.audience&&c})[0]}async getEntryWithRefreshToken(e,t){var r;for(let o of t){let i=ee.fromKey(o);if(i.prefix==="@@auth0spajs@@"&&i.clientId===e.clientId){let a=await this.cache.get(o);if(!((r=a?.body)===null||r===void 0)&&r.refresh_token)return this.modifiedCachedEntry(a,e)}}}async updateEntry(e,t){var r;let o=await this.getCacheKeys();if(o)for(let i of o){let a=await this.cache.get(i);((r=a?.body)===null||r===void 0?void 0:r.refresh_token)===e&&(a.body.refresh_token=t,await this.cache.set(i,a))}}},fr=class{constructor(e,t,r){this.storage=e,this.clientId=t,this.cookieDomain=r,this.storageKey="".concat("a0.spajs.txs",".").concat(this.clientId)}create(e){this.storage.save(this.storageKey,e,{daysUntilExpire:1,cookieDomain:this.cookieDomain})}get(){return this.storage.get(this.storageKey)}remove(){this.storage.remove(this.storageKey,{cookieDomain:this.cookieDomain})}},ut=n=>typeof n=="number",ra=["iss","aud","exp","nbf","iat","jti","azp","nonce","auth_time","at_hash","c_hash","acr","amr","sub_jwk","cnf","sip_from_tag","sip_date","sip_callid","sip_cseq_num","sip_via_branch","orig","dest","mky","events","toe","txn","rph","sid","vot","vtm"],oa=n=>{if(!n.id_token)throw new Error("ID token is required but missing");let e=(i=>{let a=i.split("."),[s,c,u]=a;if(a.length!==3||!s||!c||!u)throw new Error("ID token could not be decoded");let h=JSON.parse(ho(c)),f={__raw:i},l={};return Object.keys(h).forEach(d=>{f[d]=h[d],ra.includes(d)||(l[d]=h[d])}),{encoded:{header:s,payload:c,signature:u},header:JSON.parse(ho(s)),claims:f,user:l}})(n.id_token);if(!e.claims.iss)throw new Error("Issuer (iss) claim must be a string present in the ID token");if(e.claims.iss!==n.iss)throw new Error('Issuer (iss) claim mismatch in the ID token; expected "'.concat(n.iss,'", found "').concat(e.claims.iss,'"'));if(!e.user.sub)throw new Error("Subject (sub) claim must be a string present in the ID token");if(e.header.alg!=="RS256")throw new Error('Signature algorithm of "'.concat(e.header.alg,'" is not supported. Expected the ID token to be signed with "RS256".'));if(!e.claims.aud||typeof e.claims.aud!="string"&&!Array.isArray(e.claims.aud))throw new Error("Audience (aud) claim must be a string or array of strings present in the ID token");if(Array.isArray(e.claims.aud)){if(!e.claims.aud.includes(n.aud))throw new Error('Audience (aud) claim mismatch in the ID token; expected "'.concat(n.aud,'" but was not one of "').concat(e.claims.aud.join(", "),'"'));if(e.claims.aud.length>1){if(!e.claims.azp)throw new Error("Authorized Party (azp) claim must be a string present in the ID token when Audience (aud) claim has multiple values");if(e.claims.azp!==n.aud)throw new Error('Authorized Party (azp) claim mismatch in the ID token; expected "'.concat(n.aud,'", found "').concat(e.claims.azp,'"'))}}else if(e.claims.aud!==n.aud)throw new Error('Audience (aud) claim mismatch in the ID token; expected "'.concat(n.aud,'" but found "').concat(e.claims.aud,'"'));if(n.nonce){if(!e.claims.nonce)throw new Error("Nonce (nonce) claim must be a string present in the ID token");if(e.claims.nonce!==n.nonce)throw new Error('Nonce (nonce) claim mismatch in the ID token; expected "'.concat(n.nonce,'", found "').concat(e.claims.nonce,'"'))}if(n.max_age&&!ut(e.claims.auth_time))throw new Error("Authentication Time (auth_time) claim must be a number present in the ID token when Max Age (max_age) is specified");if(e.claims.exp==null||!ut(e.claims.exp))throw new Error("Expiration Time (exp) claim must be a number present in the ID token");if(!ut(e.claims.iat))throw new Error("Issued At (iat) claim must be a number present in the ID token");let t=n.leeway||60,r=new Date(n.now||Date.now()),o=new Date(0);if(o.setUTCSeconds(e.claims.exp+t),r>o)throw new Error("Expiration Time (exp) claim error in the ID token; current time (".concat(r,") is after expiration time (").concat(o,")"));if(e.claims.nbf!=null&&ut(e.claims.nbf)){let i=new Date(0);if(i.setUTCSeconds(e.claims.nbf-t),r<i)throw new Error("Not Before time (nbf) claim in the ID token indicates that this token can't be used just yet. Current time (".concat(r,") is before ").concat(i))}if(e.claims.auth_time!=null&&ut(e.claims.auth_time)){let i=new Date(0);if(i.setUTCSeconds(parseInt(e.claims.auth_time)+n.max_age+t),r>i)throw new Error("Authentication Time (auth_time) claim in the ID token indicates that too much time has passed since the last end-user authentication. Current time (".concat(r,") is after last auth at ").concat(i))}if(n.organization){let i=n.organization.trim();if(i.startsWith("org_")){let a=i;if(!e.claims.org_id)throw new Error("Organization ID (org_id) claim must be a string present in the ID token");if(a!==e.claims.org_id)throw new Error('Organization ID (org_id) claim mismatch in the ID token; expected "'.concat(a,'", found "').concat(e.claims.org_id,'"'))}else{let a=i.toLowerCase();if(!e.claims.org_name)throw new Error("Organization Name (org_name) claim must be a string present in the ID token");if(a!==e.claims.org_name)throw new Error('Organization Name (org_name) claim mismatch in the ID token; expected "'.concat(a,'", found "').concat(e.claims.org_name,'"'))}}return e},_t=Me&&Me.__assign||function(){return _t=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},_t.apply(this,arguments)};function ht(n,e){if(!e)return"";var t="; "+n;return e===!0?t:t+"="+e}function ia(n,e,t){return encodeURIComponent(n).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/\(/g,"%28").replace(/\)/g,"%29")+"="+encodeURIComponent(e).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)+(function(r){if(typeof r.expires=="number"){var o=new Date;o.setMilliseconds(o.getMilliseconds()+864e5*r.expires),r.expires=o}return ht("Expires",r.expires?r.expires.toUTCString():"")+ht("Domain",r.domain)+ht("Path",r.path)+ht("Secure",r.secure)+ht("SameSite",r.sameSite)})(t)}function aa(){return(function(n){for(var e={},t=n?n.split("; "):[],r=/(%[\dA-F]{2})+/gi,o=0;o<t.length;o++){var i=t[o].split("="),a=i.slice(1).join("=");a.charAt(0)==='"'&&(a=a.slice(1,-1));try{e[i[0].replace(r,decodeURIComponent)]=a.replace(r,decodeURIComponent)}catch{}}return e})(document.cookie)}var sa=function(n){return aa()[n]};function Bo(n,e,t){document.cookie=ia(n,e,_t({path:"/"},t))}var Yo=Bo,Xo=function(n,e){Bo(n,"",_t(_t({},e),{expires:-1}))},qe={get(n){let e=sa(n);if(e!==void 0)return JSON.parse(e)},save(n,e,t){let r={};window.location.protocol==="https:"&&(r={secure:!0,sameSite:"none"}),t?.daysUntilExpire&&(r.expires=t.daysUntilExpire),t?.cookieDomain&&(r.domain=t.cookieDomain),Yo(n,JSON.stringify(e),r)},remove(n,e){let t={};e?.cookieDomain&&(t.domain=e.cookieDomain),Xo(n,t)}},ca={get(n){return qe.get(n)||qe.get("".concat("_legacy_").concat(n))},save(n,e,t){let r={};window.location.protocol==="https:"&&(r={secure:!0}),t?.daysUntilExpire&&(r.expires=t.daysUntilExpire),t?.cookieDomain&&(r.domain=t.cookieDomain),Yo("".concat("_legacy_").concat(n),JSON.stringify(e),r),qe.save(n,e,t)},remove(n,e){let t={};e?.cookieDomain&&(t.domain=e.cookieDomain),Xo(n,t),qe.remove(n,e),qe.remove("".concat("_legacy_").concat(n),e)}},ua={get(n){if(typeof sessionStorage>"u")return;let e=sessionStorage.getItem(n);return e!=null?JSON.parse(e):void 0},save(n,e){sessionStorage.setItem(n,JSON.stringify(e))},remove(n){sessionStorage.removeItem(n)}},Le;(function(n){n.Code="code",n.ConnectCode="connect_code"})(Le||(Le={}));function ha(n,e,t){var r=e===void 0?null:e,o=(function(c,u){var h=atob(c);if(u){for(var f=new Uint8Array(h.length),l=0,d=h.length;l<d;++l)f[l]=h.charCodeAt(l);return String.fromCharCode.apply(null,new Uint16Array(f.buffer))}return h})(n,t!==void 0&&t),i=o.indexOf(`
`,10)+1,a=o.substring(i)+(r?"//# sourceMappingURL="+r:""),s=new Blob([a],{type:"application/javascript"});return URL.createObjectURL(s)}var fo,mo,yo,Nn,la=(fo="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7Y2xhc3MgZSBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKHQscil7c3VwZXIociksdGhpcy5lcnJvcj10LHRoaXMuZXJyb3JfZGVzY3JpcHRpb249cixPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcyxlLnByb3RvdHlwZSl9c3RhdGljIGZyb21QYXlsb2FkKHQpe2xldHtlcnJvcjpyLGVycm9yX2Rlc2NyaXB0aW9uOnN9PXQ7cmV0dXJuIG5ldyBlKHIscyl9fWNsYXNzIHQgZXh0ZW5kcyBle2NvbnN0cnVjdG9yKGUscyl7c3VwZXIoIm1pc3NpbmdfcmVmcmVzaF90b2tlbiIsIk1pc3NpbmcgUmVmcmVzaCBUb2tlbiAoYXVkaWVuY2U6ICciLmNvbmNhdChyKGUsWyJkZWZhdWx0Il0pLCInLCBzY29wZTogJyIpLmNvbmNhdChyKHMpLCInKSIpKSx0aGlzLmF1ZGllbmNlPWUsdGhpcy5zY29wZT1zLE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLHQucHJvdG90eXBlKX19ZnVuY3Rpb24gcihlKXtsZXQgdD1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06W107cmV0dXJuIGUmJiF0LmluY2x1ZGVzKGUpP2U6IiJ9ImZ1bmN0aW9uIj09dHlwZW9mIFN1cHByZXNzZWRFcnJvciYmU3VwcHJlc3NlZEVycm9yO2NvbnN0IHM9ZT0+e3ZhcntjbGllbnRJZDp0fT1lLHI9ZnVuY3Rpb24oZSx0KXt2YXIgcj17fTtmb3IodmFyIHMgaW4gZSlPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSxzKSYmdC5pbmRleE9mKHMpPDAmJihyW3NdPWVbc10pO2lmKG51bGwhPWUmJiJmdW5jdGlvbiI9PXR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgbz0wO2ZvcihzPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7bzxzLmxlbmd0aDtvKyspdC5pbmRleE9mKHNbb10pPDAmJk9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChlLHNbb10pJiYocltzW29dXT1lW3Nbb11dKX1yZXR1cm4gcn0oZSxbImNsaWVudElkIl0pO3JldHVybiBuZXcgVVJMU2VhcmNoUGFyYW1zKChlPT5PYmplY3Qua2V5cyhlKS5maWx0ZXIoKHQ9PnZvaWQgMCE9PWVbdF0pKS5yZWR1Y2UoKCh0LHIpPT5PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sdCkse1tyXTplW3JdfSkpLHt9KSkoT2JqZWN0LmFzc2lnbih7Y2xpZW50X2lkOnR9LHIpKSkudG9TdHJpbmcoKX07bGV0IG89e307Y29uc3Qgbj0oZSx0KT0+IiIuY29uY2F0KGUsInwiKS5jb25jYXQodCk7YWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsKGFzeW5jIGU9PntsZXQgcixjLHtkYXRhOnt0aW1lb3V0OmksYXV0aDphLGZldGNoVXJsOmYsZmV0Y2hPcHRpb25zOmwsdXNlRm9ybURhdGE6cCx1c2VNcnJ0Omh9LHBvcnRzOlt1XX09ZSxkPXt9O2NvbnN0e2F1ZGllbmNlOmcsc2NvcGU6eX09YXx8e307dHJ5e2NvbnN0IGU9cD8oZT0+e2NvbnN0IHQ9bmV3IFVSTFNlYXJjaFBhcmFtcyhlKSxyPXt9O3JldHVybiB0LmZvckVhY2goKChlLHQpPT57clt0XT1lfSkpLHJ9KShsLmJvZHkpOkpTT04ucGFyc2UobC5ib2R5KTtpZighZS5yZWZyZXNoX3Rva2VuJiYicmVmcmVzaF90b2tlbiI9PT1lLmdyYW50X3R5cGUpe2lmKGM9KChlLHQpPT5vW24oZSx0KV0pKGcseSksIWMmJmgpe2NvbnN0IGU9by5sYXRlc3RfcmVmcmVzaF90b2tlbix0PSgoZSx0KT0+e2NvbnN0IHI9T2JqZWN0LmtleXMobykuZmluZCgocj0+e2lmKCJsYXRlc3RfcmVmcmVzaF90b2tlbiIhPT1yKXtjb25zdCBzPSgoZSx0KT0+dC5zdGFydHNXaXRoKCIiLmNvbmNhdChlLCJ8IikpKSh0LHIpLG89ci5zcGxpdCgifCIpWzFdLnNwbGl0KCIgIiksbj1lLnNwbGl0KCIgIikuZXZlcnkoKGU9Pm8uaW5jbHVkZXMoZSkpKTtyZXR1cm4gcyYmbn19KSk7cmV0dXJuISFyfSkoeSxnKTtlJiYhdCYmKGM9ZSl9aWYoIWMpdGhyb3cgbmV3IHQoZyx5KTtsLmJvZHk9cD9zKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxlKSx7cmVmcmVzaF90b2tlbjpjfSkpOkpTT04uc3RyaW5naWZ5KE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxlKSx7cmVmcmVzaF90b2tlbjpjfSkpfWxldCBhLGs7ImZ1bmN0aW9uIj09dHlwZW9mIEFib3J0Q29udHJvbGxlciYmKGE9bmV3IEFib3J0Q29udHJvbGxlcixsLnNpZ25hbD1hLnNpZ25hbCk7dHJ5e2s9YXdhaXQgUHJvbWlzZS5yYWNlKFsoaj1pLG5ldyBQcm9taXNlKChlPT5zZXRUaW1lb3V0KGUsaikpKSksZmV0Y2goZixPYmplY3QuYXNzaWduKHt9LGwpKV0pfWNhdGNoKGUpe3JldHVybiB2b2lkIHUucG9zdE1lc3NhZ2Uoe2Vycm9yOmUubWVzc2FnZX0pfWlmKCFrKXJldHVybiBhJiZhLmFib3J0KCksdm9pZCB1LnBvc3RNZXNzYWdlKHtlcnJvcjoiVGltZW91dCB3aGVuIGV4ZWN1dGluZyAnZmV0Y2gnIn0pO189ay5oZWFkZXJzLGQ9Wy4uLl9dLnJlZHVjZSgoKGUsdCk9PntsZXRbcixzXT10O3JldHVybiBlW3JdPXMsZX0pLHt9KSxyPWF3YWl0IGsuanNvbigpLHIucmVmcmVzaF90b2tlbj8oaCYmKG8ubGF0ZXN0X3JlZnJlc2hfdG9rZW49ci5yZWZyZXNoX3Rva2VuLE89YyxiPXIucmVmcmVzaF90b2tlbixPYmplY3QuZW50cmllcyhvKS5mb3JFYWNoKChlPT57bGV0W3Qscl09ZTtyPT09TyYmKG9bdF09Yil9KSkpLCgoZSx0LHIpPT57b1tuKHQscildPWV9KShyLnJlZnJlc2hfdG9rZW4sZyx5KSxkZWxldGUgci5yZWZyZXNoX3Rva2VuKTooKGUsdCk9PntkZWxldGUgb1tuKGUsdCldfSkoZyx5KSx1LnBvc3RNZXNzYWdlKHtvazprLm9rLGpzb246cixoZWFkZXJzOmR9KX1jYXRjaChlKXt1LnBvc3RNZXNzYWdlKHtvazohMSxqc29uOntlcnJvcjplLmVycm9yLGVycm9yX2Rlc2NyaXB0aW9uOmUubWVzc2FnZX0saGVhZGVyczpkfSl9dmFyIE8sYixfLGp9KSl9KCk7Cgo=",mo=null,yo=!1,function(n){return Nn=Nn||ha(fo,mo,yo),new Worker(Nn,n)}),Wn={},mr=class{constructor(e,t){this.cache=e,this.clientId=t,this.manifestKey=this.createManifestKeyFrom(this.clientId)}async add(e){var t;let r=new Set(((t=await this.cache.get(this.manifestKey))===null||t===void 0?void 0:t.keys)||[]);r.add(e),await this.cache.set(this.manifestKey,{keys:[...r]})}async remove(e){let t=await this.cache.get(this.manifestKey);if(t){let r=new Set(t.keys);return r.delete(e),r.size>0?await this.cache.set(this.manifestKey,{keys:[...r]}):await this.cache.remove(this.manifestKey)}}get(){return this.cache.get(this.manifestKey)}clear(){return this.cache.remove(this.manifestKey)}createManifestKeyFrom(e){return"".concat("@@auth0spajs@@","::").concat(e)}},da={memory:()=>new bt().enclosedCache,localstorage:()=>new un},go=n=>da[n],wo=n=>{let{openUrl:e,onRedirect:t}=n,r=X(n,["openUrl","onRedirect"]);return Object.assign(Object.assign({},r),{openUrl:e===!1||e?e:t})},vo=(n,e)=>{let t=e?.split(" ")||[];return(n?.split(" ")||[]).every(r=>t.includes(r))},Re={NONCE:"nonce",KEYPAIR:"keypair"},yr=class{constructor(e){this.clientId=e}getVersion(){return 1}createDbHandle(){let e=window.indexedDB.open("auth0-spa-js",this.getVersion());return new Promise((t,r)=>{e.onupgradeneeded=()=>Object.values(Re).forEach(o=>e.result.createObjectStore(o)),e.onerror=()=>r(e.error),e.onsuccess=()=>t(e.result)})}async getDbHandle(){return this.dbHandle||(this.dbHandle=await this.createDbHandle()),this.dbHandle}async executeDbRequest(e,t,r){let o=r((await this.getDbHandle()).transaction(e,t).objectStore(e));return new Promise((i,a)=>{o.onsuccess=()=>i(o.result),o.onerror=()=>a(o.error)})}buildKey(e){let t=e?"_".concat(e):"auth0";return"".concat(this.clientId,"::").concat(t)}setNonce(e,t){return this.save(Re.NONCE,this.buildKey(t),e)}setKeyPair(e){return this.save(Re.KEYPAIR,this.buildKey(),e)}async save(e,t,r){await this.executeDbRequest(e,"readwrite",o=>o.put(r,t))}findNonce(e){return this.find(Re.NONCE,this.buildKey(e))}findKeyPair(){return this.find(Re.KEYPAIR,this.buildKey())}find(e,t){return this.executeDbRequest(e,"readonly",r=>r.get(t))}async deleteBy(e,t){let r=await this.executeDbRequest(e,"readonly",o=>o.getAllKeys());r?.filter(t).map(o=>this.executeDbRequest(e,"readwrite",i=>i.delete(o)))}deleteByClientId(e,t){return this.deleteBy(e,r=>typeof r=="string"&&r.startsWith("".concat(t,"::")))}clearNonces(){return this.deleteByClientId(Re.NONCE,this.clientId)}clearKeyPairs(){return this.deleteByClientId(Re.KEYPAIR,this.clientId)}},gr=class{constructor(e){this.storage=new yr(e)}getNonce(e){return this.storage.findNonce(e)}setNonce(e,t){return this.storage.setNonce(e,t)}async getOrGenerateKeyPair(){let e=await this.storage.findKeyPair();return e||(e=await qi(),await this.storage.setKeyPair(e)),e}async generateProof(e){let t=await this.getOrGenerateKeyPair();return Yi(Object.assign({keyPair:t},e))}async calculateThumbprint(){return Bi(await this.getOrGenerateKeyPair())}async clear(){await Promise.all([this.storage.clearNonces(),this.storage.clearKeyPairs()])}},Be;(function(n){n.Bearer="Bearer",n.DPoP="DPoP"})(Be||(Be={}));var wr=class{constructor(e,t){this.hooks=t,this.config=Object.assign(Object.assign({},e),{fetch:e.fetch||(typeof window>"u"?fetch:window.fetch.bind(window))})}isAbsoluteUrl(e){return/^(https?:)?\/\//i.test(e)}buildUrl(e,t){if(t){if(this.isAbsoluteUrl(t))return t;if(e)return"".concat(e.replace(/\/?\/$/,""),"/").concat(t.replace(/^\/+/,""))}throw new TypeError("`url` must be absolute or `baseUrl` non-empty.")}getAccessToken(e){return this.config.getAccessToken?this.config.getAccessToken(e):this.hooks.getAccessToken(e)}extractUrl(e){return typeof e=="string"?e:e instanceof URL?e.href:e.url}buildBaseRequest(e,t){if(!this.config.baseUrl)return new Request(e,t);let r=this.buildUrl(this.config.baseUrl,this.extractUrl(e)),o=e instanceof Request?new Request(r,e):r;return new Request(o,t)}setAuthorizationHeader(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Be.Bearer;e.headers.set("authorization","".concat(r," ").concat(t))}async setDpopProofHeader(e,t){if(!this.config.dpopNonceId)return;let r=await this.hooks.getDpopNonce(),o=await this.hooks.generateDpopProof({accessToken:t,method:e.method,nonce:r,url:e.url});e.headers.set("dpop",o)}async prepareRequest(e,t){let r=await this.getAccessToken(t),o,i;typeof r=="string"?(o=this.config.dpopNonceId?Be.DPoP:Be.Bearer,i=r):(o=r.token_type,i=r.access_token),this.setAuthorizationHeader(e,i,o),o===Be.DPoP&&await this.setDpopProofHeader(e,i)}getHeader(e,t){return Array.isArray(e)?new Headers(e).get(t)||"":typeof e.get=="function"?e.get(t)||"":e[t]||""}hasUseDpopNonceError(e){if(e.status!==401)return!1;let t=this.getHeader(e.headers,"www-authenticate");return t.includes("invalid_dpop_nonce")||t.includes("use_dpop_nonce")}async handleResponse(e,t){let r=this.getHeader(e.headers,"dpop-nonce");if(r&&await this.hooks.setDpopNonce(r),!this.hasUseDpopNonceError(e))return e;if(!r||!t.onUseDpopNonceError)throw new vt(r);return t.onUseDpopNonceError()}async internalFetchWithAuth(e,t,r,o){let i=this.buildBaseRequest(e,t);await this.prepareRequest(i,o);let a=await this.config.fetch(i);return this.handleResponse(a,r)}fetchWithAuth(e,t,r){let o={onUseDpopNonceError:()=>this.internalFetchWithAuth(e,t,Object.assign(Object.assign({},o),{onUseDpopNonceError:void 0}),r)};return this.internalFetchWithAuth(e,t,o,r)}},vr=class{constructor(e,t){this.myAccountFetcher=e,this.apiBase=t}async connectAccount(e){let t=await this.myAccountFetcher.fetchWithAuth("".concat(this.apiBase,"v1/connected-accounts/connect"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return this._handleResponse(t)}async completeAccount(e){let t=await this.myAccountFetcher.fetchWithAuth("".concat(this.apiBase,"v1/connected-accounts/complete"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return this._handleResponse(t)}async _handleResponse(e){let t;try{t=await e.text(),t=JSON.parse(t)}catch(r){throw new hn({type:"invalid_json",status:e.status,title:"Invalid JSON response",detail:t||String(r)})}if(e.ok)return t;throw new hn(t)}},hn=class n extends Error{constructor(e){let{type:t,status:r,title:o,detail:i,validation_errors:a}=e;super(i),this.name="MyAccountApiError",this.type=t,this.status=r,this.title=o,this.detail=i,this.validation_errors=a,Object.setPrototypeOf(this,n.prototype)}},pa={otp:{authenticatorTypes:["otp"]},sms:{authenticatorTypes:["oob"],oobChannels:["sms"]},email:{authenticatorTypes:["oob"],oobChannels:["email"]},push:{authenticatorTypes:["oob"],oobChannels:["auth0"]},voice:{authenticatorTypes:["oob"],oobChannels:["voice"]}},fa="http://auth0.com/oauth/grant-type/mfa-otp",ma="http://auth0.com/oauth/grant-type/mfa-oob",ya="http://auth0.com/oauth/grant-type/mfa-recovery-code";function $o(n,e){this.v=n,this.k=e}function D(n,e,t){if(typeof n=="function"?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function ga(n){return new $o(n,0)}function Qo(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function v(n,e){return n.get(D(n,e))}function U(n,e,t){Qo(n,e),e.set(n,t)}function x(n,e,t){return n.set(D(n,e),t),t}function _(n,e,t){return(e=(function(r){var o=(function(i,a){if(typeof i!="object"||!i)return i;var s=i[Symbol.toPrimitive];if(s!==void 0){var c=s.call(i,a||"default");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(i)})(r,"string");return typeof o=="symbol"?o:o+""})(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function bo(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,r)}return t}function S(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?bo(Object(t),!0).forEach(function(r){_(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):bo(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function _o(n,e){if(n==null)return{};var t,r,o=(function(a,s){if(a==null)return{};var c={};for(var u in a)if({}.hasOwnProperty.call(a,u)){if(s.indexOf(u)!==-1)continue;c[u]=a[u]}return c})(n,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(r=0;r<i.length;r++)t=i[r],e.indexOf(t)===-1&&{}.propertyIsEnumerable.call(n,t)&&(o[t]=n[t])}return o}function wa(n){return function(){return new dt(n.apply(this,arguments))}}function dt(n){var e,t;function r(i,a){try{var s=n[i](a),c=s.value,u=c instanceof $o;Promise.resolve(u?c.v:c).then(function(h){if(u){var f=i==="return"?"return":"next";if(!c.k||h.done)return r(f,h);h=n[f](h).value}o(s.done?"return":"normal",h)},function(h){r("throw",h)})}catch(h){o("throw",h)}}function o(i,a){switch(i){case"return":e.resolve({value:a,done:!0});break;case"throw":e.reject(a);break;default:e.resolve({value:a,done:!1})}(e=e.next)?r(e.key,e.arg):t=null}this._invoke=function(i,a){return new Promise(function(s,c){var u={key:i,arg:a,resolve:s,reject:c,next:null};t?t=t.next=u:(e=t=u,r(i,a))})},typeof n.return!="function"&&(this.return=void 0)}var Zt,Mn,br;dt.prototype[typeof Symbol=="function"&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},dt.prototype.next=function(n){return this._invoke("next",n)},dt.prototype.throw=function(n){return this._invoke("throw",n)},dt.prototype.return=function(n){return this._invoke("return",n)},(typeof navigator>"u"||(Zt=navigator.userAgent)===null||Zt===void 0||(Mn=Zt.startsWith)===null||Mn===void 0||!Mn.call(Zt,"Mozilla/5.0 "))&&(br="".concat("oauth4webapi","/").concat("v3.8.3"));function rt(n,e){if(n==null)return!1;try{return n instanceof e||Object.getPrototypeOf(n)[Symbol.toStringTag]===e.prototype[Symbol.toStringTag]}catch{return!1}}function R(n,e,t){let r=new TypeError(n,{cause:t});return Object.assign(r,{code:e}),r}var Y=Symbol(),_r=Symbol(),kr=Symbol(),re=Symbol(),va=Symbol(),ae=Symbol(),ba=new TextEncoder,_a=new TextDecoder;function $e(n){return typeof n=="string"?ba.encode(n):_a.decode(n)}var Sr,ei;Uint8Array.prototype.toBase64?Sr=n=>(n instanceof ArrayBuffer&&(n=new Uint8Array(n)),n.toBase64({alphabet:"base64url",omitPadding:!0})):Sr=e=>{e instanceof ArrayBuffer&&(e=new Uint8Array(e));let t=[];for(let r=0;r<e.byteLength;r+=32768)t.push(String.fromCharCode.apply(null,e.subarray(r,r+32768)));return btoa(t.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")};function Ke(n){return typeof n=="string"?ei(n):Sr(n)}ei=Uint8Array.fromBase64?n=>{try{return Uint8Array.fromBase64(n,{alphabet:"base64url"})}catch(e){throw R("The input to be decoded is not correctly encoded.","ERR_INVALID_ARG_VALUE",e)}}:n=>{try{let e=atob(n.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}catch(e){throw R("The input to be decoded is not correctly encoded.","ERR_INVALID_ARG_VALUE",e)}};var H=class extends Error{constructor(e,t){var r;super(e,t),_(this,"code",void 0),this.name=this.constructor.name,this.code=Tr,(r=Error.captureStackTrace)===null||r===void 0||r.call(Error,this,this.constructor)}},kt=class extends Error{constructor(e,t){var r;super(e,t),_(this,"code",void 0),this.name=this.constructor.name,t!=null&&t.code&&(this.code=t?.code),(r=Error.captureStackTrace)===null||r===void 0||r.call(Error,this,this.constructor)}};function A(n,e,t){return new kt(n,{code:e,cause:t})}function ka(n,e){if((function(t,r){if(!(t instanceof CryptoKey))throw R("".concat(r," must be a CryptoKey"),"ERR_INVALID_ARG_TYPE")})(n,e),n.type!=="private")throw R("".concat(e," must be a private CryptoKey"),"ERR_INVALID_ARG_VALUE")}function ln(n){return n!==null&&typeof n=="object"&&!Array.isArray(n)}function kn(n){rt(n,Headers)&&(n=Object.fromEntries(n.entries()));let e=new Headers(n??{});if(br&&!e.has("user-agent")&&e.set("user-agent",br),e.has("authorization"))throw R('"options.headers" must not include the "authorization" header name',"ERR_INVALID_ARG_VALUE");return e}function ti(n,e){if(e!==void 0){if(typeof e=="function"&&(e=e(n.href)),!(e instanceof AbortSignal))throw R('"options.signal" must return or be an instance of AbortSignal',"ERR_INVALID_ARG_TYPE");return e}}function ko(n){return n.includes("//")?n.replace("//","/"):n}async function Sa(n,e){return(async function(t,r,o,i){if(!(t instanceof URL))throw R('"'.concat(r,'" must be an instance of URL'),"ERR_INVALID_ARG_TYPE");zr(t,i?.[Y]!==!0);let a=o(new URL(t.href)),s=kn(i?.headers);return s.set("accept","application/json"),(i?.[re]||fetch)(a.href,{body:void 0,headers:Object.fromEntries(s.entries()),method:"GET",redirect:"manual",signal:ti(a,i?.signal)})})(n,"issuerIdentifier",t=>{switch(e?.algorithm){case void 0:case"oidc":(function(r,o){r.pathname=ko("".concat(r.pathname,"/").concat(o))})(t,".well-known/openid-configuration");break;case"oauth2":(function(r,o){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];r.pathname==="/"?r.pathname=o:r.pathname=ko("".concat(o,"/").concat(i?r.pathname:r.pathname.replace(/(\/)$/,"")))})(t,".well-known/oauth-authorization-server");break;default:throw R('"options.algorithm" must be "oidc" (default), or "oauth2"',"ERR_INVALID_ARG_VALUE")}return t},e)}function Se(n,e,t,r,o){try{if(typeof n!="number"||!Number.isFinite(n))throw R("".concat(t," must be a number"),"ERR_INVALID_ARG_TYPE",o);if(n>0)return;if(e){if(n!==0)throw R("".concat(t," must be a non-negative number"),"ERR_INVALID_ARG_VALUE",o);return}throw R("".concat(t," must be a positive number"),"ERR_INVALID_ARG_VALUE",o)}catch(i){throw r?A(i.message,r,o):i}}function L(n,e,t,r){try{if(typeof n!="string")throw R("".concat(e," must be a string"),"ERR_INVALID_ARG_TYPE",r);if(n.length===0)throw R("".concat(e," must not be empty"),"ERR_INVALID_ARG_VALUE",r)}catch(o){throw t?A(o.message,t,r):o}}function ni(n){(function(e,t){if(ii(e)!==t)throw(function(r){let o='"response" content-type must be ';for(var i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];if(a.length>2){let c=a.pop();o+="".concat(a.join(", "),", or ").concat(c)}else a.length===2?o+="".concat(a[0]," or ").concat(a[1]):o+=a[0];return A(o,si,r)})(e,t)})(n,"application/json")}function ri(){return Ke(crypto.getRandomValues(new Uint8Array(32)))}function Ea(n){switch(n.algorithm.name){case"RSA-PSS":return(function(e){switch(e.algorithm.hash.name){case"SHA-256":return"PS256";case"SHA-384":return"PS384";case"SHA-512":return"PS512";default:throw new H("unsupported RsaHashedKeyAlgorithm hash name",{cause:e})}})(n);case"RSASSA-PKCS1-v1_5":return(function(e){switch(e.algorithm.hash.name){case"SHA-256":return"RS256";case"SHA-384":return"RS384";case"SHA-512":return"RS512";default:throw new H("unsupported RsaHashedKeyAlgorithm hash name",{cause:e})}})(n);case"ECDSA":return(function(e){switch(e.algorithm.namedCurve){case"P-256":return"ES256";case"P-384":return"ES384";case"P-521":return"ES512";default:throw new H("unsupported EcKeyAlgorithm namedCurve",{cause:e})}})(n);case"Ed25519":case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return n.algorithm.name;case"EdDSA":return"Ed25519";default:throw new H("unsupported CryptoKey algorithm name",{cause:n})}}function dn(n){let e=n?.[_r];return typeof e=="number"&&Number.isFinite(e)?e:0}function Er(n){let e=n?.[kr];return typeof e=="number"&&Number.isFinite(e)&&Math.sign(e)!==-1?e:30}function pn(){return Math.floor(Date.now()/1e3)}function te(n){if(typeof n!="object"||n===null)throw R('"as" must be an object',"ERR_INVALID_ARG_TYPE");L(n.issuer,'"as.issuer"')}function ne(n){if(typeof n!="object"||n===null)throw R('"client" must be an object',"ERR_INVALID_ARG_TYPE");L(n.client_id,'"client.client_id"')}function So(n){return L(n,'"clientSecret"'),(e,t,r,o)=>{r.set("client_id",t.client_id),r.set("client_secret",n)}}function Aa(n,e){let{key:t,kid:r}=(o=n)instanceof CryptoKey?{key:o}:o?.key instanceof CryptoKey?(o.kid!==void 0&&L(o.kid,'"kid"'),{key:o.key,kid:o.kid}):{};var o;return ka(t,'"clientPrivateKey.key"'),async(i,a,s,c)=>{var u;let h={alg:Ea(t),kid:r},f=(function(l,d){let w=pn()+dn(d);return{jti:ri(),aud:l.issuer,exp:w+60,iat:w,nbf:w,iss:d.client_id,sub:d.client_id}})(i,a);e==null||(u=e[va])===null||u===void 0||u.call(e,h,f),s.set("client_id",a.client_id),s.set("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),s.set("client_assertion",await(async function(l,d,w){if(!w.usages.includes("sign"))throw R('CryptoKey instances used for signing assertions must include "sign" in their "usages"',"ERR_INVALID_ARG_VALUE");let p="".concat(Ke($e(JSON.stringify(l))),".").concat(Ke($e(JSON.stringify(d)))),m=Ke(await crypto.subtle.sign((function(y){switch(y.algorithm.name){case"ECDSA":return{name:y.algorithm.name,hash:Ja(y)};case"RSA-PSS":switch(To(y),y.algorithm.hash.name){case"SHA-256":case"SHA-384":case"SHA-512":return{name:y.algorithm.name,saltLength:parseInt(y.algorithm.hash.name.slice(-3),10)>>3};default:throw new H("unsupported RSA-PSS hash name",{cause:y})}case"RSASSA-PKCS1-v1_5":return To(y),y.algorithm.name;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":case"Ed25519":return y.algorithm.name}throw new H("unsupported CryptoKey algorithm name",{cause:y})})(w),w,$e(p)));return"".concat(p,".").concat(m)})(h,f,t))}}var Ta=URL.parse?(n,e)=>URL.parse(n,e):(n,e)=>{try{return new URL(n,e)}catch{return null}};function zr(n,e){if(e&&n.protocol!=="https:")throw A("only requests to HTTPS are allowed",ci,n);if(n.protocol!=="https:"&&n.protocol!=="http:")throw A("only HTTP and HTTPS requests are allowed",ui,n)}function Eo(n,e,t,r){let o;if(typeof n!="string"||!(o=Ta(n)))throw A("authorization server metadata does not contain a valid ".concat(t?'"as.mtls_endpoint_aliases.'.concat(e,'"'):'"as.'.concat(e,'"')),n===void 0?za:Ha,{attribute:t?"mtls_endpoint_aliases.".concat(e):e});return zr(o,r),o}function Ct(n,e,t,r){return t&&n.mtls_endpoint_aliases&&e in n.mtls_endpoint_aliases?Eo(n.mtls_endpoint_aliases[e],e,t,r):Eo(n[e],e,t,r)}var Qe=class extends Error{constructor(e,t){var r;super(e,t),_(this,"cause",void 0),_(this,"code",void 0),_(this,"error",void 0),_(this,"status",void 0),_(this,"error_description",void 0),_(this,"response",void 0),this.name=this.constructor.name,this.code=Wa,this.cause=t.cause,this.error=t.cause.error,this.status=t.response.status,this.error_description=t.cause.error_description,Object.defineProperty(this,"response",{enumerable:!1,value:t.response}),(r=Error.captureStackTrace)===null||r===void 0||r.call(Error,this,this.constructor)}},fn=class extends Error{constructor(e,t){var r,o;super(e,t),_(this,"cause",void 0),_(this,"code",void 0),_(this,"error",void 0),_(this,"error_description",void 0),this.name=this.constructor.name,this.code=Ma,this.cause=t.cause,this.error=t.cause.get("error"),this.error_description=(r=t.cause.get("error_description"))!==null&&r!==void 0?r:void 0,(o=Error.captureStackTrace)===null||o===void 0||o.call(Error,this,this.constructor)}},St=class extends Error{constructor(e,t){var r;super(e,t),_(this,"cause",void 0),_(this,"code",void 0),_(this,"response",void 0),_(this,"status",void 0),this.name=this.constructor.name,this.code=Na,this.cause=t.cause,this.status=t.response.status,this.response=t.response,Object.defineProperty(this,"response",{enumerable:!1}),(r=Error.captureStackTrace)===null||r===void 0||r.call(Error,this,this.constructor)}},Pa="[a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+",Ra=new RegExp("^[,\\s]*("+Pa+")"),Ia=new RegExp('^[,\\s]*([a-zA-Z0-9!#$%&\\\'\\*\\+\\-\\.\\^_`\\|~]+)\\s*=\\s*"((?:[^"\\\\]|\\\\[\\s\\S])*)"[,\\s]*(.*)'),Ca=new RegExp("^[,\\s]*([a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+)\\s*=\\s*([a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+)[,\\s]*(.*)"),xa=new RegExp("^([a-zA-Z0-9\\-\\._\\~\\+\\/]+={0,2})(?:$|[,\\s])(.*)");async function Hr(n,e,t){if(n.status!==e){let o;var r;throw(function(i){let a;if(a=(function(s){if(!rt(s,Response))throw R('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");let c=s.headers.get("www-authenticate");if(c===null)return;let u=[],h=c;for(;h;){var f;let l=h.match(Ra),d=(f=l)===null||f===void 0?void 0:f[1].toLowerCase();if(!d)return;let w=h.substring(l[0].length);if(w&&!w.match(/^[\s,]/))return;let p=w.match(/^\s+(.*)$/),m=!!p;h=p?p[1]:void 0;let y={},b;if(m)for(;h;){let E,g;if(l=h.match(Ia)){if([,E,g,h]=l,g.includes("\\"))try{g=JSON.parse('"'.concat(g,'"'))}catch{}y[E.toLowerCase()]=g}else{if(!(l=h.match(Ca))){if(l=h.match(xa)){if(Object.keys(y).length)break;[,b,h]=l;break}return}[,E,g,h]=l,y[E.toLowerCase()]=g}}else h=w||void 0;let k={scheme:d,parameters:y};b&&(k.token68=b),u.push(k)}return u.length?u:void 0})(i))throw new St("server responded with a challenge in the WWW-Authenticate HTTP Header",{cause:a,response:i})})(n),(o=await(async function(i){if(i.status>399&&i.status<500){Ot(i),ni(i);try{let a=await i.clone().json();if(ln(a)&&typeof a.error=="string"&&a.error.length)return a}catch{}}})(n))?(await((r=n.body)===null||r===void 0?void 0:r.cancel()),new Qe("server responded with an error in the response body",{cause:o,response:n})):A('"response" is not a conform '.concat(t," response (unexpected HTTP status code)"),Fr,n)}}function oi(n){if(!Vr.has(n))throw R('"options.DPoP" is not a valid DPoPHandle',"ERR_INVALID_ARG_VALUE")}function ii(n){var e;return(e=n.headers.get("content-type"))===null||e===void 0?void 0:e.split(";")[0]}async function Jr(n,e,t,r,o,i,a){return await t(n,e,o,i),i.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),(a?.[re]||fetch)(r.href,{body:o,headers:Object.fromEntries(i.entries()),method:"POST",redirect:"manual",signal:ti(r,a?.signal)})}async function xt(n,e,t,r,o,i){var a;let s=Ct(n,"token_endpoint",e.use_mtls_endpoint_aliases,i?.[Y]!==!0);o.set("grant_type",r);let c=kn(i?.headers);c.set("accept","application/json"),i?.DPoP!==void 0&&(oi(i.DPoP),await i.DPoP.addProof(s,c,"POST"));let u=await Jr(n,e,t,s,o,c,i);return i==null||(a=i.DPoP)===null||a===void 0||a.cacheNonce(u,s),u}var ai=new WeakMap,Oa=new WeakMap;function Ar(n){if(!n.id_token)return;let e=ai.get(n);if(!e)throw R('"ref" was already garbage collected or did not resolve from the proper sources',"ERR_INVALID_ARG_VALUE");return e}async function et(n,e,t,r,o,i){if(te(n),ne(e),!rt(t,Response))throw R('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");await Hr(t,200,"Token Endpoint"),Ot(t);let a=await Sn(t);if(L(a.access_token,'"response" body "access_token" property',T,{body:a}),L(a.token_type,'"response" body "token_type" property',T,{body:a}),a.token_type=a.token_type.toLowerCase(),a.expires_in!==void 0){let s=typeof a.expires_in!="number"?parseFloat(a.expires_in):a.expires_in;Se(s,!0,'"response" body "expires_in" property',T,{body:a}),a.expires_in=s}if(a.refresh_token!==void 0&&L(a.refresh_token,'"response" body "refresh_token" property',T,{body:a}),a.scope!==void 0&&typeof a.scope!="string")throw A('"response" body "scope" property must be a string',T,{body:a});if(a.id_token!==void 0){L(a.id_token,'"response" body "id_token" property',T,{body:a});let s=["aud","exp","iat","iss","sub"];e.require_auth_time===!0&&s.push("auth_time"),e.default_max_age!==void 0&&(Se(e.default_max_age,!0,'"client.default_max_age"'),s.push("auth_time")),r!=null&&r.length&&s.push(...r);let{claims:c,jwt:u}=await(async function(h,f,l,d,w){let p,m,{0:y,1:b,length:k}=h.split(".");if(k===5){if(w===void 0)throw new H("JWE decryption is not configured",{cause:h});h=await w(h),{0:y,1:b,length:k}=h.split(".")}if(k!==3)throw A("Invalid JWT",T,h);try{p=JSON.parse($e(Ke(y)))}catch(g){throw A("failed to parse JWT Header body as base64url encoded JSON",mn,g)}if(!ln(p))throw A("JWT Header must be a top level object",T,h);if(f(p),p.crit!==void 0)throw new H('no JWT "crit" header parameter extensions are supported',{cause:{header:p}});try{m=JSON.parse($e(Ke(b)))}catch(g){throw A("failed to parse JWT Payload body as base64url encoded JSON",mn,g)}if(!ln(m))throw A("JWT Payload must be a top level object",T,h);let E=pn()+l;if(m.exp!==void 0){if(typeof m.exp!="number")throw A('unexpected JWT "exp" (expiration time) claim type',T,{claims:m});if(m.exp<=E-d)throw A('unexpected JWT "exp" (expiration time) claim value, expiration is past current timestamp',Et,{claims:m,now:E,tolerance:d,claim:"exp"})}if(m.iat!==void 0&&typeof m.iat!="number")throw A('unexpected JWT "iat" (issued at) claim type',T,{claims:m});if(m.iss!==void 0&&typeof m.iss!="string")throw A('unexpected JWT "iss" (issuer) claim type',T,{claims:m});if(m.nbf!==void 0){if(typeof m.nbf!="number")throw A('unexpected JWT "nbf" (not before) claim type',T,{claims:m});if(m.nbf>E+d)throw A('unexpected JWT "nbf" (not before) claim value',Et,{claims:m,now:E,tolerance:d,claim:"nbf"})}if(m.aud!==void 0&&typeof m.aud!="string"&&!Array.isArray(m.aud))throw A('unexpected JWT "aud" (audience) claim type',T,{claims:m});return{header:p,claims:m,jwt:h}})(a.id_token,Fa.bind(void 0,e.id_token_signed_response_alg,n.id_token_signing_alg_values_supported,"RS256"),dn(e),Er(e),o).then(Ua.bind(void 0,s)).then(Da.bind(void 0,n)).then(ja.bind(void 0,e.client_id));if(Array.isArray(c.aud)&&c.aud.length!==1){if(c.azp===void 0)throw A('ID Token "aud" (audience) claim includes additional untrusted audiences',fe,{claims:c,claim:"aud"});if(c.azp!==e.client_id)throw A('unexpected ID Token "azp" (authorized party) claim value',fe,{expected:e.client_id,claims:c,claim:"azp"})}c.auth_time!==void 0&&Se(c.auth_time,!0,'ID Token "auth_time" (authentication time)',T,{claims:c}),Oa.set(t,u),ai.set(a,c)}if(i?.[a.token_type]!==void 0)i[a.token_type](t,a);else if(a.token_type!=="dpop"&&a.token_type!=="bearer")throw new H("unsupported `token_type` value",{cause:{body:a}});return a}function ja(n,e){if(Array.isArray(e.claims.aud)){if(!e.claims.aud.includes(n))throw A('unexpected JWT "aud" (audience) claim value',fe,{expected:n,claims:e.claims,claim:"aud"})}else if(e.claims.aud!==n)throw A('unexpected JWT "aud" (audience) claim value',fe,{expected:n,claims:e.claims,claim:"aud"});return e}function Da(n,e){var t,r;let o=(t=(r=n[hi])===null||r===void 0?void 0:r.call(n,e))!==null&&t!==void 0?t:n.issuer;if(e.claims.iss!==o)throw A('unexpected JWT "iss" (issuer) claim value',fe,{expected:o,claims:e.claims,claim:"iss"});return e}var Vr=new WeakSet,Ao=Symbol(),La={aud:"audience",c_hash:"code hash",client_id:"client id",exp:"expiration time",iat:"issued at",iss:"issuer",jti:"jwt id",nonce:"nonce",s_hash:"state hash",sub:"subject",ath:"access token hash",htm:"http method",htu:"http uri",cnf:"confirmation",auth_time:"authentication time"};function Ua(n,e){for(let t of n)if(e.claims[t]===void 0)throw A('JWT "'.concat(t,'" (').concat(La[t],") claim missing"),T,{claims:e.claims});return e}var zn=Symbol(),Hn=Symbol();async function Ka(n,e,t,r){return typeof r?.expectedNonce=="string"||typeof r?.maxAge=="number"||r!=null&&r.requireIdToken?(async function(o,i,a,s,c,u,h){let f=[];switch(s){case void 0:s=zn;break;case zn:break;default:L(s,'"expectedNonce" argument'),f.push("nonce")}switch(c!=null||(c=i.default_max_age),c){case void 0:c=Hn;break;case Hn:break;default:Se(c,!0,'"maxAge" argument'),f.push("auth_time")}let l=await et(o,i,a,f,u,h);L(l.id_token,'"response" body "id_token" property',T,{body:l});let d=Ar(l);if(c!==Hn){let w=pn()+dn(i),p=Er(i);if(d.auth_time+c<w-p)throw A("too much time has elapsed since the last End-User authentication",Et,{claims:d,now:w,tolerance:p,claim:"auth_time"})}if(s===zn){if(d.nonce!==void 0)throw A('unexpected ID Token "nonce" claim value',fe,{expected:void 0,claims:d,claim:"nonce"})}else if(d.nonce!==s)throw A('unexpected ID Token "nonce" claim value',fe,{expected:s,claims:d,claim:"nonce"});return l})(n,e,t,r.expectedNonce,r.maxAge,r[ae],r.recognizedTokenTypes):(async function(o,i,a,s,c){let u=await et(o,i,a,void 0,s,c),h=Ar(u);if(h){if(i.default_max_age!==void 0){Se(i.default_max_age,!0,'"client.default_max_age"');let f=pn()+dn(i),l=Er(i);if(h.auth_time+i.default_max_age<f-l)throw A("too much time has elapsed since the last End-User authentication",Et,{claims:h,now:f,tolerance:l,claim:"auth_time"})}if(h.nonce!==void 0)throw A('unexpected ID Token "nonce" claim value',fe,{expected:void 0,claims:h,claim:"nonce"})}return u})(n,e,t,r?.[ae],r?.recognizedTokenTypes)}var Na="OAUTH_WWW_AUTHENTICATE_CHALLENGE",Wa="OAUTH_RESPONSE_BODY_ERROR",Tr="OAUTH_UNSUPPORTED_OPERATION",Ma="OAUTH_AUTHORIZATION_RESPONSE_ERROR",mn="OAUTH_PARSE_ERROR",T="OAUTH_INVALID_RESPONSE",si="OAUTH_RESPONSE_IS_NOT_JSON",Fr="OAUTH_RESPONSE_IS_NOT_CONFORM",ci="OAUTH_HTTP_REQUEST_FORBIDDEN",ui="OAUTH_REQUEST_PROTOCOL_FORBIDDEN",Et="OAUTH_JWT_TIMESTAMP_CHECK_FAILED",fe="OAUTH_JWT_CLAIM_COMPARISON_FAILED",Pr="OAUTH_JSON_ATTRIBUTE_COMPARISON_FAILED",za="OAUTH_MISSING_SERVER_METADATA",Ha="OAUTH_INVALID_SERVER_METADATA";function Ot(n){if(n.bodyUsed)throw R('"response" body has been used already',"ERR_INVALID_ARG_VALUE")}function To(n){let{algorithm:e}=n;if(typeof e.modulusLength!="number"||e.modulusLength<2048)throw new H("unsupported ".concat(e.name," modulusLength"),{cause:n})}function Ja(n){let{algorithm:e}=n;switch(e.namedCurve){case"P-256":return"SHA-256";case"P-384":return"SHA-384";case"P-521":return"SHA-512";default:throw new H("unsupported ECDSA namedCurve",{cause:n})}}async function Va(n){if(n.method!=="POST")throw R("form_post responses are expected to use the POST method","ERR_INVALID_ARG_VALUE",{cause:n});if(ii(n)!=="application/x-www-form-urlencoded")throw R("form_post responses are expected to use the application/x-www-form-urlencoded content-type","ERR_INVALID_ARG_VALUE",{cause:n});return(async function(e){if(e.bodyUsed)throw R("form_post Request instances must contain a readable body","ERR_INVALID_ARG_VALUE",{cause:e});return e.text()})(n)}function Fa(n,e,t,r){if(n===void 0)if(Array.isArray(e)){if(!e.includes(r.alg))throw A('unexpected JWT "alg" header parameter',T,{header:r,expected:e,reason:"authorization server metadata"})}else{if(t===void 0)throw A('missing client or server configuration to verify used JWT "alg" header parameter',void 0,{client:n,issuer:e,fallback:t});if(typeof t=="string"?r.alg!==t:typeof t=="function"?!t(r.alg):!t.includes(r.alg))throw A('unexpected JWT "alg" header parameter',T,{header:r,expected:t,reason:"default value"})}else if(typeof n=="string"?r.alg!==n:!n.includes(r.alg))throw A('unexpected JWT "alg" header parameter',T,{header:r,expected:n,reason:"client configuration"})}function De(n,e){let{0:t,length:r}=n.getAll(e);if(r>1)throw A('"'.concat(e,'" parameter must be provided only once'),T);return t}var Ga=Symbol(),Za=Symbol();function qa(n,e,t,r){if(te(n),ne(e),t instanceof URL&&(t=t.searchParams),!(t instanceof URLSearchParams))throw R('"parameters" must be an instance of URLSearchParams, or URL',"ERR_INVALID_ARG_TYPE");if(De(t,"response"))throw A('"parameters" contains a JARM response, use validateJwtAuthResponse() instead of validateAuthResponse()',T,{parameters:t});let o=De(t,"iss"),i=De(t,"state");if(!o&&n.authorization_response_iss_parameter_supported)throw A('response parameter "iss" (issuer) missing',T,{parameters:t});if(o&&o!==n.issuer)throw A('unexpected "iss" (issuer) response parameter value',T,{expected:n.issuer,parameters:t});switch(r){case void 0:case Za:if(i!==void 0)throw A('unexpected "state" response parameter encountered',T,{expected:void 0,parameters:t});break;case Ga:break;default:if(L(r,'"expectedState" argument'),i!==r)throw A(i===void 0?'response parameter "state" missing':'unexpected "state" response parameter value',T,{expected:r,parameters:t})}if(De(t,"error"))throw new fn("authorization response from the server is an error",{cause:t});let a=De(t,"id_token"),s=De(t,"token");if(a!==void 0||s!==void 0)throw new H("implicit and hybrid flows are not supported");return c=new URLSearchParams(t),Vr.add(c),c;var c}async function Sn(n){let e,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ni;try{e=await n.json()}catch(r){throw t(n),A('failed to parse "response" body as JSON',mn,r)}if(!ln(e))throw A('"response" body must be a top level object',T,{body:e});return e}var Jn=Symbol(),hi=Symbol(),Po=new TextEncoder,At=new TextDecoder;function Vn(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);if(r>127)throw new TypeError("non-ASCII string encountered in encode()");e[t]=r}return e}function li(n){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(n);let e=atob(n),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}function mt(n){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(typeof n=="string"?n:At.decode(n),{alphabet:"base64url"});let e=n;e instanceof Uint8Array&&(e=At.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/");try{return li(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}}var K=class extends Error{constructor(e,t){var r;super(e,t),_(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(r=Error.captureStackTrace)===null||r===void 0||r.call(Error,this,this.constructor)}};_(K,"code","ERR_JOSE_GENERIC");var Z=class extends K{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:r,reason:o,payload:t}}),_(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),_(this,"claim",void 0),_(this,"reason",void 0),_(this,"payload",void 0),this.claim=r,this.reason=o,this.payload=t}};_(Z,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");var Tt=class extends K{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:r,reason:o,payload:t}}),_(this,"code","ERR_JWT_EXPIRED"),_(this,"claim",void 0),_(this,"reason",void 0),_(this,"payload",void 0),this.claim=r,this.reason=o,this.payload=t}};_(Tt,"code","ERR_JWT_EXPIRED");var yn=class extends K{constructor(){super(...arguments),_(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}};_(yn,"code","ERR_JOSE_ALG_NOT_ALLOWED");var z=class extends K{constructor(){super(...arguments),_(this,"code","ERR_JOSE_NOT_SUPPORTED")}};_(z,"code","ERR_JOSE_NOT_SUPPORTED");_(class extends K{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",arguments.length>1?arguments[1]:void 0),_(this,"code","ERR_JWE_DECRYPTION_FAILED")}},"code","ERR_JWE_DECRYPTION_FAILED");_(class extends K{constructor(){super(...arguments),_(this,"code","ERR_JWE_INVALID")}},"code","ERR_JWE_INVALID");var j=class extends K{constructor(){super(...arguments),_(this,"code","ERR_JWS_INVALID")}};_(j,"code","ERR_JWS_INVALID");var Pt=class extends K{constructor(){super(...arguments),_(this,"code","ERR_JWT_INVALID")}};_(Pt,"code","ERR_JWT_INVALID");_(class extends K{constructor(){super(...arguments),_(this,"code","ERR_JWK_INVALID")}},"code","ERR_JWK_INVALID");var Rt=class extends K{constructor(){super(...arguments),_(this,"code","ERR_JWKS_INVALID")}};_(Rt,"code","ERR_JWKS_INVALID");var It=class extends K{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",arguments.length>1?arguments[1]:void 0),_(this,"code","ERR_JWKS_NO_MATCHING_KEY")}};_(It,"code","ERR_JWKS_NO_MATCHING_KEY");var gn=class extends K{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",arguments.length>1?arguments[1]:void 0),_(this,Symbol.asyncIterator,void 0),_(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}};_(gn,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");var wn=class extends K{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",arguments.length>1?arguments[1]:void 0),_(this,"code","ERR_JWKS_TIMEOUT")}};_(wn,"code","ERR_JWKS_TIMEOUT");var vn=class extends K{constructor(){super(arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",arguments.length>1?arguments[1]:void 0),_(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}};_(vn,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");var oe=function(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"algorithm.name";return new TypeError("CryptoKey does not support this operation, its ".concat(e," must be ").concat(n))},Ge=(n,e)=>n.name===e;function Fn(n){return parseInt(n.name.slice(4),10)}function Ba(n,e,t){switch(e){case"HS256":case"HS384":case"HS512":{if(!Ge(n.algorithm,"HMAC"))throw oe("HMAC");let r=parseInt(e.slice(2),10);if(Fn(n.algorithm.hash)!==r)throw oe("SHA-".concat(r),"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Ge(n.algorithm,"RSASSA-PKCS1-v1_5"))throw oe("RSASSA-PKCS1-v1_5");let r=parseInt(e.slice(2),10);if(Fn(n.algorithm.hash)!==r)throw oe("SHA-".concat(r),"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Ge(n.algorithm,"RSA-PSS"))throw oe("RSA-PSS");let r=parseInt(e.slice(2),10);if(Fn(n.algorithm.hash)!==r)throw oe("SHA-".concat(r),"algorithm.hash");break}case"Ed25519":case"EdDSA":if(!Ge(n.algorithm,"Ed25519"))throw oe("Ed25519");break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":if(!Ge(n.algorithm,e))throw oe(e);break;case"ES256":case"ES384":case"ES512":{if(!Ge(n.algorithm,"ECDSA"))throw oe("ECDSA");let r=(function(o){switch(o){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}})(e);if(n.algorithm.namedCurve!==r)throw oe(r,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}(function(r,o){if(o&&!r.usages.includes(o))throw new TypeError("CryptoKey does not support this operation, its usages must include ".concat(o,"."))})(n,t)}function di(n,e){for(var t=arguments.length,r=new Array(t>2?t-2:0),o=2;o<t;o++)r[o-2]=arguments[o];if((r=r.filter(Boolean)).length>2){let a=r.pop();n+="one of type ".concat(r.join(", "),", or ").concat(a,".")}else r.length===2?n+="one of type ".concat(r[0]," or ").concat(r[1],"."):n+="of type ".concat(r[0],".");if(e==null)n+=" Received ".concat(e);else if(typeof e=="function"&&e.name)n+=" Received function ".concat(e.name);else if(typeof e=="object"&&e!=null){var i;(i=e.constructor)!==null&&i!==void 0&&i.name&&(n+=" Received an instance of ".concat(e.constructor.name))}return n}var Ro=function(n,e){for(var t=arguments.length,r=new Array(t>2?t-2:0),o=2;o<t;o++)r[o-2]=arguments[o];return di("Key for the ".concat(n," algorithm must be "),e,...r)},pi=n=>{if(n?.[Symbol.toStringTag]==="CryptoKey")return!0;try{return n instanceof CryptoKey}catch{return!1}},fi=n=>n?.[Symbol.toStringTag]==="KeyObject",Io=n=>pi(n)||fi(n);function Ae(n){if(typeof(e=n)!="object"||e===null||Object.prototype.toString.call(n)!=="[object Object]")return!1;var e;if(Object.getPrototypeOf(n)===null)return!0;let t=n;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(n)===t}var Gn=(n,e)=>{if(n.byteLength!==e.length)return!1;for(let t=0;t<n.byteLength;t++)if(n[t]!==e[t])return!1;return!0},yt=n=>{let e=n.data[n.pos++];if(128&e){let t=127&e,r=0;for(let o=0;o<t;o++)r=r<<8|n.data[n.pos++];return r}return e},gt=(n,e,t)=>{if(n.data[n.pos++]!==e)throw new Error(t)},Co=(n,e)=>{let t=n.data.subarray(n.pos,n.pos+e);return n.pos+=e,t},Ya=n=>{let e=(o=>{gt(o,6,"Expected algorithm OID");let i=yt(o);return Co(o,i)})(n);if(Gn(e,[43,101,110]))return"X25519";if(!Gn(e,[42,134,72,206,61,2,1]))throw new Error("Unsupported key algorithm");gt(n,6,"Expected curve OID");let t=yt(n),r=Co(n,t);for(let{name:o,oid:i}of[{name:"P-256",oid:[42,134,72,206,61,3,1,7]},{name:"P-384",oid:[43,129,4,0,34]},{name:"P-521",oid:[43,129,4,0,35]}])if(Gn(r,i))return o;throw new Error("Unsupported named curve")},Xa=async(n,e,t,r)=>{var o;let i,a,s=n==="spki",c=()=>s?["verify"]:["sign"];switch(t){case"PS256":case"PS384":case"PS512":i={name:"RSA-PSS",hash:"SHA-".concat(t.slice(-3))},a=c();break;case"RS256":case"RS384":case"RS512":i={name:"RSASSA-PKCS1-v1_5",hash:"SHA-".concat(t.slice(-3))},a=c();break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":i={name:"RSA-OAEP",hash:"SHA-".concat(parseInt(t.slice(-3),10)||1)},a=s?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":case"ES384":case"ES512":i={name:"ECDSA",namedCurve:{ES256:"P-256",ES384:"P-384",ES512:"P-521"}[t]},a=c();break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":try{let u=r.getNamedCurve(e);i=u==="X25519"?{name:"X25519"}:{name:"ECDH",namedCurve:u}}catch{throw new z("Invalid or unsupported key format")}a=s?[]:["deriveBits"];break;case"Ed25519":case"EdDSA":i={name:"Ed25519"},a=c();break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":i={name:t},a=c();break;default:throw new z('Invalid or unsupported "alg" (Algorithm) value')}return crypto.subtle.importKey(n,e,i,(o=r?.extractable)!==null&&o!==void 0?o:!!s,a)},$a=(n,e,t)=>{var r;let o=((a,s)=>li(a.replace(s,"")))(n,/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g),i=t;return e!=null&&(r=e.startsWith)!==null&&r!==void 0&&r.call(e,"ECDH-ES")&&(i||(i={}),i.getNamedCurve=a=>{let s={data:a,pos:0};return(function(c){gt(c,48,"Invalid PKCS#8 structure"),yt(c),gt(c,2,"Expected version field");let u=yt(c);c.pos+=u,gt(c,48,"Expected algorithm identifier");let h=yt(c);c.pos})(s),Ya(s)}),Xa("pkcs8",o,e,i)};async function tn(n){var e,t;if(!n.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:r,keyUsages:o}=(function(a){let s,c;switch(a.kty){case"AKP":switch(a.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":s={name:a.alg},c=a.priv?["sign"]:["verify"];break;default:throw new z('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(a.alg){case"PS256":case"PS384":case"PS512":s={name:"RSA-PSS",hash:"SHA-".concat(a.alg.slice(-3))},c=a.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":s={name:"RSASSA-PKCS1-v1_5",hash:"SHA-".concat(a.alg.slice(-3))},c=a.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":s={name:"RSA-OAEP",hash:"SHA-".concat(parseInt(a.alg.slice(-3),10)||1)},c=a.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new z('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(a.alg){case"ES256":s={name:"ECDSA",namedCurve:"P-256"},c=a.d?["sign"]:["verify"];break;case"ES384":s={name:"ECDSA",namedCurve:"P-384"},c=a.d?["sign"]:["verify"];break;case"ES512":s={name:"ECDSA",namedCurve:"P-521"},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":s={name:"ECDH",namedCurve:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new z('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(a.alg){case"Ed25519":case"EdDSA":s={name:"Ed25519"},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":s={name:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new z('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new z('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:s,keyUsages:c}})(n),i=S({},n);return i.kty!=="AKP"&&delete i.alg,delete i.use,crypto.subtle.importKey("jwk",i,r,(e=n.ext)!==null&&e!==void 0?e:!n.d&&!n.priv,(t=n.key_ops)!==null&&t!==void 0?t:o)}var Rr=n=>Ae(n)&&typeof n.kty=="string",_e,xo=async function(n,e,t){let r=arguments.length>3&&arguments[3]!==void 0&&arguments[3];_e||(_e=new WeakMap);let o=_e.get(n);if(o!=null&&o[t])return o[t];let i=await tn(S(S({},e),{},{alg:t}));return r&&Object.freeze(n),o?o[t]=i:_e.set(n,{[t]:i}),i};async function Qa(n,e){if(n instanceof Uint8Array||pi(n))return n;if(fi(n)){if(n.type==="secret")return n.export();if("toCryptoKey"in n&&typeof n.toCryptoKey=="function")try{return((r,o)=>{_e||(_e=new WeakMap);let i=_e.get(r);if(i!=null&&i[o])return i[o];let a=r.type==="public",s=!!a,c;if(r.asymmetricKeyType==="x25519"){switch(o){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}c=r.toCryptoKey(r.asymmetricKeyType,s,a?[]:["deriveBits"])}if(r.asymmetricKeyType==="ed25519"){if(o!=="EdDSA"&&o!=="Ed25519")throw new TypeError("given KeyObject instance cannot be used for this algorithm");c=r.toCryptoKey(r.asymmetricKeyType,s,[a?"verify":"sign"])}switch(r.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":if(o!==r.asymmetricKeyType.toUpperCase())throw new TypeError("given KeyObject instance cannot be used for this algorithm");c=r.toCryptoKey(r.asymmetricKeyType,s,[a?"verify":"sign"])}if(r.asymmetricKeyType==="rsa"){let h;switch(o){case"RSA-OAEP":h="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":h="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":h="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":h="SHA-512";break;default:throw new TypeError("given KeyObject instance cannot be used for this algorithm")}if(o.startsWith("RSA-OAEP"))return r.toCryptoKey({name:"RSA-OAEP",hash:h},s,a?["encrypt"]:["decrypt"]);c=r.toCryptoKey({name:o.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:h},s,[a?"verify":"sign"])}if(r.asymmetricKeyType==="ec"){var u;let h=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get((u=r.asymmetricKeyDetails)===null||u===void 0?void 0:u.namedCurve);if(!h)throw new TypeError("given KeyObject instance cannot be used for this algorithm");o==="ES256"&&h==="P-256"&&(c=r.toCryptoKey({name:"ECDSA",namedCurve:h},s,[a?"verify":"sign"])),o==="ES384"&&h==="P-384"&&(c=r.toCryptoKey({name:"ECDSA",namedCurve:h},s,[a?"verify":"sign"])),o==="ES512"&&h==="P-521"&&(c=r.toCryptoKey({name:"ECDSA",namedCurve:h},s,[a?"verify":"sign"])),o.startsWith("ECDH-ES")&&(c=r.toCryptoKey({name:"ECDH",namedCurve:h},s,a?[]:["deriveBits"]))}if(!c)throw new TypeError("given KeyObject instance cannot be used for this algorithm");return i?i[o]=c:_e.set(r,{[o]:c}),c})(n,e)}catch(r){if(r instanceof TypeError)throw r}let t=n.export({format:"jwk"});return xo(n,t,e)}if(Rr(n))return n.k?mt(n.k):xo(n,n,e,!0);throw new Error("unreachable")}var Ze=n=>n?.[Symbol.toStringTag],Zn=(n,e,t)=>{if(e.use!==void 0){let i;switch(t){case"sign":case"verify":i="sig";break;case"encrypt":case"decrypt":i="enc"}if(e.use!==i)throw new TypeError('Invalid key for this operation, its "use" must be "'.concat(i,'" when present'))}if(e.alg!==void 0&&e.alg!==n)throw new TypeError('Invalid key for this operation, its "alg" must be "'.concat(n,'" when present'));if(Array.isArray(e.key_ops)){var r,o;let i;switch(!0){case(t==="sign"||t==="verify"):case n==="dir":case n.includes("CBC-HS"):i=t;break;case n.startsWith("PBES2"):i="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(n):i=!n.includes("GCM")&&n.endsWith("KW")?t==="encrypt"?"wrapKey":"unwrapKey":t;break;case(t==="encrypt"&&n.startsWith("RSA")):i="wrapKey";break;case t==="decrypt":i=n.startsWith("RSA")?"unwrapKey":"deriveBits"}if(i&&((r=e.key_ops)===null||r===void 0||(o=r.includes)===null||o===void 0?void 0:o.call(r,i))===!1)throw new TypeError('Invalid key for this operation, its "key_ops" must include "'.concat(i,'" when present'))}return!0};function es(n,e,t){switch(n.substring(0,2)){case"A1":case"A2":case"di":case"HS":case"PB":((r,o,i)=>{if(!(o instanceof Uint8Array)){if(Rr(o)){if((a=>a.kty==="oct"&&typeof a.k=="string")(o)&&Zn(r,o,i))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Io(o))throw new TypeError(Ro(r,o,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if(o.type!=="secret")throw new TypeError("".concat(Ze(o),' instances for symmetric algorithms must be of type "secret"'))}})(n,e,t);break;default:((r,o,i)=>{if(Rr(o))switch(i){case"decrypt":case"sign":if((a=>a.kty!=="oct"&&(a.kty==="AKP"&&typeof a.priv=="string"||typeof a.d=="string"))(o)&&Zn(r,o,i))return;throw new TypeError("JSON Web Key for this operation must be a private JWK");case"encrypt":case"verify":if((a=>a.kty!=="oct"&&a.d===void 0&&a.priv===void 0)(o)&&Zn(r,o,i))return;throw new TypeError("JSON Web Key for this operation must be a public JWK")}if(!Io(o))throw new TypeError(Ro(r,o,"CryptoKey","KeyObject","JSON Web Key"));if(o.type==="secret")throw new TypeError("".concat(Ze(o),' instances for asymmetric algorithms must not be of type "secret"'));if(o.type==="public")switch(i){case"sign":throw new TypeError("".concat(Ze(o),' instances for asymmetric algorithm signing must be of type "private"'));case"decrypt":throw new TypeError("".concat(Ze(o),' instances for asymmetric algorithm decryption must be of type "private"'))}if(o.type==="private")switch(i){case"verify":throw new TypeError("".concat(Ze(o),' instances for asymmetric algorithm verifying must be of type "public"'));case"encrypt":throw new TypeError("".concat(Ze(o),' instances for asymmetric algorithm encryption must be of type "public"'))}})(n,e,t)}}var qt,qn,se,Oo;(typeof navigator>"u"||(qt=navigator.userAgent)===null||qt===void 0||(qn=qt.startsWith)===null||qn===void 0||!qn.call(qt,"Mozilla/5.0 "))&&(Oo="".concat("openid-client","/").concat("v6.8.1"),se={"user-agent":Oo});var W=n=>nn.get(n),nn,Bt;function mi(n){return n!==void 0?So(n):(Bt||(Bt=new WeakMap),(e,t,r,o)=>{let i;return(i=Bt.get(t))||((function(a,s){if(typeof a!="string")throw ce("".concat(s," must be a string"),Dt);if(a.length===0)throw ce("".concat(s," must not be empty"),jt)})(t.client_secret,'"metadata.client_secret"'),i=So(t.client_secret),Bt.set(t,i)),i(e,t,r,o)})}var ke=re,jt="ERR_INVALID_ARG_VALUE",Dt="ERR_INVALID_ARG_TYPE";function ce(n,e,t){let r=new TypeError(n,{cause:t});return Object.assign(r,{code:e}),r}function ts(n){return(async function(e){return L(e,"codeVerifier"),Ke(await crypto.subtle.digest("SHA-256",$e(e)))})(n)}function ns(){return ri()}var tt=class extends Error{constructor(e,t){var r;super(e,t),_(this,"code",void 0),this.name=this.constructor.name,this.code=t?.code,(r=Error.captureStackTrace)===null||r===void 0||r.call(Error,this,this.constructor)}};function M(n,e,t){return new tt(n,{cause:e,code:t})}function J(n){if(n instanceof TypeError||n instanceof tt||n instanceof Qe||n instanceof fn||n instanceof St)throw n;if(n instanceof kt)switch(n.code){case ci:throw M("only requests to HTTPS are allowed",n,n.code);case ui:throw M("only requests to HTTP or HTTPS are allowed",n,n.code);case Fr:throw M("unexpected HTTP response status code",n.cause,n.code);case si:throw M("unexpected response content-type",n.cause,n.code);case mn:throw M("parsing error occured",n,n.code);case T:throw M("invalid response encountered",n,n.code);case fe:throw M("unexpected JWT claim value encountered",n,n.code);case Pr:throw M("unexpected JSON attribute value encountered",n,n.code);case Et:throw M("JWT timestamp claim value failed validation",n,n.code);default:throw M(n.message,n,n.code)}if(n instanceof H)throw M("unsupported operation",n,n.code);if(n instanceof DOMException)switch(n.name){case"OperationError":throw M("runtime operation error",n,Tr);case"NotSupportedError":throw M("runtime unsupported operation",n,Tr);case"TimeoutError":throw M("operation timed out",n,"OAUTH_TIMEOUT");case"AbortError":throw M("operation aborted",n,"OAUTH_ABORT")}throw new tt("something went wrong",{cause:n})}async function rs(n,e,t,r,o){let i=await(async function(c,u){var h,f;if(!(c instanceof URL))throw ce('"server" must be an instance of URL',Dt);let l=!c.href.includes("/.well-known/"),d=(h=u?.timeout)!==null&&h!==void 0?h:30,w=AbortSignal.timeout(1e3*d),p=await(l?Sa(c,{algorithm:u?.algorithm,[re]:u?.[ke],[Y]:u==null||(f=u.execute)===null||f===void 0?void 0:f.includes(Lo),signal:w,headers:new Headers(se)}):(u?.[ke]||fetch)((zr(c,u==null||(m=u.execute)===null||m===void 0||!m.includes(Lo)),c.href),{headers:Object.fromEntries(new Headers(S({accept:"application/json"},se)).entries()),body:void 0,method:"GET",redirect:"manual",signal:w})).then(y=>(async function(b,k){let E=b;if(!(E instanceof URL)&&E!==Jn)throw R('"expectedIssuerIdentifier" must be an instance of URL',"ERR_INVALID_ARG_TYPE");if(!rt(k,Response))throw R('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");if(k.status!==200)throw A('"response" is not a conform Authorization Server Metadata response (unexpected HTTP status code)',Fr,k);Ot(k);let g=await Sn(k);if(L(g.issuer,'"response" body "issuer" property',T,{body:g}),E!==Jn&&new URL(g.issuer).href!==E.href)throw A('"response" body "issuer" property does not match the expected value',Pr,{expected:E.href,body:g,attribute:"issuer"});return g})(Jn,y)).catch(J);var m;return l&&new URL(p.issuer).href!==c.href&&((function(y,b,k){return!(y.origin!=="https://login.microsoftonline.com"||k!=null&&k.algorithm&&k.algorithm!=="oidc"||(b[yi]=!0,0))})(c,p,u)||(function(y,b){return!(!y.hostname.endsWith(".b2clogin.com")||b!=null&&b.algorithm&&b.algorithm!=="oidc")})(c,u)||(()=>{throw new tt("discovered metadata issuer does not match the expected issuer",{code:Pr,cause:{expected:c.href,body:p,attribute:"issuer"}})})()),p})(n,o),a=new nt(i,e,t,r),s=W(a);if(o!=null&&o[ke]&&(s.fetch=o[ke]),o!=null&&o.timeout&&(s.timeout=o.timeout),o!=null&&o.execute)for(let c of o.execute)c(a);return a}new TextDecoder;var yi=Symbol(),nt=class{constructor(e,t,r,o){var i,a,s,c,u;if(typeof t!="string"||!t.length)throw ce('"clientId" must be a non-empty string',Dt);if(typeof r=="string"&&(r={client_secret:r}),((i=r)===null||i===void 0?void 0:i.client_id)!==void 0&&t!==r.client_id)throw ce('"clientId" and "metadata.client_id" must be the same',jt);let h=S(S({},structuredClone(r)),{},{client_id:t}),f;h[_r]=(a=(s=r)===null||s===void 0?void 0:s[_r])!==null&&a!==void 0?a:0,h[kr]=(c=(u=r)===null||u===void 0?void 0:u[kr])!==null&&c!==void 0?c:30,f=o||(typeof h.client_secret=="string"&&h.client_secret.length?mi(h.client_secret):(p,m,y,b)=>{y.set("client_id",m.client_id)});let l=Object.freeze(h),d=structuredClone(e);yi in e&&(d[hi]=p=>{let{claims:{tid:m}}=p;return e.issuer.replace("{tenantid}",m)});let w=Object.freeze(d);nn||(nn=new WeakMap),nn.set(this,{__proto__:null,as:w,c:l,auth:f,tlsOnly:!0,jwksCache:{}})}serverMetadata(){let e=structuredClone(W(this).as);return(function(t){Object.defineProperties(t,(function(r){return{supportsPKCE:{__proto__:null,value(){var o;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"S256";return((o=r.code_challenge_methods_supported)===null||o===void 0?void 0:o.includes(i))===!0}}}})(t))})(e),e}clientMetadata(){return structuredClone(W(this).c)}get timeout(){return W(this).timeout}set timeout(e){W(this).timeout=e}get[ke](){return W(this).fetch}set[ke](e){W(this).fetch=e}};function Lt(n){Object.defineProperties(n,(function(e){let t;if(e.expires_in!==void 0){let r=new Date;r.setSeconds(r.getSeconds()+e.expires_in),t=r.getTime()}return{expiresIn:{__proto__:null,value(){if(t){let r=Date.now();return t>r?Math.floor((t-r)/1e3):0}}},claims:{__proto__:null,value(){try{return Ar(this)}catch{return}}}}})(n))}async function jo(n,e,t){var r;let o=arguments.length>3&&arguments[3]!==void 0&&arguments[3],i=(r=n.headers.get("retry-after"))===null||r===void 0?void 0:r.trim();if(i===void 0)return;let a;if(/^\d+$/.test(i))a=parseInt(i,10);else{let s=new Date(i);if(Number.isFinite(s.getTime())){let c=new Date,u=s.getTime()-c.getTime();u>0&&(a=Math.ceil(u/1e3))}}if(o&&!Number.isFinite(a))throw new kt("invalid Retry-After header value",{cause:n});a>e&&await gi(a-e,t)}function gi(n,e){return new Promise((t,r)=>{let o=i=>{try{e.throwIfAborted()}catch(s){return void r(s)}if(i<=0)return void t();let a=Math.min(i,5);setTimeout(()=>o(i-a),1e3*a)};o(n)})}async function Do(n,e){me(n);let{as:t,c:r,auth:o,fetch:i,tlsOnly:a,timeout:s}=W(n);return(async function(c,u,h,f,l){te(c),ne(u);let d=Ct(c,"backchannel_authentication_endpoint",u.use_mtls_endpoint_aliases,l?.[Y]!==!0),w=new URLSearchParams(f);w.set("client_id",u.client_id);let p=kn(l?.headers);return p.set("accept","application/json"),Jr(c,u,h,d,w,p,l)})(t,r,o,e,{[re]:i,[Y]:!a,headers:new Headers(se),signal:He(s)}).then(c=>(async function(u,h,f){if(te(u),ne(h),!rt(f,Response))throw R('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");await Hr(f,200,"Backchannel Authentication Endpoint"),Ot(f);let l=await Sn(f);L(l.auth_req_id,'"response" body "auth_req_id" property',T,{body:l});let d=typeof l.expires_in!="number"?parseFloat(l.expires_in):l.expires_in;return Se(d,!0,'"response" body "expires_in" property',T,{body:l}),l.expires_in=d,l.interval!==void 0&&Se(l.interval,!1,'"response" body "interval" property',T,{body:l}),l})(t,r,c)).catch(J)}async function wi(n,e,t,r){var o,i;me(n),t=new URLSearchParams(t);let a=(o=e.interval)!==null&&o!==void 0?o:5,s=(i=r?.signal)!==null&&i!==void 0?i:AbortSignal.timeout(1e3*e.expires_in);try{await gi(a,s)}catch(g){J(g)}let{as:c,c:u,auth:h,fetch:f,tlsOnly:l,nonRepudiation:d,timeout:w,decrypt:p}=W(n),m=(g,P)=>wi(n,S(S({},e),{},{interval:g}),t,S(S({},r),{},{signal:s,flag:P})),y=await(async function(g,P,G,N,ge){te(g),ne(P),L(N,'"authReqId"');let V=new URLSearchParams(ge?.additionalParameters);return V.set("auth_req_id",N),xt(g,P,G,"urn:openid:params:grant-type:ciba",V,ge)})(c,u,h,e.auth_req_id,{[re]:f,[Y]:!l,additionalParameters:t,DPoP:r?.DPoP,headers:new Headers(se),signal:s.aborted?s:He(w)}).catch(J);var b;if(y.status===503&&y.headers.has("retry-after"))return await jo(y,a,s,!0),await((b=y.body)===null||b===void 0?void 0:b.cancel()),m(a);let k=(async function(g,P,G,N){return et(g,P,G,void 0,N?.[ae],N?.recognizedTokenTypes)})(c,u,y,{[ae]:p}),E;try{E=await k}catch(g){if(Ut(g,r))return m(a,Ee);if(g instanceof Qe)switch(g.error){case"slow_down":a+=5;case"authorization_pending":return await jo(g.response,a,s),m(a)}J(g)}return E.id_token&&await d?.(y),Lt(E),E}function Lo(n){W(n).tlsOnly=!1}async function vi(n,e,t,r,o){if(me(n),!(o?.flag===Ee||e instanceof URL||(function(g,P){try{return Object.getPrototypeOf(g)[Symbol.toStringTag]===P}catch{return!1}})(e,"Request")))throw ce('"currentUrl" must be an instance of URL, or Request',Dt);let i,a,{as:s,c,auth:u,fetch:h,tlsOnly:f,jarm:l,hybrid:d,nonRepudiation:w,timeout:p,decrypt:m,implicit:y}=W(n);if(o?.flag===Ee)i=o.authResponse,a=o.redirectUri;else{if(!(e instanceof URL)){let g=e;switch(e=new URL(e.url),g.method){case"GET":break;case"POST":let P=new URLSearchParams(await Va(g));if(d)e.hash=P.toString();else for(let[G,N]of P.entries())e.searchParams.append(G,N);break;default:throw ce("unexpected Request HTTP method",jt)}}switch(a=(function(g){return(g=new URL(g)).search="",g.hash="",g.href})(e),!0){case!!l:i=await l(e,t?.expectedState);break;case!!d:i=await d(e,t?.expectedNonce,t?.expectedState,t?.maxAge);break;case!!y:throw new TypeError("authorizationCodeGrant() cannot be used by response_type=id_token clients");default:try{i=qa(s,c,e.searchParams,t?.expectedState)}catch(g){J(g)}}}let b=await(async function(g,P,G,N,ge,V,Je){if(te(g),ne(P),!Vr.has(N))throw R('"callbackParameters" must be an instance of URLSearchParams obtained from "validateAuthResponse()", or "validateJwtAuthResponse()',"ERR_INVALID_ARG_VALUE");L(ge,'"redirectUri"');let Br=De(N,"code");if(!Br)throw A('no authorization code in "callbackParameters"',T);let Nt=new URLSearchParams(Je?.additionalParameters);return Nt.set("redirect_uri",ge),Nt.set("code",Br),V!==Ao&&(L(V,'"codeVerifier"'),Nt.set("code_verifier",V)),xt(g,P,G,"authorization_code",Nt,Je)})(s,c,u,i,a,t?.pkceCodeVerifier||Ao,{additionalParameters:r,[re]:h,[Y]:!f,DPoP:o?.DPoP,headers:new Headers(se),signal:He(p)}).catch(J);typeof t?.expectedNonce!="string"&&typeof t?.maxAge!="number"||(t.idTokenExpected=!0);let k=Ka(s,c,b,{expectedNonce:t?.expectedNonce,maxAge:t?.maxAge,requireIdToken:t?.idTokenExpected,[ae]:m}),E;try{E=await k}catch(g){if(Ut(g,o))return vi(n,void 0,t,r,S(S({},o),{},{flag:Ee,authResponse:i,redirectUri:a}));J(g)}return E.id_token&&await w?.(b),Lt(E),E}async function bi(n,e,t,r){me(n),t=new URLSearchParams(t);let{as:o,c:i,auth:a,fetch:s,tlsOnly:c,nonRepudiation:u,timeout:h,decrypt:f}=W(n),l=await(async function(p,m,y,b,k){te(p),ne(m),L(b,'"refreshToken"');let E=new URLSearchParams(k?.additionalParameters);return E.set("refresh_token",b),xt(p,m,y,"refresh_token",E,k)})(o,i,a,e,{[re]:s,[Y]:!c,additionalParameters:t,DPoP:r?.DPoP,headers:new Headers(se),signal:He(h)}).catch(J),d=(async function(p,m,y,b){return et(p,m,y,void 0,b?.[ae],b?.recognizedTokenTypes)})(o,i,l,{[ae]:f}),w;try{w=await d}catch(p){if(Ut(p,r))return bi(n,e,t,S(S({},r),{},{flag:Ee}));J(p)}return w.id_token&&await u?.(l),Lt(w),w}async function _i(n,e,t){me(n),e=new URLSearchParams(e);let{as:r,c:o,auth:i,fetch:a,tlsOnly:s,timeout:c}=W(n),u=await(async function(l,d,w,p,m){return te(l),ne(d),xt(l,d,w,"client_credentials",new URLSearchParams(p),m)})(r,o,i,e,{[re]:a,[Y]:!s,DPoP:t?.DPoP,headers:new Headers(se),signal:He(c)}).catch(J),h=(async function(l,d,w,p){return et(l,d,w,void 0,p?.[ae],p?.recognizedTokenTypes)})(r,o,u),f;try{f=await h}catch(l){if(Ut(l,t))return _i(n,e,S(S({},t),{},{flag:Ee}));J(l)}return Lt(f),f}function Ir(n,e){me(n);let{as:t,c:r,tlsOnly:o,hybrid:i,jarm:a,implicit:s}=W(n),c=Ct(t,"authorization_endpoint",!1,o);if((e=new URLSearchParams(e)).has("client_id")||e.set("client_id",r.client_id),!e.has("request_uri")&&!e.has("request")){if(e.has("response_type")||e.set("response_type",i?"code id_token":s?"id_token":"code"),s&&!e.has("nonce"))throw ce("response_type=id_token clients must provide a nonce parameter in their authorization request parameters",jt);a&&e.set("response_mode","jwt")}for(let[u,h]of e.entries())c.searchParams.append(u,h);return c}async function ki(n,e,t){me(n);let r=Ir(n,e),{as:o,c:i,auth:a,fetch:s,tlsOnly:c,timeout:u}=W(n),h=await(async function(d,w,p,m,y){var b;te(d),ne(w);let k=Ct(d,"pushed_authorization_request_endpoint",w.use_mtls_endpoint_aliases,y?.[Y]!==!0),E=new URLSearchParams(m);E.set("client_id",w.client_id);let g=kn(y?.headers);g.set("accept","application/json"),y?.DPoP!==void 0&&(oi(y.DPoP),await y.DPoP.addProof(k,g,"POST"));let P=await Jr(d,w,p,k,E,g,y);return y==null||(b=y.DPoP)===null||b===void 0||b.cacheNonce(P,k),P})(o,i,a,r.searchParams,{[re]:s,[Y]:!c,DPoP:t?.DPoP,headers:new Headers(se),signal:He(u)}).catch(J),f=(async function(d,w,p){if(te(d),ne(w),!rt(p,Response))throw R('"response" must be an instance of Response',"ERR_INVALID_ARG_TYPE");await Hr(p,201,"Pushed Authorization Request Endpoint"),Ot(p);let m=await Sn(p);L(m.request_uri,'"response" body "request_uri" property',T,{body:m});let y=typeof m.expires_in!="number"?parseFloat(m.expires_in):m.expires_in;return Se(y,!0,'"response" body "expires_in" property',T,{body:m}),m.expires_in=y,m})(o,i,h),l;try{l=await f}catch(d){if(Ut(d,t))return ki(n,e,S(S({},t),{},{flag:Ee}));J(d)}return Ir(n,{request_uri:l.request_uri})}function me(n){if(!(n instanceof nt))throw ce('"config" must be an instance of Configuration',Dt);if(Object.getPrototypeOf(n)!==nt.prototype)throw ce("subclassing Configuration is not allowed",jt)}function He(n){return n?AbortSignal.timeout(1e3*n):void 0}function Ut(n,e){return!(e==null||!e.DPoP||e.flag===Ee)&&(function(t){if(t instanceof St){let{0:r,length:o}=t.cause;return o===1&&r.scheme==="dpop"&&r.parameters.error==="use_dpop_nonce"}return t instanceof Qe&&t.error==="use_dpop_nonce"})(n)}Object.freeze(nt.prototype);var Ee=Symbol();async function Gr(n,e,t,r){me(n);let{as:o,c:i,auth:a,fetch:s,tlsOnly:c,timeout:u,decrypt:h}=W(n),f=await(async function(l,d,w,p,m,y){return te(l),ne(d),L(p,'"grantType"'),xt(l,d,w,p,new URLSearchParams(m),y)})(o,i,a,e,new URLSearchParams(t),{[re]:s,[Y]:!c,DPoP:r?.DPoP,headers:new Headers(se),signal:He(u)}).then(l=>{let d;return e==="urn:ietf:params:oauth:grant-type:token-exchange"&&(d={n_a:()=>{}}),(async function(w,p,m,y){return et(w,p,m,void 0,y?.[ae],y?.recognizedTokenTypes)})(o,i,l,{[ae]:h,recognizedTokenTypes:d})}).catch(J);return Lt(f),f}async function os(n,e,t){if(e instanceof Uint8Array){if(!n.startsWith("HS"))throw new TypeError((function(r){for(var o=arguments.length,i=new Array(o>1?o-1:0),a=1;a<o;a++)i[a-1]=arguments[a];return di("Key must be ",r,...i)})(e,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",e,{hash:"SHA-".concat(n.slice(-3)),name:"HMAC"},!1,[t])}return Ba(e,n,t),e}async function is(n,e,t,r){let o=await os(n,e,"verify");(function(a,s){if(a.startsWith("RS")||a.startsWith("PS")){let{modulusLength:c}=s.algorithm;if(typeof c!="number"||c<2048)throw new TypeError("".concat(a," requires key modulusLength to be 2048 bits or larger"))}})(n,o);let i=(function(a,s){let c="SHA-".concat(a.slice(-3));switch(a){case"HS256":case"HS384":case"HS512":return{hash:c,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:c,name:"RSA-PSS",saltLength:parseInt(a.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:c,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:c,name:"ECDSA",namedCurve:s.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return{name:a};default:throw new z("alg ".concat(a," is not supported either by JOSE or your javascript runtime"))}})(n,o.algorithm);try{return await crypto.subtle.verify(i,o,t,r)}catch{return!1}}async function as(n,e,t){if(!Ae(n))throw new j("Flattened JWS must be an object");if(n.protected===void 0&&n.header===void 0)throw new j('Flattened JWS must have either of the "protected" or "header" members');if(n.protected!==void 0&&typeof n.protected!="string")throw new j("JWS Protected Header incorrect type");if(n.payload===void 0)throw new j("JWS Payload missing");if(typeof n.signature!="string")throw new j("JWS Signature missing or incorrect type");if(n.header!==void 0&&!Ae(n.header))throw new j("JWS Unprotected Header incorrect type");let r={};if(n.protected)try{let p=mt(n.protected);r=JSON.parse(At.decode(p))}catch{throw new j("JWS Protected Header is invalid")}if(!(function(){for(var p=arguments.length,m=new Array(p),y=0;y<p;y++)m[y]=arguments[y];let b=m.filter(Boolean);if(b.length===0||b.length===1)return!0;let k;for(let E of b){let g=Object.keys(E);if(k&&k.size!==0)for(let P of g){if(k.has(P))return!1;k.add(P)}else k=new Set(g)}return!0})(r,n.header))throw new j("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let o=S(S({},r),n.header),i=(function(p,m,y,b,k){if(k.crit!==void 0&&b?.crit===void 0)throw new p('"crit" (Critical) Header Parameter MUST be integrity protected');if(!b||b.crit===void 0)return new Set;if(!Array.isArray(b.crit)||b.crit.length===0||b.crit.some(g=>typeof g!="string"||g.length===0))throw new p('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let E;E=y!==void 0?new Map([...Object.entries(y),...m.entries()]):m;for(let g of b.crit){if(!E.has(g))throw new z('Extension Header Parameter "'.concat(g,'" is not recognized'));if(k[g]===void 0)throw new p('Extension Header Parameter "'.concat(g,'" is missing'));if(E.get(g)&&b[g]===void 0)throw new p('Extension Header Parameter "'.concat(g,'" MUST be integrity protected'))}return new Set(b.crit)})(j,new Map([["b64",!0]]),t?.crit,r,o),a=!0;if(i.has("b64")&&(a=r.b64,typeof a!="boolean"))throw new j('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:s}=o;if(typeof s!="string"||!s)throw new j('JWS "alg" (Algorithm) Header Parameter missing or invalid');let c=t&&(function(p,m){if(m!==void 0&&(!Array.isArray(m)||m.some(y=>typeof y!="string")))throw new TypeError('"'.concat(p,'" option must be an array of strings'));if(m)return new Set(m)})("algorithms",t.algorithms);if(c&&!c.has(s))throw new yn('"alg" (Algorithm) Header Parameter value not allowed');if(a){if(typeof n.payload!="string")throw new j("JWS Payload must be a string")}else if(typeof n.payload!="string"&&!(n.payload instanceof Uint8Array))throw new j("JWS Payload must be a string or an Uint8Array instance");let u=!1;typeof e=="function"&&(e=await e(r,n),u=!0),es(s,e,"verify");let h=(function(){for(var p=arguments.length,m=new Array(p),y=0;y<p;y++)m[y]=arguments[y];let b=m.reduce((g,P)=>{let{length:G}=P;return g+G},0),k=new Uint8Array(b),E=0;for(let g of m)k.set(g,E),E+=g.length;return k})(n.protected!==void 0?Vn(n.protected):new Uint8Array,Vn("."),typeof n.payload=="string"?a?Vn(n.payload):Po.encode(n.payload):n.payload),f;try{f=mt(n.signature)}catch{throw new j("Failed to base64url decode the signature")}let l=await Qa(e,s);if(!await is(s,l,f,h))throw new vn;let d;if(a)try{d=mt(n.payload)}catch{throw new j("Failed to base64url decode the payload")}else d=typeof n.payload=="string"?Po.encode(n.payload):n.payload;let w={payload:d};return n.protected!==void 0&&(w.protectedHeader=r),n.header!==void 0&&(w.unprotectedHeader=n.header),u?S(S({},w),{},{key:l}):w}var ss=n=>Math.floor(n.getTime()/1e3),cs=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function Uo(n){let e=cs.exec(n);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");let t=parseFloat(e[2]),r;switch(e[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":r=Math.round(t);break;case"minute":case"minutes":case"min":case"mins":case"m":r=Math.round(60*t);break;case"hour":case"hours":case"hr":case"hrs":case"h":r=Math.round(3600*t);break;case"day":case"days":case"d":r=Math.round(86400*t);break;case"week":case"weeks":case"w":r=Math.round(604800*t);break;default:r=Math.round(31557600*t)}return e[1]==="-"||e[4]==="ago"?-r:r}var Ko=n=>n.includes("/")?n.toLowerCase():"application/".concat(n.toLowerCase()),us=(n,e)=>typeof n=="string"?e.includes(n):!!Array.isArray(n)&&e.some(Set.prototype.has.bind(new Set(n)));async function hs(n,e,t){var r;let o=await(async function(s,c,u){if(s instanceof Uint8Array&&(s=At.decode(s)),typeof s!="string")throw new j("Compact JWS must be a string or Uint8Array");let{0:h,1:f,2:l,length:d}=s.split(".");if(d!==3)throw new j("Invalid Compact JWS");let w=await as({payload:f,protected:h,signature:l},c,u),p={payload:w.payload,protectedHeader:w.protectedHeader};return typeof c=="function"?S(S({},p),{},{key:w.key}):p})(n,e,t);if((r=o.protectedHeader.crit)!==null&&r!==void 0&&r.includes("b64")&&o.protectedHeader.b64===!1)throw new Pt("JWTs MUST NOT use unencoded payload");let i=(function(s,c){let u,h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};try{u=JSON.parse(At.decode(c))}catch{}if(!Ae(u))throw new Pt("JWT Claims Set must be a top-level JSON object");let{typ:f}=h;if(f&&(typeof s.typ!="string"||Ko(s.typ)!==Ko(f)))throw new Z('unexpected "typ" JWT header value',u,"typ","check_failed");let{requiredClaims:l=[],issuer:d,subject:w,audience:p,maxTokenAge:m}=h,y=[...l];m!==void 0&&y.push("iat"),p!==void 0&&y.push("aud"),w!==void 0&&y.push("sub"),d!==void 0&&y.push("iss");for(let g of new Set(y.reverse()))if(!(g in u))throw new Z('missing required "'.concat(g,'" claim'),u,g,"missing");if(d&&!(Array.isArray(d)?d:[d]).includes(u.iss))throw new Z('unexpected "iss" claim value',u,"iss","check_failed");if(w&&u.sub!==w)throw new Z('unexpected "sub" claim value',u,"sub","check_failed");if(p&&!us(u.aud,typeof p=="string"?[p]:p))throw new Z('unexpected "aud" claim value',u,"aud","check_failed");let b;switch(typeof h.clockTolerance){case"string":b=Uo(h.clockTolerance);break;case"number":b=h.clockTolerance;break;case"undefined":b=0;break;default:throw new TypeError("Invalid clockTolerance option type")}let{currentDate:k}=h,E=ss(k||new Date);if((u.iat!==void 0||m)&&typeof u.iat!="number")throw new Z('"iat" claim must be a number',u,"iat","invalid");if(u.nbf!==void 0){if(typeof u.nbf!="number")throw new Z('"nbf" claim must be a number',u,"nbf","invalid");if(u.nbf>E+b)throw new Z('"nbf" claim timestamp check failed',u,"nbf","check_failed")}if(u.exp!==void 0){if(typeof u.exp!="number")throw new Z('"exp" claim must be a number',u,"exp","invalid");if(u.exp<=E-b)throw new Tt('"exp" claim timestamp check failed',u,"exp","check_failed")}if(m){let g=E-u.iat;if(g-b>(typeof m=="number"?m:Uo(m)))throw new Tt('"iat" claim timestamp check failed (too far in the past)',u,"iat","check_failed");if(g<0-b)throw new Z('"iat" claim timestamp check failed (it should be in the past)',u,"iat","check_failed")}return u})(o.protectedHeader,o.payload,t),a={payload:i,protectedHeader:o.protectedHeader};return typeof e=="function"?S(S({},a),{},{key:o.key}):a}function ls(n){return Ae(n)}var Yt,Bn,Xt=new WeakMap,Yn=new WeakMap,Cr=class{constructor(e){if(U(this,Xt,void 0),U(this,Yn,new WeakMap),!(function(t){return t&&typeof t=="object"&&Array.isArray(t.keys)&&t.keys.every(ls)})(e))throw new Rt("JSON Web Key Set malformed");x(Xt,this,structuredClone(e))}jwks(){return v(Xt,this)}async getKey(e,t){let{alg:r,kid:o}=S(S({},e),t?.header),i=(function(u){switch(typeof u=="string"&&u.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";case"ML":return"AKP";default:throw new z('Unsupported "alg" value for a JSON Web Key Set')}})(r),a=v(Xt,this).keys.filter(u=>{let h=i===u.kty;if(h&&typeof o=="string"&&(h=o===u.kid),!h||typeof u.alg!="string"&&i!=="AKP"||(h=r===u.alg),h&&typeof u.use=="string"&&(h=u.use==="sig"),h&&Array.isArray(u.key_ops)&&(h=u.key_ops.includes("verify")),h)switch(r){case"ES256":h=u.crv==="P-256";break;case"ES384":h=u.crv==="P-384";break;case"ES512":h=u.crv==="P-521";break;case"Ed25519":case"EdDSA":h=u.crv==="Ed25519"}return h}),{0:s,length:c}=a;if(c===0)throw new It;if(c!==1){let u=new gn,h=v(Yn,this);throw u[Symbol.asyncIterator]=wa(function*(){for(let f of a)try{yield yield ga(No(h,f,r))}catch{}}),u}return No(v(Yn,this),s,r)}};async function No(n,e,t){let r=n.get(e)||n.set(e,{}).get(e);if(r[t]===void 0){let o=await(async function(i,a,s){var c;if(!Ae(i))throw new TypeError("JWK must be an object");let u;switch(a!=null||(a=i.alg),u!=null||(u=(c=s?.extractable)!==null&&c!==void 0?c:i.ext),i.kty){case"oct":if(typeof i.k!="string"||!i.k)throw new TypeError('missing "k" (Key Value) Parameter value');return mt(i.k);case"RSA":if("oth"in i&&i.oth!==void 0)throw new z('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return tn(S(S({},i),{},{alg:a,ext:u}));case"AKP":if(typeof i.alg!="string"||!i.alg)throw new TypeError('missing "alg" (Algorithm) Parameter value');if(a!==void 0&&a!==i.alg)throw new TypeError("JWK alg and alg option value mismatch");return tn(S(S({},i),{},{ext:u}));case"EC":case"OKP":return tn(S(S({},i),{},{alg:a,ext:u}));default:throw new z('Unsupported "kty" (Key Type) Parameter value')}})(S(S({},e),{},{ext:!0}),t);if(o instanceof Uint8Array||o.type!=="public")throw new Rt("JSON Web Key Set members must be public keys");r[t]=o}return r[t]}function Wo(n){let e=new Cr(n),t=async(r,o)=>e.getKey(r,o);return Object.defineProperties(t,{jwks:{value:()=>structuredClone(e.jwks()),enumerable:!1,configurable:!1,writable:!1}}),t}var xr;(typeof navigator>"u"||(Yt=navigator.userAgent)===null||Yt===void 0||(Bn=Yt.startsWith)===null||Bn===void 0||!Bn.call(Yt,"Mozilla/5.0 "))&&(xr="".concat("jose","/").concat("v6.1.3"));var Si=Symbol(),Xn=Symbol(),$n=new WeakMap,Qn=new WeakMap,er=new WeakMap,$t=new WeakMap,Ie=new WeakMap,de=new WeakMap,we=new WeakMap,tr=new WeakMap,Ce=new WeakMap,xe=new WeakMap,Or=class{constructor(e,t){if(U(this,$n,void 0),U(this,Qn,void 0),U(this,er,void 0),U(this,$t,void 0),U(this,Ie,void 0),U(this,de,void 0),U(this,we,void 0),U(this,tr,void 0),U(this,Ce,void 0),U(this,xe,void 0),!(e instanceof URL))throw new TypeError("url must be an instance of URL");var r,o;x($n,this,new URL(e.href)),x(Qn,this,typeof t?.timeoutDuration=="number"?t?.timeoutDuration:5e3),x(er,this,typeof t?.cooldownDuration=="number"?t?.cooldownDuration:3e4),x($t,this,typeof t?.cacheMaxAge=="number"?t?.cacheMaxAge:6e5),x(we,this,new Headers(t?.headers)),xr&&!v(we,this).has("User-Agent")&&v(we,this).set("User-Agent",xr),v(we,this).has("accept")||(v(we,this).set("accept","application/json"),v(we,this).append("accept","application/jwk-set+json")),x(tr,this,t?.[Si]),t?.[Xn]!==void 0&&(x(xe,this,t?.[Xn]),r=t?.[Xn],o=v($t,this),typeof r=="object"&&r!==null&&"uat"in r&&typeof r.uat=="number"&&!(Date.now()-r.uat>=o)&&"jwks"in r&&Ae(r.jwks)&&Array.isArray(r.jwks.keys)&&Array.prototype.every.call(r.jwks.keys,Ae)&&(x(Ie,this,v(xe,this).uat),x(Ce,this,Wo(v(xe,this).jwks))))}pendingFetch(){return!!v(de,this)}coolingDown(){return typeof v(Ie,this)=="number"&&Date.now()<v(Ie,this)+v(er,this)}fresh(){return typeof v(Ie,this)=="number"&&Date.now()<v(Ie,this)+v($t,this)}jwks(){var e;return(e=v(Ce,this))===null||e===void 0?void 0:e.jwks()}async getKey(e,t){v(Ce,this)&&this.fresh()||await this.reload();try{return await v(Ce,this).call(this,e,t)}catch(r){if(r instanceof It&&this.coolingDown()===!1)return await this.reload(),v(Ce,this).call(this,e,t);throw r}}async reload(){v(de,this)&&(typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||typeof EdgeRuntime<"u"&&EdgeRuntime==="vercel")&&x(de,this,void 0),v(de,this)||x(de,this,(async function(e,t,r){let i=await(arguments.length>3&&arguments[3]!==void 0?arguments[3]:fetch)(e,{method:"GET",signal:r,redirect:"manual",headers:t}).catch(a=>{throw a.name==="TimeoutError"?new wn:a});if(i.status!==200)throw new K("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await i.json()}catch{throw new K("Failed to parse the JSON Web Key Set HTTP response as JSON")}})(v($n,this).href,v(we,this),AbortSignal.timeout(v(Qn,this)),v(tr,this)).then(e=>{x(Ce,this,Wo(e)),v(xe,this)&&(v(xe,this).uat=Date.now(),v(xe,this).jwks=e),x(Ie,this,Date.now()),x(de,this,void 0)}).catch(e=>{throw x(de,this,void 0),e})),await v(de,this)}},ds=["mfaToken"],ps=["mfaToken"],Oe,Qt,je,be,Ye,I,lt,O,Mo=class extends Error{constructor(n,e){super(e),_(this,"code",void 0),this.name="NotSupportedError",this.code=n}},ye=class extends Error{constructor(n,e,t){super(e),_(this,"cause",void 0),_(this,"code",void 0),this.code=n,this.cause=t&&{error:t.error,error_description:t.error_description,message:t.message}}},fs=class extends ye{constructor(n,e){super("token_by_code_error",n,e),this.name="TokenByCodeError"}},ms=class extends ye{constructor(n,e){super("token_by_client_credentials_error",n,e),this.name="TokenByClientCredentialsError"}},ys=class extends ye{constructor(n,e){super("token_by_refresh_token_error",n,e),this.name="TokenByRefreshTokenError"}},nr=class extends ye{constructor(n,e){super("token_for_connection_error",n,e),this.name="TokenForConnectionErrorCode"}},ie=class extends ye{constructor(n,e){super("token_exchange_error",n,e),this.name="TokenExchangeError"}},ve=class extends Error{constructor(n){super(n),_(this,"code","verify_logout_token_error"),this.name="VerifyLogoutTokenError"}},rr=class extends ye{constructor(n){super("backchannel_authentication_error","There was an error when trying to use Client-Initiated Backchannel Authentication.",n),_(this,"code","backchannel_authentication_error"),this.name="BackchannelAuthenticationError"}},gs=class extends ye{constructor(n){super("build_authorization_url_error","There was an error when trying to build the authorization URL.",n),this.name="BuildAuthorizationUrlError"}},ws=class extends ye{constructor(n){super("build_link_user_url_error","There was an error when trying to build the Link User URL.",n),this.name="BuildLinkUserUrlError"}},vs=class extends ye{constructor(n){super("build_unlink_user_url_error","There was an error when trying to build the Unlink User URL.",n),this.name="BuildUnlinkUserUrlError"}},bs=class extends Error{constructor(){super("The client secret or client assertion signing key must be provided."),_(this,"code","missing_client_auth_error"),this.name="MissingClientAuthError"}};function jr(n){return Object.entries(n).filter(e=>{let[,t]=e;return t!==void 0}).reduce((e,t)=>S(S({},e),{},{[t[0]]:t[1]}),{})}var En=class extends Error{constructor(n,e,t){super(e),_(this,"cause",void 0),_(this,"code",void 0),this.code=n,this.cause=t&&{error:t.error,error_description:t.error_description,message:t.message}}},Ei=class extends En{constructor(n,e){super("mfa_list_authenticators_error",n,e),this.name="MfaListAuthenticatorsError"}},Ai=class extends En{constructor(n,e){super("mfa_enrollment_error",n,e),this.name="MfaEnrollmentError"}},_s=class extends En{constructor(n,e){super("mfa_delete_authenticator_error",n,e),this.name="MfaDeleteAuthenticatorError"}},Ti=class extends En{constructor(n,e){super("mfa_challenge_error",n,e),this.name="MfaChallengeError"}};function ks(n){return{id:n.id,authenticatorType:n.authenticator_type,active:n.active,name:n.name,oobChannels:n.oob_channels,type:n.type}}var Ss=(Oe=new WeakMap,Qt=new WeakMap,je=new WeakMap,class{constructor(n){var e;U(this,Oe,void 0),U(this,Qt,void 0),U(this,je,void 0),x(Oe,this,"https://".concat(n.domain)),x(Qt,this,n.clientId),x(je,this,(e=n.customFetch)!==null&&e!==void 0?e:function(){return fetch(...arguments)})}async listAuthenticators(n){let e="".concat(v(Oe,this),"/mfa/authenticators"),{mfaToken:t}=n,r=await v(je,this).call(this,e,{method:"GET",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});if(!r.ok){let o=await r.json();throw new Ei(o.error_description||"Failed to list authenticators",o)}return(await r.json()).map(ks)}async enrollAuthenticator(n){let e="".concat(v(Oe,this),"/mfa/associate"),{mfaToken:t}=n,r=_o(n,ds),o={authenticator_types:r.authenticatorTypes};"oobChannels"in r&&(o.oob_channels=r.oobChannels),"phoneNumber"in r&&r.phoneNumber&&(o.phone_number=r.phoneNumber),"email"in r&&r.email&&(o.email=r.email);let i=await v(je,this).call(this,e,{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify(o)});if(!i.ok){let a=await i.json();throw new Ai(a.error_description||"Failed to enroll authenticator",a)}return(function(a){if(a.authenticator_type==="otp")return{authenticatorType:"otp",secret:a.secret,barcodeUri:a.barcode_uri,recoveryCodes:a.recovery_codes,id:a.id};if(a.authenticator_type==="oob")return{authenticatorType:"oob",oobChannel:a.oob_channel,oobCode:a.oob_code,bindingMethod:a.binding_method,id:a.id};throw new Error("Unexpected authenticator type: ".concat(a.authenticator_type))})(await i.json())}async deleteAuthenticator(n){let{authenticatorId:e,mfaToken:t}=n,r="".concat(v(Oe,this),"/mfa/authenticators/").concat(encodeURIComponent(e)),o=await v(je,this).call(this,r,{method:"DELETE",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});if(!o.ok){let i=await o.json();throw new _s(i.error_description||"Failed to delete authenticator",i)}}async challengeAuthenticator(n){let e="".concat(v(Oe,this),"/mfa/challenge"),{mfaToken:t}=n,r=_o(n,ps),o={mfa_token:t,client_id:v(Qt,this),challenge_type:r.challengeType};r.authenticatorId&&(o.authenticator_id=r.authenticatorId);let i=await v(je,this).call(this,e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!i.ok){let a=await i.json();throw new Ti(a.error_description||"Failed to challenge authenticator",a)}return(function(a){let s={challengeType:a.challenge_type};return a.oob_code!==void 0&&(s.oobCode=a.oob_code),a.binding_method!==void 0&&(s.bindingMethod=a.binding_method),s})(await i.json())}}),Ue=class Pi{constructor(e,t,r,o,i,a,s){_(this,"accessToken",void 0),_(this,"idToken",void 0),_(this,"refreshToken",void 0),_(this,"expiresAt",void 0),_(this,"scope",void 0),_(this,"claims",void 0),_(this,"authorizationDetails",void 0),_(this,"tokenType",void 0),_(this,"issuedTokenType",void 0),this.accessToken=e,this.idToken=r,this.refreshToken=o,this.expiresAt=t,this.scope=i,this.claims=a,this.authorizationDetails=s}static fromTokenEndpointResponse(e){let t=e.id_token?e.claims():void 0,r=new Pi(e.access_token,Math.floor(Date.now()/1e3)+Number(e.expires_in),e.id_token,e.refresh_token,e.scope,t,e.authorization_details);return r.tokenType=e.token_type,r.issuedTokenType=e.issued_token_type,r}},Dr="openid profile email offline_access",Es=Object.freeze(new Set(["grant_type","client_id","client_secret","client_assertion","client_assertion_type","subject_token","subject_token_type","requested_token_type","actor_token","actor_token_type","audience","aud","resource","resources","resource_indicator","scope","connection","login_hint","organization","assertion"]));function Ri(n){if(n==null)throw new ie("subject_token is required");if(typeof n!="string")throw new ie("subject_token must be a string");if(n.trim().length===0)throw new ie("subject_token cannot be blank or whitespace");if(n!==n.trim())throw new ie("subject_token must not include leading or trailing whitespace");if(/^bearer\s+/i.test(n))throw new ie("subject_token must not include the 'Bearer ' prefix")}function Ii(n,e){if(e){for(let[t,r]of Object.entries(e))if(!Es.has(t))if(Array.isArray(r)){if(r.length>20)throw new ie("Parameter '".concat(t,"' exceeds maximum array size of ").concat(20));r.forEach(o=>{n.append(t,o)})}else n.append(t,r)}}var As=(be=new WeakMap,Ye=new WeakMap,I=new WeakMap,lt=new WeakMap,O=new WeakSet,class{constructor(n){if((function(e,t){Qo(e,t),t.add(e)})(this,O),U(this,be,void 0),U(this,Ye,void 0),U(this,I,void 0),U(this,lt,void 0),_(this,"mfa",void 0),x(I,this,n),n.useMtls&&!n.customFetch)throw new Mo("mtls_without_custom_fetch_not_supported","Using mTLS without a custom fetch implementation is not supported");this.mfa=new Ss({domain:v(I,this).domain,clientId:v(I,this).clientId,customFetch:v(I,this).customFetch})}async buildAuthorizationUrl(n){let{serverMetadata:e}=await D(O,this,B).call(this);if(n!=null&&n.pushedAuthorizationRequests&&!e.pushed_authorization_request_endpoint)throw new Mo("par_not_supported_error","The Auth0 tenant does not have pushed authorization requests enabled. Learn how to enable it here: https://auth0.com/docs/get-started/applications/configure-par");try{return await D(O,this,or).call(this,n)}catch(t){throw new gs(t)}}async buildLinkUserUrl(n){try{let e=await D(O,this,or).call(this,{authorizationParams:S(S({},n.authorizationParams),{},{requested_connection:n.connection,requested_connection_scope:n.connectionScope,scope:"openid link_account offline_access",id_token_hint:n.idToken})});return{linkUserUrl:e.authorizationUrl,codeVerifier:e.codeVerifier}}catch(e){throw new ws(e)}}async buildUnlinkUserUrl(n){try{let e=await D(O,this,or).call(this,{authorizationParams:S(S({},n.authorizationParams),{},{requested_connection:n.connection,scope:"openid unlink_account",id_token_hint:n.idToken})});return{unlinkUserUrl:e.authorizationUrl,codeVerifier:e.codeVerifier}}catch(e){throw new vs(e)}}async backchannelAuthentication(n){let{configuration:e,serverMetadata:t}=await D(O,this,B).call(this),r=jr(S(S({},v(I,this).authorizationParams),n?.authorizationParams)),o=new URLSearchParams(S(S({scope:Dr},r),{},{client_id:v(I,this).clientId,binding_message:n.bindingMessage,login_hint:JSON.stringify({format:"iss_sub",iss:t.issuer,sub:n.loginHint.sub})}));n.requestedExpiry&&o.append("requested_expiry",n.requestedExpiry.toString()),n.authorizationDetails&&o.append("authorization_details",JSON.stringify(n.authorizationDetails));try{let i=await Do(e,o),a=await wi(e,i);return Ue.fromTokenEndpointResponse(a)}catch(i){throw new rr(i)}}async initiateBackchannelAuthentication(n){let{configuration:e,serverMetadata:t}=await D(O,this,B).call(this),r=jr(S(S({},v(I,this).authorizationParams),n?.authorizationParams)),o=new URLSearchParams(S(S({scope:Dr},r),{},{client_id:v(I,this).clientId,binding_message:n.bindingMessage,login_hint:JSON.stringify({format:"iss_sub",iss:t.issuer,sub:n.loginHint.sub})}));n.requestedExpiry&&o.append("requested_expiry",n.requestedExpiry.toString()),n.authorizationDetails&&o.append("authorization_details",JSON.stringify(n.authorizationDetails));try{let i=await Do(e,o);return{authReqId:i.auth_req_id,expiresIn:i.expires_in,interval:i.interval}}catch(i){throw new rr(i)}}async backchannelAuthenticationGrant(n){let{authReqId:e}=n,{configuration:t}=await D(O,this,B).call(this),r=new URLSearchParams({auth_req_id:e});try{let o=await Gr(t,"urn:openid:params:grant-type:ciba",r);return Ue.fromTokenEndpointResponse(o)}catch(o){throw new rr(o)}}async getTokenForConnection(n){var e;if(n.refreshToken&&n.accessToken)throw new nr("Either a refresh or access token should be specified, but not both.");let t=(e=n.accessToken)!==null&&e!==void 0?e:n.refreshToken;if(!t)throw new nr("Either a refresh or access token must be specified.");try{return await this.exchangeToken({connection:n.connection,subjectToken:t,subjectTokenType:n.accessToken?"urn:ietf:params:oauth:token-type:access_token":"urn:ietf:params:oauth:token-type:refresh_token",loginHint:n.loginHint})}catch(r){throw r instanceof ie?new nr(r.message,r.cause):r}}async exchangeToken(n){return"connection"in n?D(O,this,Ts).call(this,n):D(O,this,Ps).call(this,n)}async getTokenByCode(n,e){let{configuration:t}=await D(O,this,B).call(this);try{let r=await vi(t,n,{pkceCodeVerifier:e.codeVerifier});return Ue.fromTokenEndpointResponse(r)}catch(r){throw new fs("There was an error while trying to request a token.",r)}}async getTokenByRefreshToken(n){let{configuration:e}=await D(O,this,B).call(this);try{let t=await bi(e,n.refreshToken);return Ue.fromTokenEndpointResponse(t)}catch(t){throw new ys("The access token has expired and there was an error while trying to refresh it.",t)}}async getTokenByClientCredentials(n){let{configuration:e}=await D(O,this,B).call(this);try{let t=new URLSearchParams({audience:n.audience});n.organization&&t.append("organization",n.organization);let r=await _i(e,t);return Ue.fromTokenEndpointResponse(r)}catch(t){throw new ms("There was an error while trying to request a token.",t)}}async buildLogoutUrl(n){let{configuration:e,serverMetadata:t}=await D(O,this,B).call(this);if(!t.end_session_endpoint){let r=new URL("https://".concat(v(I,this).domain,"/v2/logout"));return r.searchParams.set("returnTo",n.returnTo),r.searchParams.set("client_id",v(I,this).clientId),r}return(function(r,o){me(r);let{as:i,c:a,tlsOnly:s}=W(r),c=Ct(i,"end_session_endpoint",!1,s);(o=new URLSearchParams(o)).has("client_id")||o.set("client_id",a.client_id);for(let[u,h]of o.entries())c.searchParams.append(u,h);return c})(e,{post_logout_redirect_uri:n.returnTo})}async verifyLogoutToken(n){let{serverMetadata:e}=await D(O,this,B).call(this);v(lt,this)||x(lt,this,(function(r,o){let i=new Or(r,o),a=async(s,c)=>i.getKey(s,c);return Object.defineProperties(a,{coolingDown:{get:()=>i.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>i.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>i.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>i.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>i.jwks(),enumerable:!0,configurable:!1,writable:!1}}),a})(new URL(e.jwks_uri),{[Si]:v(I,this).customFetch}));let{payload:t}=await hs(n.logoutToken,v(lt,this),{issuer:e.issuer,audience:v(I,this).clientId,algorithms:["RS256"],requiredClaims:["iat"]});if(!("sid"in t)&&!("sub"in t))throw new ve('either "sid" or "sub" (or both) claims must be present');if("sid"in t&&typeof t.sid!="string")throw new ve('"sid" claim must be a string');if("sub"in t&&typeof t.sub!="string")throw new ve('"sub" claim must be a string');if("nonce"in t)throw new ve('"nonce" claim is prohibited');if(!("events"in t))throw new ve('"events" claim is missing');if(typeof t.events!="object"||t.events===null)throw new ve('"events" claim must be an object');if(!("http://schemas.openid.net/event/backchannel-logout"in t.events))throw new ve('"http://schemas.openid.net/event/backchannel-logout" member is missing in the "events" claim');if(typeof t.events["http://schemas.openid.net/event/backchannel-logout"]!="object")throw new ve('"http://schemas.openid.net/event/backchannel-logout" member in the "events" claim must be an object');return{sid:t.sid,sub:t.sub}}});async function B(){if(v(be,this)&&v(Ye,this))return{configuration:v(be,this),serverMetadata:v(Ye,this)};let n=await D(O,this,Rs).call(this);return x(be,this,await rs(new URL("https://".concat(v(I,this).domain)),v(I,this).clientId,{use_mtls_endpoint_aliases:v(I,this).useMtls},n,{[ke]:v(I,this).customFetch})),x(Ye,this,v(be,this).serverMetadata()),v(be,this)[ke]=v(I,this).customFetch||fetch,{configuration:v(be,this),serverMetadata:v(Ye,this)}}async function Ts(n){var e,t;let{configuration:r}=await D(O,this,B).call(this);if("audience"in n||"resource"in n)throw new ie("audience and resource parameters are not supported for Token Vault exchanges");Ri(n.subjectToken);let o=new URLSearchParams({connection:n.connection,subject_token:n.subjectToken,subject_token_type:(e=n.subjectTokenType)!==null&&e!==void 0?e:"urn:ietf:params:oauth:token-type:access_token",requested_token_type:(t=n.requestedTokenType)!==null&&t!==void 0?t:"http://auth0.com/oauth/token-type/federated-connection-access-token"});n.loginHint&&o.append("login_hint",n.loginHint),n.scope&&o.append("scope",n.scope),Ii(o,n.extra);try{let i=await Gr(r,"urn:auth0:params:oauth:grant-type:token-exchange:federated-connection-access-token",o);return Ue.fromTokenEndpointResponse(i)}catch(i){throw new ie("Failed to exchange token for connection '".concat(n.connection,"'."),i)}}async function Ps(n){let{configuration:e}=await D(O,this,B).call(this);Ri(n.subjectToken);let t=new URLSearchParams({subject_token_type:n.subjectTokenType,subject_token:n.subjectToken});n.audience&&t.append("audience",n.audience),n.scope&&t.append("scope",n.scope),n.requestedTokenType&&t.append("requested_token_type",n.requestedTokenType),n.organization&&t.append("organization",n.organization),Ii(t,n.extra);try{let r=await Gr(e,"urn:ietf:params:oauth:grant-type:token-exchange",t);return Ue.fromTokenEndpointResponse(r)}catch(r){throw new ie("Failed to exchange token of type '".concat(n.subjectTokenType,"'").concat(n.audience?" for audience '".concat(n.audience,"'"):"","."),r)}}async function Rs(){if(!v(I,this).clientSecret&&!v(I,this).clientAssertionSigningKey&&!v(I,this).useMtls)throw new bs;if(v(I,this).useMtls)return(e,t,r,o)=>{r.set("client_id",t.client_id)};let n=v(I,this).clientAssertionSigningKey;return!n||n instanceof CryptoKey||(n=await(async function(e,t,r){if(typeof e!="string"||e.indexOf("-----BEGIN PRIVATE KEY-----")!==0)throw new TypeError('"pkcs8" must be PKCS#8 formatted string');return $a(e,t,r)})(n,v(I,this).clientAssertionSigningAlg||"RS256")),n?(function(e,t){return Aa(e,t)})(n):mi(v(I,this).clientSecret)}async function or(n){let{configuration:e}=await D(O,this,B).call(this),t=ns(),r=await ts(t),o=jr(S(S({},v(I,this).authorizationParams),n?.authorizationParams)),i=new URLSearchParams(S(S({scope:Dr},o),{},{client_id:v(I,this).clientId,code_challenge:r,code_challenge_method:"S256"}));return{authorizationUrl:n!=null&&n.pushedAuthorizationRequests?await ki(e,i):await Ir(e,i),codeVerifier:t}}var ze=class n extends C{constructor(e,t){super(e,t),Object.setPrototypeOf(this,n.prototype)}static fromPayload(e){let{error:t,error_description:r}=e;return new n(t,r)}},bn=class n extends ze{constructor(e,t){super(e,t),Object.setPrototypeOf(this,n.prototype)}},Lr=class n extends ze{constructor(e,t){super(e,t),Object.setPrototypeOf(this,n.prototype)}},Ur=class n extends ze{constructor(e,t){super(e,t),Object.setPrototypeOf(this,n.prototype)}},Xe=class n extends ze{constructor(e,t){super(e,t),Object.setPrototypeOf(this,n.prototype)}},Kr=class n extends ze{constructor(e,t){super(e,t),Object.setPrototypeOf(this,n.prototype)}},Nr=class{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:6e5;this.contexts=new Map,this.ttlMs=e}set(e,t){this.cleanup(),this.contexts.set(e,Object.assign(Object.assign({},t),{createdAt:Date.now()}))}get(e){let t=this.contexts.get(e);if(t){if(!(Date.now()-t.createdAt>this.ttlMs))return t;this.contexts.delete(e)}}remove(e){this.contexts.delete(e)}cleanup(){let e=Date.now();for(let[t,r]of this.contexts)e-r.createdAt>this.ttlMs&&this.contexts.delete(t)}get size(){return this.contexts.size}},Wr=class{constructor(e,t){this.authJsMfaClient=e,this.auth0Client=t,this.contextManager=new Nr}setMFAAuthDetails(e,t,r,o){this.contextManager.set(e,{scope:t,audience:r,mfaRequirements:o})}async getAuthenticators(e){var t,r;let o=this.contextManager.get(e);if(!(!((t=o?.mfaRequirements)===null||t===void 0)&&t.challenge)||o.mfaRequirements.challenge.length===0)throw new bn("invalid_request","challengeType is required and must contain at least one challenge type, please check mfa_required error payload");let i=o.mfaRequirements.challenge.map(a=>a.type);try{return(await this.authJsMfaClient.listAuthenticators({mfaToken:e})).filter(a=>!!a.type&&i.includes(a.type))}catch(a){throw a instanceof Ei?new bn((r=a.cause)===null||r===void 0?void 0:r.error,a.message):a}}async enroll(e){var t;let r=(function(o){let i=pa[o.factorType];return Object.assign(Object.assign(Object.assign({mfaToken:o.mfaToken,authenticatorTypes:i.authenticatorTypes},i.oobChannels&&{oobChannels:i.oobChannels}),"phoneNumber"in o&&{phoneNumber:o.phoneNumber}),"email"in o&&{email:o.email})})(e);try{return await this.authJsMfaClient.enrollAuthenticator(r)}catch(o){throw o instanceof Ai?new Lr((t=o.cause)===null||t===void 0?void 0:t.error,o.message):o}}async challenge(e){var t;try{let r={challengeType:e.challengeType,mfaToken:e.mfaToken};return e.authenticatorId&&(r.authenticatorId=e.authenticatorId),await this.authJsMfaClient.challengeAuthenticator(r)}catch(r){throw r instanceof Ti?new Ur((t=r.cause)===null||t===void 0?void 0:t.error,r.message):r}}async getEnrollmentFactors(e){let t=this.contextManager.get(e);if(!t||!t.mfaRequirements)throw new Kr("mfa_context_not_found","MFA context not found for this MFA token. Please retry the original request to get a new MFA token.");return t.mfaRequirements.enroll&&t.mfaRequirements.enroll.length!==0?t.mfaRequirements.enroll:[]}async verify(e){let t=this.contextManager.get(e.mfaToken);if(!t)throw new Xe("mfa_context_not_found","MFA context not found for this MFA token. Please retry the original request to get a new MFA token.");let r=(function(a){return"otp"in a&&a.otp?fa:"oobCode"in a&&a.oobCode?ma:"recoveryCode"in a&&a.recoveryCode?ya:void 0})(e);if(!r)throw new Xe("invalid_request","Unable to determine grant type. Provide one of: otp, oobCode, or recoveryCode.");let o=t.scope,i=t.audience;try{let a=await this.auth0Client._requestTokenForMfa({grant_type:r,mfaToken:e.mfaToken,scope:o,audience:i,otp:e.otp,oob_code:e.oobCode,binding_code:e.bindingCode,recovery_code:e.recoveryCode});return this.contextManager.remove(e.mfaToken),a}catch(a){if(a instanceof We)this.setMFAAuthDetails(a.mfa_token,o,i,a.mfa_requirements);else if(a instanceof Xe)throw new Xe(a.error,a.error_description);throw a}}},_n=class{constructor(e){let t,r;if(this.userCache=new bt().enclosedCache,this.defaultOptions={authorizationParams:{scope:"openid profile email"},useRefreshTokensFallback:!1,useFormData:!0},this.options=Object.assign(Object.assign(Object.assign({},this.defaultOptions),e),{authorizationParams:Object.assign(Object.assign({},this.defaultOptions.authorizationParams),e.authorizationParams)}),typeof window<"u"&&(()=>{if(!cn())throw new Error("For security reasons, `window.crypto` is required to run `auth0-spa-js`.");if(cn().subtle===void 0)throw new Error(`
      auth0-spa-js must run on a secure origin. See https://github.com/auth0/auth0-spa-js/blob/main/FAQ.md#why-do-i-get-auth0-spa-js-must-run-on-a-secure-origin for more information.
    `)})(),this.lockManager=(Kn||(Kn=zi()),Kn),e.cache&&e.cacheLocation&&console.warn("Both `cache` and `cacheLocation` options have been specified in the Auth0Client configuration; ignoring `cacheLocation` and using `cache`."),e.cache)r=e.cache;else{if(t=e.cacheLocation||"memory",!go(t))throw new Error('Invalid cache location "'.concat(t,'"'));r=go(t)()}var o;this.httpTimeoutMs=e.httpTimeoutInSeconds?1e3*e.httpTimeoutInSeconds:1e4,this.cookieStorage=e.legacySameSiteCookie===!1?qe:ca,this.orgHintCookieName=(o=this.options.clientId,"auth0.".concat(o,".organization_hint")),this.isAuthenticatedCookieName=(u=>"auth0.".concat(u,".is.authenticated"))(this.options.clientId),this.sessionCheckExpiryDays=e.sessionCheckExpiryDays||1;let i=e.useCookiesForTransactions?this.cookieStorage:ua;var a;this.scope=(function(u,h){for(var f=arguments.length,l=new Array(f>2?f-2:0),d=2;d<f;d++)l[d-2]=arguments[d];if(typeof u!="object")return{default:en(h,u,...l)};let w={default:en(h,...l)};return Object.keys(u).forEach(p=>{let m=u[p];w[p]=en(h,m,...l)}),w})(this.options.authorizationParams.scope,"openid",this.options.useRefreshTokens?"offline_access":""),this.transactionManager=new fr(i,this.options.clientId,this.options.cookieDomain),this.nowProvider=this.options.nowProvider||Ho,this.cacheManager=new pr(r,r.allKeys?void 0:new mr(r,this.options.clientId),this.nowProvider),this.dpop=this.options.useDpop?new gr(this.options.clientId):void 0,this.domainUrl=(a=this.options.domain,/^https?:\/\//.test(a)?a:"https://".concat(a)),this.tokenIssuer=((u,h)=>u?u.startsWith("https://")?u:"https://".concat(u,"/"):"".concat(h,"/"))(this.options.issuer,this.domainUrl);let s="".concat(this.domainUrl,"/me/"),c=this.createFetcher(Object.assign(Object.assign({},this.options.useDpop&&{dpopNonceId:"__auth0_my_account_api__"}),{getAccessToken:()=>this.getTokenSilently({authorizationParams:{scope:"create:me:connected_accounts",audience:s},detailedResponse:!0})}));this.myAccountApi=new vr(c,s),this.authJsClient=new As({domain:this.options.domain,clientId:this.options.clientId}),this.mfa=new Wr(this.authJsClient.mfa,this),typeof window<"u"&&window.Worker&&this.options.useRefreshTokens&&t==="memory"&&(this.options.workerUrl?this.worker=new Worker(this.options.workerUrl):this.worker=new la)}getConfiguration(){return Object.freeze({domain:this.options.domain,clientId:this.options.clientId})}_url(e){let t=this.options.auth0Client||zo,r=Jo(t,!0),o=encodeURIComponent(btoa(JSON.stringify(r)));return"".concat(this.domainUrl).concat(e,"&auth0Client=").concat(o)}_authorizeUrl(e){return this._url("/authorize?".concat(cr(e)))}async _verifyIdToken(e,t,r){let o=await this.nowProvider();return oa({iss:this.tokenIssuer,aud:this.options.clientId,id_token:e,nonce:t,organization:r,leeway:this.options.leeway,max_age:(i=this.options.authorizationParams.max_age,typeof i!="string"?i:parseInt(i,10)||void 0),now:o});var i}_processOrgHint(e){e?this.cookieStorage.save(this.orgHintCookieName,e,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}):this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain})}async _prepareAuthorizeUrl(e,t,r){var o;let i=Dn(st()),a=Dn(st()),s=st(),c=await uo(s),u=lo(c),h=await((o=this.dpop)===null||o===void 0?void 0:o.calculateThumbprint()),f=((d,w,p,m,y,b,k,E,g)=>Object.assign(Object.assign(Object.assign({client_id:d.clientId},d.authorizationParams),p),{scope:Gt(w,p.scope,p.audience),response_type:"code",response_mode:E||"query",state:m,nonce:y,redirect_uri:k||d.authorizationParams.redirect_uri,code_challenge:b,code_challenge_method:"S256",dpop_jkt:g}))(this.options,this.scope,e,i,a,u,e.redirect_uri||this.options.authorizationParams.redirect_uri||r,t?.response_mode,h),l=this._authorizeUrl(f);return{nonce:a,code_verifier:s,scope:f.scope,audience:f.audience||"default",redirect_uri:f.redirect_uri,state:i,url:l}}async loginWithPopup(e,t){var r;if(e=e||{},!(t=t||{}).popup&&(t.popup=(s=>{let c=window.screenX+(window.innerWidth-400)/2,u=window.screenY+(window.innerHeight-600)/2;return window.open(s,"auth0:authorize:popup","left=".concat(c,",top=").concat(u,",width=").concat(400,",height=").concat(600,",resizable,scrollbars=yes,status=1"))})(""),!t.popup))throw new ar;let o=await this._prepareAuthorizeUrl(e.authorizationParams||{},{response_mode:"web_message"},window.location.origin);t.popup.location.href=o.url;let i=await(s=>new Promise((c,u)=>{let h,f=setInterval(()=>{s.popup&&s.popup.closed&&(clearInterval(f),clearTimeout(l),window.removeEventListener("message",h,!1),u(new an(s.popup)))},1e3),l=setTimeout(()=>{clearInterval(f),u(new on(s.popup)),window.removeEventListener("message",h,!1)},1e3*(s.timeoutInSeconds||60));h=function(d){if(d.data&&d.data.type==="authorization_response"){if(clearTimeout(l),clearInterval(f),window.removeEventListener("message",h,!1),s.closePopup!==!1&&s.popup.close(),d.data.response.error)return u(C.fromPayload(d.data.response));c(d.data.response)}},window.addEventListener("message",h)}))(Object.assign(Object.assign({},t),{timeoutInSeconds:t.timeoutInSeconds||this.options.authorizeTimeoutInSeconds||60}));if(o.state!==i.state)throw new C("state_mismatch","Invalid state");let a=((r=e.authorizationParams)===null||r===void 0?void 0:r.organization)||this.options.authorizationParams.organization;await this._requestToken({audience:o.audience,scope:o.scope,code_verifier:o.code_verifier,grant_type:"authorization_code",code:i.code,redirect_uri:o.redirect_uri},{nonceIn:o.nonce,organization:a})}async getUser(){var e;let t=await this._getIdTokenFromCache();return(e=t?.decodedToken)===null||e===void 0?void 0:e.user}async getIdTokenClaims(){var e;let t=await this._getIdTokenFromCache();return(e=t?.decodedToken)===null||e===void 0?void 0:e.claims}async loginWithRedirect(){var e;let t=wo(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}),{openUrl:r,fragment:o,appState:i}=t,a=X(t,["openUrl","fragment","appState"]),s=((e=a.authorizationParams)===null||e===void 0?void 0:e.organization)||this.options.authorizationParams.organization,c=await this._prepareAuthorizeUrl(a.authorizationParams||{}),{url:u}=c,h=X(c,["url"]);this.transactionManager.create(Object.assign(Object.assign(Object.assign({},h),{appState:i,response_type:Le.Code}),s&&{organization:s}));let f=o?"".concat(u,"#").concat(o):u;r?await r(f):window.location.assign(f)}async handleRedirectCallback(){let e=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.location.href).split("?").slice(1);if(e.length===0)throw new Error("There are no query params available for parsing.");let t=this.transactionManager.get();if(!t)throw new C("missing_transaction","Invalid state");this.transactionManager.remove();let r=(o=>{o.indexOf("#")>-1&&(o=o.substring(0,o.indexOf("#")));let i=new URLSearchParams(o);return{state:i.get("state"),code:i.get("code")||void 0,connect_code:i.get("connect_code")||void 0,error:i.get("error")||void 0,error_description:i.get("error_description")||void 0}})(e.join(""));return t.response_type===Le.ConnectCode?this._handleConnectAccountRedirectCallback(r,t):this._handleLoginRedirectCallback(r,t)}async _handleLoginRedirectCallback(e,t){let{code:r,state:o,error:i,error_description:a}=e;if(i)throw new rn(i,a||i,o,t.appState);if(!t.code_verifier||t.state&&t.state!==o)throw new C("state_mismatch","Invalid state");let s=t.organization,c=t.nonce,u=t.redirect_uri;return await this._requestToken(Object.assign({audience:t.audience,scope:t.scope,code_verifier:t.code_verifier,grant_type:"authorization_code",code:r},u?{redirect_uri:u}:{}),{nonceIn:c,organization:s}),{appState:t.appState,response_type:Le.Code}}async _handleConnectAccountRedirectCallback(e,t){let{connect_code:r,state:o,error:i,error_description:a}=e;if(i)throw new ir(i,a||i,t.connection,o,t.appState);if(!r)throw new C("missing_connect_code","Missing connect code");if(!(t.code_verifier&&t.state&&t.auth_session&&t.redirect_uri&&t.state===o))throw new C("state_mismatch","Invalid state");let s=await this.myAccountApi.completeAccount({auth_session:t.auth_session,connect_code:r,redirect_uri:t.redirect_uri,code_verifier:t.code_verifier});return Object.assign(Object.assign({},s),{appState:t.appState,response_type:Le.ConnectCode})}async checkSession(e){if(!this.cookieStorage.get(this.isAuthenticatedCookieName)){if(!this.cookieStorage.get("auth0.is.authenticated"))return;this.cookieStorage.save(this.isAuthenticatedCookieName,!0,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}),this.cookieStorage.remove("auth0.is.authenticated")}try{await this.getTokenSilently(e)}catch{}}async getTokenSilently(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var t,r;let o=Object.assign(Object.assign({cacheMode:"on"},e),{authorizationParams:Object.assign(Object.assign(Object.assign({},this.options.authorizationParams),e.authorizationParams),{scope:Gt(this.scope,(t=e.authorizationParams)===null||t===void 0?void 0:t.scope,((r=e.authorizationParams)===null||r===void 0?void 0:r.audience)||this.options.authorizationParams.audience)})}),i=await((a,s)=>{let c=Wn[s];return c||(c=a().finally(()=>{delete Wn[s],c=null}),Wn[s]=c),c})(()=>this._getTokenSilently(o),"".concat(this.options.clientId,"::").concat(o.authorizationParams.audience,"::").concat(o.authorizationParams.scope));return e.detailedResponse?i:i?.access_token}async _getTokenSilently(e){let{cacheMode:t}=e,r=X(e,["cacheMode"]);if(t!=="off"){let s=await this._getEntryFromCache({scope:r.authorizationParams.scope,audience:r.authorizationParams.audience||"default",clientId:this.options.clientId,cacheMode:t});if(s)return s}if(t==="cache-only")return;let o=(i=this.options.clientId,a=r.authorizationParams.audience||"default","".concat("auth0.lock.getTokenSilently",".").concat(i,".").concat(a));var i,a;try{return await this.lockManager.runWithLock(o,5e3,async()=>{if(t!=="off"){let d=await this._getEntryFromCache({scope:r.authorizationParams.scope,audience:r.authorizationParams.audience||"default",clientId:this.options.clientId});if(d)return d}let s=this.options.useRefreshTokens?await this._getTokenUsingRefreshToken(r):await this._getTokenFromIFrame(r),{id_token:c,token_type:u,access_token:h,oauthTokenScope:f,expires_in:l}=s;return Object.assign(Object.assign({id_token:c,token_type:u,access_token:h},f?{scope:f}:null),{expires_in:l})})}catch(s){if(this._isInteractiveError(s)&&this.options.interactiveErrorHandler==="popup")return await this._handleInteractiveErrorWithPopup(r);throw s}}_isInteractiveError(e){return e instanceof We}async _handleInteractiveErrorWithPopup(e){try{await this.loginWithPopup({authorizationParams:e.authorizationParams});let t=await this._getEntryFromCache({scope:e.authorizationParams.scope,audience:e.authorizationParams.audience||"default",clientId:this.options.clientId});if(!t)throw new C("interactive_handler_cache_miss","Token not found in cache after interactive authentication");return t}catch(t){throw t}}async getTokenWithPopup(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r,o;let i=Object.assign(Object.assign({},e),{authorizationParams:Object.assign(Object.assign(Object.assign({},this.options.authorizationParams),e.authorizationParams),{scope:Gt(this.scope,(r=e.authorizationParams)===null||r===void 0?void 0:r.scope,((o=e.authorizationParams)===null||o===void 0?void 0:o.audience)||this.options.authorizationParams.audience)})});return t=Object.assign(Object.assign({},Ui),t),await this.loginWithPopup(i,t),(await this.cacheManager.get(new ee({scope:i.authorizationParams.scope,audience:i.authorizationParams.audience||"default",clientId:this.options.clientId}),void 0,this.options.useMrrt)).access_token}async isAuthenticated(){return!!await this.getUser()}_buildLogoutUrl(e){e.clientId!==null?e.clientId=e.clientId||this.options.clientId:delete e.clientId;let t=e.logoutParams||{},{federated:r}=t,o=X(t,["federated"]),i=r?"&federated":"";return this._url("/v2/logout?".concat(cr(Object.assign({clientId:e.clientId},o))))+i}async logout(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var t;let r=wo(e),{openUrl:o}=r,i=X(r,["openUrl"]);e.clientId===null?await this.cacheManager.clear():await this.cacheManager.clear(e.clientId||this.options.clientId),this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain}),this.cookieStorage.remove(this.isAuthenticatedCookieName,{cookieDomain:this.options.cookieDomain}),this.userCache.remove("@@user@@"),await((t=this.dpop)===null||t===void 0?void 0:t.clear());let a=this._buildLogoutUrl(i);o?await o(a):o!==!1&&window.location.assign(a)}async _getTokenFromIFrame(e){let t=(r=this.options.clientId,"".concat("auth0.lock.getTokenFromIFrame",".").concat(r));var r;try{return await this.lockManager.runWithLock(t,5e3,async()=>{let o=Object.assign(Object.assign({},e.authorizationParams),{prompt:"none"}),i=this.cookieStorage.get(this.orgHintCookieName);i&&!o.organization&&(o.organization=i);let{url:a,state:s,nonce:c,code_verifier:u,redirect_uri:h,scope:f,audience:l}=await this._prepareAuthorizeUrl(o,{response_mode:"web_message"},window.location.origin);if(window.crossOriginIsolated)throw new C("login_required","The application is running in a Cross-Origin Isolated context, silently retrieving a token without refresh token is not possible.");let d=e.timeoutInSeconds||this.options.authorizeTimeoutInSeconds,w;try{w=new URL(this.domainUrl).origin}catch{w=this.domainUrl}let p=await(function(y,b){let k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:60;return new Promise((E,g)=>{let P=window.document.createElement("iframe");P.setAttribute("width","0"),P.setAttribute("height","0"),P.style.display="none";let G=()=>{window.document.body.contains(P)&&(window.document.body.removeChild(P),window.removeEventListener("message",N,!1))},N,ge=setTimeout(()=>{g(new Ne),G()},1e3*k);N=function(V){if(V.origin!=b||!V.data||V.data.type!=="authorization_response")return;let Je=V.source;Je&&Je.close(),V.data.response.error?g(C.fromPayload(V.data.response)):E(V.data.response),clearTimeout(ge),window.removeEventListener("message",N,!1),setTimeout(G,2e3)},window.addEventListener("message",N,!1),window.document.body.appendChild(P),P.setAttribute("src",y)})})(a,w,d);if(s!==p.state)throw new C("state_mismatch","Invalid state");let m=await this._requestToken(Object.assign(Object.assign({},e.authorizationParams),{code_verifier:u,code:p.code,grant_type:"authorization_code",redirect_uri:h,timeout:e.authorizationParams.timeout||this.httpTimeoutMs}),{nonceIn:c,organization:o.organization});return Object.assign(Object.assign({},m),{scope:f,oauthTokenScope:m.scope,audience:l})})}catch(o){throw o.error==="login_required"&&this.logout({openUrl:!1}),o}}async _getTokenUsingRefreshToken(e){var t,r;let o=await this.cacheManager.get(new ee({scope:e.authorizationParams.scope,audience:e.authorizationParams.audience||"default",clientId:this.options.clientId}),void 0,this.options.useMrrt);if(!(o&&o.refresh_token||this.worker)){if(this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(e);throw new wt(e.authorizationParams.audience||"default",e.authorizationParams.scope)}let i=e.authorizationParams.redirect_uri||this.options.authorizationParams.redirect_uri||window.location.origin,a=typeof e.timeoutInSeconds=="number"?1e3*e.timeoutInSeconds:null,s=((l,d,w,p)=>{var m;if(l&&w&&p){if(d.audience!==w)return d.scope;let y=p.split(" "),b=((m=d.scope)===null||m===void 0?void 0:m.split(" "))||[],k=b.every(E=>y.includes(E));return y.length>=b.length&&k?p:d.scope}return d.scope})(this.options.useMrrt,e.authorizationParams,o?.audience,o?.scope);try{let l=await this._requestToken(Object.assign(Object.assign(Object.assign({},e.authorizationParams),{grant_type:"refresh_token",refresh_token:o&&o.refresh_token,redirect_uri:i}),a&&{timeout:a}),{scopesToRequest:s});if(l.refresh_token&&o?.refresh_token&&await this.cacheManager.updateEntry(o.refresh_token,l.refresh_token),this.options.useMrrt&&(c=o?.audience,u=o?.scope,h=e.authorizationParams.audience,f=e.authorizationParams.scope,(c!==h||!vo(f,u))&&!vo(s,l.scope))){if(this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(e);await this.cacheManager.remove(this.options.clientId,e.authorizationParams.audience,e.authorizationParams.scope);let d=((w,p)=>{let m=w?.split(" ")||[],y=p?.split(" ")||[];return m.filter(b=>y.indexOf(b)==-1).join(",")})(s,l.scope);throw new sr(e.authorizationParams.audience||"default",d)}return Object.assign(Object.assign({},l),{scope:e.authorizationParams.scope,oauthTokenScope:l.scope,audience:e.authorizationParams.audience||"default"})}catch(l){if(l.message){if(l.message.includes("user is blocked"))throw await this.logout({openUrl:!1}),l;if((l.message.includes("Missing Refresh Token")||l.message.includes("invalid refresh token"))&&this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(e)}throw l instanceof We&&this.mfa.setMFAAuthDetails(l.mfa_token,(t=e.authorizationParams)===null||t===void 0?void 0:t.scope,(r=e.authorizationParams)===null||r===void 0?void 0:r.audience,l.mfa_requirements),l}var c,u,h,f}async _saveEntryInCache(e){let{id_token:t,decodedToken:r}=e,o=X(e,["id_token","decodedToken"]);this.userCache.set("@@user@@",{id_token:t,decodedToken:r}),await this.cacheManager.setIdToken(this.options.clientId,e.id_token,e.decodedToken),await this.cacheManager.set(o)}async _getIdTokenFromCache(){let e=this.options.authorizationParams.audience||"default",t=this.scope[e],r=await this.cacheManager.getIdToken(new ee({clientId:this.options.clientId,audience:e,scope:t})),o=this.userCache.get("@@user@@");return r&&r.id_token===o?.id_token?o:(this.userCache.set("@@user@@",r),r)}async _getEntryFromCache(e){let{scope:t,audience:r,clientId:o,cacheMode:i}=e,a=await this.cacheManager.get(new ee({scope:t,audience:r,clientId:o}),60,this.options.useMrrt,i);if(a&&a.access_token){let{token_type:s,access_token:c,oauthTokenScope:u,expires_in:h}=a,f=await this._getIdTokenFromCache();return f&&Object.assign(Object.assign({id_token:f.id_token,token_type:s||"Bearer",access_token:c},u?{scope:u}:null),{expires_in:h})}}async _requestToken(e,t){var r,o;let{nonceIn:i,organization:a,scopesToRequest:s}=t||{},c=await ta(Object.assign(Object.assign({baseUrl:this.domainUrl,client_id:this.options.clientId,auth0Client:this.options.auth0Client,useFormData:this.options.useFormData,timeout:this.httpTimeoutMs,useMrrt:this.options.useMrrt,dpop:this.dpop},e),{scope:s||e.scope}),this.worker),u=await this._verifyIdToken(c.id_token,i,a);if(e.grant_type==="authorization_code"){let h=await this._getIdTokenFromCache();!((o=(r=h?.decodedToken)===null||r===void 0?void 0:r.claims)===null||o===void 0)&&o.sub&&h.decodedToken.claims.sub!==u.claims.sub&&(await this.cacheManager.clear(this.options.clientId),this.userCache.remove("@@user@@"))}return await this._saveEntryInCache(Object.assign(Object.assign(Object.assign(Object.assign({},c),{decodedToken:u,scope:e.scope,audience:e.audience||"default"}),c.scope?{oauthTokenScope:c.scope}:null),{client_id:this.options.clientId})),this.cookieStorage.save(this.isAuthenticatedCookieName,!0,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}),this._processOrgHint(a||u.claims.org_id),Object.assign(Object.assign({},c),{decodedToken:u})}async loginWithCustomTokenExchange(e){return this._requestToken(Object.assign(Object.assign({},e),{grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:e.subject_token,subject_token_type:e.subject_token_type,scope:Gt(this.scope,e.scope,e.audience||this.options.authorizationParams.audience),audience:e.audience||this.options.authorizationParams.audience,organization:e.organization||this.options.authorizationParams.organization}))}async exchangeToken(e){return this.loginWithCustomTokenExchange(e)}_assertDpop(e){if(!e)throw new Error("`useDpop` option must be enabled before using DPoP.")}getDpopNonce(e){return this._assertDpop(this.dpop),this.dpop.getNonce(e)}setDpopNonce(e,t){return this._assertDpop(this.dpop),this.dpop.setNonce(e,t)}generateDpopProof(e){return this._assertDpop(this.dpop),this.dpop.generateProof(e)}createFetcher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new wr(e,{isDpopEnabled:()=>!!this.options.useDpop,getAccessToken:t=>{var r;return this.getTokenSilently({authorizationParams:{scope:(r=t?.scope)===null||r===void 0?void 0:r.join(" "),audience:t?.audience},detailedResponse:!0})},getDpopNonce:()=>this.getDpopNonce(e.dpopNonceId),setDpopNonce:t=>this.setDpopNonce(t,e.dpopNonceId),generateDpopProof:t=>this.generateDpopProof(t)})}async connectAccountWithRedirect(e){let{openUrl:t,appState:r,connection:o,scopes:i,authorization_params:a,redirectUri:s=this.options.authorizationParams.redirect_uri||window.location.origin}=e;if(!o)throw new Error("connection is required");let c=Dn(st()),u=st(),h=await uo(u),f=lo(h),{connect_uri:l,connect_params:d,auth_session:w}=await this.myAccountApi.connectAccount({connection:o,scopes:i,redirect_uri:s,state:c,code_challenge:f,code_challenge_method:"S256",authorization_params:a});this.transactionManager.create({state:c,code_verifier:u,auth_session:w,redirect_uri:s,appState:r,connection:o,response_type:Le.ConnectCode});let p=new URL(l);p.searchParams.set("ticket",d.ticket),t?await t(p.toString()):window.location.assign(p)}async _requestTokenForMfa(e,t){let{mfaToken:r}=e,o=X(e,["mfaToken"]);return this._requestToken(Object.assign(Object.assign({},o),{mfa_token:r}),t)}};var Ci={name:"@auth0/auth0-angular",version:"2.6.0"},Zr=class{static createClient(e){let t=e.get();if(!t)throw new Error("Configuration must be specified either through AuthModule.forRoot or through AuthClientConfig.set");return new _n(Pn(Tn({},t),{auth0Client:{name:Ci.name,version:Ci.version,env:{"angular/core":io.full}}}))}},An=new xn("auth0.client");function xi(n){return typeof n!="string"}var Oi=new xn("auth0-angular.config"),qr=(()=>{class n{constructor(t){t&&this.set(t)}set(t){this.config=t}get(){return this.config}static{this.\u0275fac=function(r){return new(r||n)(F(Oi,8))}}static{this.\u0275prov=le({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Cs=(()=>{class n{constructor(t,r){this.location=t;try{this.router=r.get(Vt)}catch{}}navigateByUrl(t){if(this.router){this.router.navigateByUrl(t);return}this.location.replaceState(t)}static{this.\u0275fac=function(r){return new(r||n)(F(co),F(so))}}static{this.\u0275prov=le({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),ji=(()=>{class n{constructor(t){this.auth0Client=t,this.isLoadingSubject$=new Yr(!0),this.refresh$=new Rn,this.accessToken$=new Wt(1),this.errorSubject$=new Wt(1),this.isLoading$=this.isLoadingSubject$.asObservable(),this.accessTokenTrigger$=this.accessToken$.pipe(to((r,o)=>({previous:r.current,current:o}),{current:null,previous:null}),Ht(({previous:r,current:o})=>r!==o)),this.isAuthenticatedTrigger$=this.isLoading$.pipe(Ht(r=>!r),Jt(),it(()=>Xr(zt(()=>this.auth0Client.isAuthenticated()),this.accessTokenTrigger$.pipe(Mt(()=>this.auth0Client.isAuthenticated())),this.refresh$.pipe(Mt(()=>this.auth0Client.isAuthenticated()))))),this.isAuthenticated$=this.isAuthenticatedTrigger$.pipe(Jt(),no(1)),this.user$=this.isAuthenticatedTrigger$.pipe(he(r=>r?this.auth0Client.getUser():q(null)),Jt()),this.idTokenClaims$=this.isAuthenticatedTrigger$.pipe(he(r=>r?this.auth0Client.getIdTokenClaims():q(null))),this.error$=this.errorSubject$.asObservable()}setIsLoading(t){this.isLoadingSubject$.next(t)}refresh(){this.refresh$.next()}setAccessToken(t){this.accessToken$.next(t)}setError(t){this.errorSubject$.next(t)}static{this.\u0275fac=function(r){return new(r||n)(F(An))}}static{this.\u0275prov=le({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),Kt=(()=>{class n{constructor(t,r,o,i){this.auth0Client=t,this.configFactory=r,this.navigator=o,this.authState=i,this.appStateSubject$=new Wt(1),this.ngUnsubscribe$=new Rn,this.isLoading$=this.authState.isLoading$,this.isAuthenticated$=this.authState.isAuthenticated$,this.user$=this.authState.user$,this.idTokenClaims$=this.authState.idTokenClaims$,this.error$=this.authState.error$,this.appState$=this.appStateSubject$.asObservable();let a=s=>In(()=>s,this.handleRedirectCallback(),zt(()=>this.auth0Client.checkSession()));this.shouldHandleCallback().pipe(it(s=>a(s).pipe(Te(c=>{let u=this.configFactory.get();return this.navigator.navigateByUrl(u.errorPath||"/"),this.authState.setError(c),q(void 0)}))),Pe(()=>{this.authState.setIsLoading(!1)}),ro(this.ngUnsubscribe$)).subscribe()}ngOnDestroy(){this.ngUnsubscribe$.next(),this.ngUnsubscribe$.complete()}loginWithRedirect(t){return ue(this.auth0Client.loginWithRedirect(t))}connectAccountWithRedirect(t){return ue(this.auth0Client.connectAccountWithRedirect(t))}loginWithPopup(t,r){return ue(this.auth0Client.loginWithPopup(t,r).then(()=>{this.authState.refresh()}))}logout(t){return ue(this.auth0Client.logout(t).then(()=>{(t?.openUrl===!1||t?.openUrl)&&this.authState.refresh()}))}getAccessTokenSilently(t={}){return q(this.auth0Client).pipe(he(r=>t.detailedResponse===!0?r.getTokenSilently(Pn(Tn({},t),{detailedResponse:!0})):r.getTokenSilently(t)),Pe(r=>{r&&this.authState.setAccessToken(typeof r=="string"?r:r.access_token)}),Te(r=>(this.authState.setError(r),this.authState.refresh(),Ve(r))))}getAccessTokenWithPopup(t){return q(this.auth0Client).pipe(he(r=>r.getTokenWithPopup(t)),Pe(r=>{r&&this.authState.setAccessToken(r)}),Te(r=>(this.authState.setError(r),this.authState.refresh(),Ve(r))))}loginWithCustomTokenExchange(t){return q(this.auth0Client).pipe(he(r=>r.loginWithCustomTokenExchange(t)),Pe(r=>{r.access_token&&this.authState.setAccessToken(r.access_token)}),Te(r=>(this.authState.setError(r),this.authState.refresh(),Ve(r))))}handleRedirectCallback(t){return zt(()=>this.auth0Client.handleRedirectCallback(t)).pipe(oo(this.authState.isLoading$),Pe(([r,o])=>{o||this.authState.refresh();let i=r?.appState,a=i?.target??"/";i&&this.appStateSubject$.next(i),this.navigator.navigateByUrl(a)}),ot(([r])=>r))}getDpopNonce(t){return ue(this.auth0Client.getDpopNonce(t))}setDpopNonce(t,r){return ue(this.auth0Client.setDpopNonce(t,r))}generateDpopProof(t){return ue(this.auth0Client.generateDpopProof(t))}createFetcher(t){return this.auth0Client.createFetcher(t)}shouldHandleCallback(){return q(location.search).pipe(ot(t=>{let r=new URLSearchParams(t);return(r.has("code")||r.has("error"))&&r.has("state")&&!this.configFactory.get().skipRedirectCallback}))}static{this.\u0275fac=function(r){return new(r||n)(F(An),F(qr),F(Cs),F(ji))}}static{this.\u0275prov=le({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})(),xs=(()=>{class n{constructor(t){this.auth=t}canLoad(t,r){return this.auth.isAuthenticated$.pipe($r(1))}canActivate(t,r){return this.redirectIfUnauthenticated(r)}canActivateChild(t,r){return this.redirectIfUnauthenticated(r)}redirectIfUnauthenticated(t){return this.auth.isAuthenticated$.pipe(it(r=>r?q(!0):this.auth.loginWithRedirect({appState:{target:t.url}}).pipe(ot(()=>!1))))}static{this.\u0275fac=function(r){return new(r||n)(F(Kt))}}static{this.\u0275prov=le({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Os=n=>e=>e.pipe(Mt(t=>n.pipe(Cn(),Qr(t)))),Di=(()=>{class n{constructor(t,r,o,i){this.configFactory=t,this.auth0Client=r,this.authState=o,this.authService=i}intercept(t,r){let o=this.configFactory.get();if(!o.httpInterceptor?.allowedList)return r.handle(t);let i=this.authService.isLoading$.pipe(Ht(a=>!a));return this.findMatchingRoute(t,o.httpInterceptor).pipe(he(a=>In(()=>a!==null,q(a).pipe(Os(i),eo("tokenOptions"),he(s=>this.getAccessTokenSilently(s).pipe(Te(c=>this.allowAnonymous(a,c)?q(""):(this.authState.setError(c),Ve(c))))),it(s=>{let c=s?t.clone({headers:t.headers.set("Authorization",`Bearer ${s}`)}):t;return r.handle(c)})),r.handle(t))))}getAccessTokenSilently(t){return q(this.auth0Client).pipe(he(r=>r.getTokenSilently(t)),ot(r=>typeof r=="string"?r:r.access_token),Pe(r=>this.authState.setAccessToken(r)),Te(r=>(this.authState.refresh(),Ve(r))))}stripQueryFrom(t){return t.indexOf("?")>-1&&(t=t.substr(0,t.indexOf("?"))),t.indexOf("#")>-1&&(t=t.substr(0,t.indexOf("#"))),t}canAttachToken(t,r){let o=i=>{if(!i)return!1;let a=this.stripQueryFrom(r.url);return i===a?!0:i.indexOf("*")===i.length-1&&r.url.startsWith(i.substr(0,i.length-1))};return xi(t)?t.httpMethod&&t.httpMethod!==r.method?!1:(!t.uri&&!t.uriMatcher&&console.warn("Either a uri or uriMatcher is required when configuring the HTTP interceptor."),t.uriMatcher?t.uriMatcher(r.url):o(t.uri)):o(t)}findMatchingRoute(t,r){return ue(r.allowedList).pipe(Cn(o=>this.canAttachToken(o,t),null))}allowAnonymous(t,r){return!!t&&xi(t)&&!!t.allowAnonymous&&["login_required","consent_required","missing_refresh_token"].includes(r.error)}static{this.\u0275fac=function(r){return new(r||n)(F(qr),F(An),F(ji),F(Kt))}}static{this.\u0275prov=le({token:n,factory:n.\u0275fac})}}return n})();function gc(n){return ao([Kt,Di,xs,{provide:Oi,useValue:n},{provide:An,useFactory:Zr.createClient,deps:[qr]}])}var wc=(n,e)=>at(Di).intercept(n,{handle:e});var Li=class n{auth0=at(Kt);router=at(Vt);isLoggedIn=On(!1);userProfile=On(null);isAuthenticated=jn(()=>this.isLoggedIn());user=jn(()=>this.userProfile());constructor(){this.auth0.isAuthenticated$.subscribe(e=>{this.isLoggedIn.set(e)}),this.auth0.user$.subscribe(e=>{this.userProfile.set(e)})}login(){this.auth0.loginWithRedirect({appState:{target:"/dashboard"}})}logout(){this.auth0.logout({logoutParams:{returnTo:window.location.origin}})}getAccessToken(){return this.auth0.getAccessTokenSilently()}getUserProfile(){return this.userProfile()}get isAuthenticated$(){return this.auth0.isAuthenticated$}get user$(){return this.auth0.user$}get isLoading$(){return this.auth0.isLoading$}get error$(){return this.auth0.error$}static \u0275fac=function(t){return new(t||n)};static \u0275prov=le({token:n,factory:n.\u0275fac,providedIn:"root"})};export{Kt as a,gc as b,wc as c,Li as d};
